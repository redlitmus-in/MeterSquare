import{j as e}from"./radix-ui-34961435.js";import{u as s,r as t}from"./react-vendor-3707ac94.js";import{C as a,b as r,c as l,a as i}from"./card-e62b6216.js";import{B as c,a as n,u as d,M as x,U as m}from"./index-12cad093.js";import{g as o}from"./dateFormatter-3b370b4b.js";import{T as h,a as p,b as j,c as u}from"./tabs-8d248749.js";import{A as g,m as N}from"./ui-vendor-42d562f2.js";import{F as y,V as v,a8 as f,av as b,X as w,u as D,U as C,aw as k,q as S,g as E,i as A,k as L,z as O,h as I,N as T,af as _,G as P,E as R}from"./icons-2fde7931.js";import"./auth-f9290e45.js";import"./utils-8e4480a0.js";import"./forms-337f692b.js";const M=({isOpen:s,onClose:t,documentType:d,documentData:x,onEdit:m,onDownload:I,onPrint:T})=>{if(!s||!x)return null;return e.jsx(g,{children:e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs(N.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-red-50 to-red-100 border-b border-red-200 p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(y,{className:"w-6 h-6 text-red-600"}),e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-800",children:[d.replace("_"," ").toUpperCase()," Details"]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["ID: ",x.id||x.requestId||"N/A"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[m&&e.jsxs(c,{variant:"outline",size:"sm",onClick:m,className:"flex items-center gap-1",children:[e.jsx(v,{className:"w-4 h-4"}),"Edit"]}),e.jsxs(c,{variant:"outline",size:"sm",onClick:()=>{const e=JSON.stringify(x,null,2),s=new Blob([e],{type:"application/json"}),t=URL.createObjectURL(s),a=document.createElement("a");a.href=t,a.download=`${d}_${x.id||Date.now()}.json`,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(t),I&&I()},className:"flex items-center gap-1",children:[e.jsx(f,{className:"w-4 h-4"}),"Download"]}),e.jsxs(c,{variant:"outline",size:"sm",onClick:()=>{window.print(),T&&T()},className:"flex items-center gap-1",children:[e.jsx(b,{className:"w-4 h-4"}),"Print"]}),e.jsx(c,{variant:"ghost",size:"sm",onClick:t,className:"text-gray-600 hover:bg-red-100",children:e.jsx(w,{className:"w-4 h-4"})})]})]})}),e.jsx("div",{className:"p-6 overflow-y-auto max-h-[calc(90vh-80px)]",children:e.jsxs(h,{defaultValue:"details",className:"space-y-4",children:[e.jsxs(p,{className:"grid w-full max-w-md grid-cols-3",children:[e.jsx(j,{value:"details",children:"Details"}),e.jsx(j,{value:"items",children:"Items"}),e.jsx(j,{value:"history",children:"History"})]}),e.jsxs(u,{value:"details",className:"space-y-4",children:[e.jsxs(a,{children:[e.jsx(r,{children:e.jsx(l,{className:"text-lg",children:"General Information"})}),e.jsxs(i,{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Status"}),e.jsx("div",{children:(s=>{const t={pending:{color:"bg-yellow-100 text-yellow-700",icon:L},approved:{color:"bg-green-100 text-green-700",icon:A},rejected:{color:"bg-red-100 text-red-700",icon:O},in_progress:{color:"bg-[#243d8a]/10 text-[#243d8a]/90",icon:L},completed:{color:"bg-purple-100 text-purple-700",icon:A}},a=t[s]||t.pending,r=a.icon;return e.jsxs(n,{className:`${a.color} flex items-center gap-1`,children:[e.jsx(r,{className:"w-3 h-3"}),s.replace("_"," ").toUpperCase()]})})(x.status||"pending")})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Priority"}),e.jsx(n,{className:"urgent"===x.priority?"bg-red-100 text-red-700":"high"===x.priority?"bg-orange-100 text-orange-700":"medium"===x.priority?"bg-[#243d8a]/10 text-[#243d8a]/90":"bg-gray-100 text-gray-700",children:x.priority||"Medium"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"text-sm text-gray-500 flex items-center gap-1",children:[e.jsx(D,{className:"w-3 h-3"}),"Created Date"]}),e.jsx("p",{className:"font-medium",children:x.createdDate||x.date||"N/A"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"text-sm text-gray-500 flex items-center gap-1",children:[e.jsx(C,{className:"w-3 h-3"}),"Requester"]}),e.jsx("p",{className:"font-medium",children:x.requester||x.requestedBy||"N/A"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"text-sm text-gray-500 flex items-center gap-1",children:[e.jsx(k,{className:"w-3 h-3"}),"Project"]}),e.jsx("p",{className:"font-medium",children:x.project||x.projectName||"N/A"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"text-sm text-gray-500 flex items-center gap-1",children:[e.jsx(S,{className:"w-3 h-3"}),"Total Amount"]}),e.jsxs("p",{className:"font-medium text-lg text-red-600",children:["AED ",x.totalAmount?.toLocaleString()||"0"]})]})]})]}),x.description&&e.jsxs(a,{children:[e.jsx(r,{children:e.jsx(l,{className:"text-lg",children:"Description"})}),e.jsx(i,{children:e.jsx("p",{className:"text-gray-700",children:x.description})})]})]}),e.jsx(u,{value:"items",className:"space-y-4",children:e.jsxs(a,{children:[e.jsx(r,{children:e.jsx(l,{className:"text-lg",children:"Line Items"})}),e.jsx(i,{children:x.items&&x.items.length>0?e.jsx("div",{className:"space-y-2",children:x.items.map((s,t)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(E,{className:"w-4 h-4 text-gray-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.description||s.name||"Item "+(t+1)}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Qty: ",s.quantity||0," ",s.unit||""]})]})]}),e.jsxs("p",{className:"font-medium",children:["AED ",(s.amount||s.price||0).toLocaleString()]})]},t))}):e.jsx("p",{className:"text-gray-500 text-center py-4",children:"No items available"})})]})}),e.jsx(u,{value:"history",className:"space-y-4",children:e.jsxs(a,{children:[e.jsx(r,{children:e.jsx(l,{className:"text-lg",children:"Activity History"})}),e.jsx(i,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-green-100 rounded-full flex items-center justify-center",children:e.jsx(A,{className:"w-4 h-4 text-green-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium",children:"Document Created"}),e.jsxs("p",{className:"text-sm text-gray-500",children:["By ",x.requester||"System"," on ",x.createdDate||"N/A"]})]})]}),"approved"===x.status&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-[#243d8a]/10 rounded-full flex items-center justify-center",children:e.jsx(A,{className:"w-4 h-4 text-[#243d8a]"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium",children:"Document Approved"}),e.jsxs("p",{className:"text-sm text-gray-500",children:["By Manager on ",o()]})]})]})]})})]})})]})})]})})})},U=()=>{const o=s(),{user:h}=d(),[p,j]=t.useState(null),[u,g]=t.useState(!1),[y,b]=t.useState([]),[w,D]=t.useState(!0),[C,k]=t.useState(null),[S,U]=t.useState(""),[V,z]=t.useState("all");t.useEffect(()=>{B()},[]);const B=async()=>{try{D(!0),k(null),await new Promise(e=>setTimeout(e,1e3));b([{id:"1",deliveryNumber:"DEL-2024-001",purchaseOrderId:"PO-2024-001",supplierName:"Singapore Hardware Supplies",deliveryDate:"2024-09-05",expectedDate:"2024-09-05",status:"in_transit",items:15,totalValue:45e3,trackingNumber:"TRK-SHS-001",notes:"Delivery scheduled for morning slot"},{id:"2",deliveryNumber:"DEL-2024-002",purchaseOrderId:"PO-2024-002",supplierName:"Premium Building Materials",deliveryDate:"2024-09-06",expectedDate:"2024-09-06",status:"pending",items:8,totalValue:32e3,notes:"Awaiting dispatch confirmation"},{id:"3",deliveryNumber:"DEL-2024-003",purchaseOrderId:"PO-2024-003",supplierName:"Elite Construction Supplies",deliveryDate:"2024-09-03",expectedDate:"2024-09-03",status:"delivered",items:22,totalValue:67500,receivedBy:"Site Supervisor",notes:"All items received in good condition"}])}catch(e){k(e.response?.data?.error||"Failed to fetch deliveries"),b([])}finally{D(!1)}},F=()=>[m.PROCUREMENT,m.STORE_IN_CHARGE].includes(h?.role_id),q=e=>[m.PROCUREMENT,m.STORE_IN_CHARGE].includes(h?.role_id)&&"delivered"!==e.status,H=(()=>{let e=y;return S&&(e=e.filter(e=>e.deliveryNumber.toLowerCase().includes(S.toLowerCase())||e.purchaseOrderId.toLowerCase().includes(S.toLowerCase())||e.supplierName.toLowerCase().includes(S.toLowerCase()))),"all"!==V&&(e=e.filter(e=>e.status===V)),e})(),$=s=>{const t={pending:{color:"bg-yellow-100 text-yellow-700 border-yellow-300",icon:L},in_transit:{color:"bg-blue-100 text-blue-700 border-blue-300",icon:I},delivered:{color:"bg-green-100 text-green-700 border-green-300",icon:A},delayed:{color:"bg-red-100 text-red-700 border-red-300",icon:O},cancelled:{color:"bg-gray-100 text-gray-700 border-gray-300",icon:O}}[s],a=t.icon;return e.jsxs(n,{className:`${t.color} border flex items-center gap-1`,children:[e.jsx(a,{className:"w-3 h-3"}),s.replace("_"," ").toUpperCase()]})};return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx(N.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"bg-gradient-to-r from-red-50 to-red-100 rounded-xl shadow-xl p-6 text-gray-800 border border-red-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 bg-white/20 rounded-lg backdrop-blur",children:e.jsx(I,{className:"w-8 h-8"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Delivery Management"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Track and manage procurement deliveries"})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(a,{children:e.jsx(i,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Deliveries"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:H.length})]}),e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center",children:e.jsx(E,{className:"w-6 h-6 text-blue-600"})})]})})}),e.jsx(a,{children:e.jsx(i,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"In Transit"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:H.filter(e=>"in_transit"===e.status).length})]}),e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center",children:e.jsx(I,{className:"w-6 h-6 text-blue-600"})})]})})}),e.jsx(a,{children:e.jsx(i,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Delivered"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:H.filter(e=>"delivered"===e.status).length})]}),e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center",children:e.jsx(A,{className:"w-6 h-6 text-green-600"})})]})})}),e.jsx(a,{children:e.jsx(i,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Value"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:["AED ",H.reduce((e,s)=>e+s.totalValue,0).toLocaleString()]})]}),e.jsx("div",{className:"w-12 h-12 bg-gray-100 rounded-lg flex items-center justify-center",children:e.jsx("svg",{className:"w-6 h-6 text-gray-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})})]})})})]}),e.jsx(a,{children:e.jsx(i,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(T,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsx("input",{type:"text",placeholder:"Search by delivery number, PO, or supplier...",className:"w-full pl-10 pr-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",value:S,onChange:e=>U(e.target.value)})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{className:"px-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",value:V,onChange:e=>z(e.target.value),"aria-label":"Filter by status",title:"Filter by status",children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"in_transit",children:"In Transit"}),e.jsx("option",{value:"delivered",children:"Delivered"}),e.jsx("option",{value:"delayed",children:"Delayed"}),e.jsx("option",{value:"cancelled",children:"Cancelled"})]}),e.jsxs(c,{variant:"outline",className:"px-4",children:[e.jsx(_,{className:"w-4 h-4 mr-2"}),"More Filters"]}),e.jsxs(c,{variant:"outline",className:"px-4",children:[e.jsx(f,{className:"w-4 h-4 mr-2"}),"Export"]}),F()&&e.jsxs(c,{className:"bg-green-600 hover:bg-green-700",children:[e.jsx(P,{className:"w-4 h-4 mr-2"}),"New Delivery"]})]})]})})}),e.jsxs(a,{className:"shadow-lg border-0",children:[e.jsx(r,{className:"bg-gradient-to-r from-green-50 to-green-100 border-b",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(l,{className:"flex items-center gap-2",children:[e.jsx(E,{className:"w-5 h-5 text-green-600"}),"Deliveries"]}),e.jsxs("div",{className:"text-sm text-gray-600",children:[H.length," ",1===H.length?"delivery":"deliveries"]})]})}),e.jsx(i,{className:"p-0",children:w?e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx(x,{variant:"pulse-wave",size:"lg"}),e.jsx("span",{className:"ml-2 text-gray-600",children:"Loading deliveries..."})]}):C?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-red-500 mb-4",children:C}),e.jsx(c,{onClick:B,variant:"outline",children:"Try Again"})]}):0===H.length?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(I,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"No deliveries found"}),F()&&e.jsxs(c,{className:"bg-green-600 hover:bg-green-700",children:[e.jsx(P,{className:"w-4 h-4 mr-2"}),"Create First Delivery"]})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Delivery Number"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Purchase Order"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Supplier"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Expected Date"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Items"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Value"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:H.map((s,t)=>e.jsxs(N.tr,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.1*t},className:"hover:bg-gray-50 transition-colors duration-200",children:[e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"font-semibold text-green-600",children:s.deliveryNumber}),s.trackingNumber&&e.jsx("div",{className:"text-xs text-gray-500",children:s.trackingNumber})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-900",children:s.purchaseOrderId})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-900",children:s.supplierName})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm text-gray-900",children:s.expectedDate}),"delivered"===s.status&&s.deliveryDate&&e.jsxs("div",{className:"text-xs text-green-600",children:["Delivered: ",s.deliveryDate]})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"text-sm text-gray-900",children:[s.items," items"]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"text-sm font-semibold text-gray-900",children:["AED ",s.totalValue.toLocaleString()]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:$(s.status)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"text-blue-600 hover:text-blue-800",onClick:()=>{j(s),g(!0)},title:"View Delivery Details",children:e.jsx(R,{className:"w-4 h-4"})}),q(s)&&e.jsx("button",{className:"text-yellow-600 hover:text-yellow-800",onClick:()=>o(`/procurement/deliveries/edit/${s.id}`),title:"Edit Delivery",children:e.jsx(v,{className:"w-4 h-4"})})]})})]},s.id))})]})})})]}),e.jsx(M,{isOpen:u,onClose:()=>{g(!1),j(null)},documentType:"Delivery Note",documentData:p,onEdit:()=>{g(!1),p&&o(`/procurement/deliveries/edit/${p.id}`)}})]})};export{U as default};
