import{j as e}from"./radix-ui-34961435.js";import{r as s}from"./react-vendor-3707ac94.js";import{C as a,b as t,a as r}from"./card-e62b6216.js";import{a as i,B as n,M as l}from"./index-12cad093.js";import{T as c}from"./textarea-ff7bd289.js";import{D as o,a as d,b as x,c as m,d as p,e as j}from"./dialog-d443819a.js";import{L as h}from"./label-d100d551.js";import{m as u}from"./ui-vendor-42d562f2.js";import{Q as g,u as v,g as N,ag as f,E as w,ah as y,aA as b,i as _,v as R,k as C}from"./icons-2fde7931.js";const A=({purchase:A,onViewDetails:k,onViewHistory:P,onEdit:F,onApprove:z,onReject:E,onSendToEstimation:D,isLoading:S=!1,isApproving:q=!1,isRejecting:L=!1,isResending:M=!1,isEstimationRejected:H=!1})=>{const[O,T]=s.useState(!1),[$,Q]=s.useState(!1),[V,B]=s.useState(""),[G,I]=s.useState(""),J="completed"===A.latest_status?.status||"complete"===A.latest_status?.status||!0===A.accounts_acknowledgement||"completed"===A.current_workflow_status,K=(()=>{if(J)return{color:"bg-green-100 text-green-700",icon:e.jsx(_,{className:"h-4 w-4"}),text:"Completed"};switch(A.pm_status||"pending"){case"approved":return{color:"bg-green-100 text-green-700",icon:e.jsx(_,{className:"h-4 w-4"}),text:"PM Approved"};case"rejected":return{color:"bg-red-100 text-red-700",icon:e.jsx(R,{className:"h-4 w-4"}),text:"PM Rejected"};default:return{color:"bg-yellow-100 text-yellow-700",icon:e.jsx(C,{className:"h-4 w-4"}),text:"Pending PM Review"}}})(),U=!A.pm_status||"pending"===A.pm_status;(()=>{if(A.rejected_status&&"estimation"===A.rejected_status.sender&&"rejected"===A.rejected_status.status)return!0;const e=A.approvals?.some(e=>"estimation"===e.reviewer_role&&"rejected"===e.status),s=A.current_workflow_status?.includes("estimation_rejected")||"estimation"===A.status_role&&"rejected"===A.sender_latest_status||"estimation"===A.status_sender&&"rejected"===A.sender_latest_status})();return e.jsxs(e.Fragment,{children:[e.jsx(u.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},className:"h-full",children:e.jsxs(a,{className:"hover:shadow-lg transition-shadow duration-200 border-gray-200 h-full flex flex-col",children:[e.jsx(t,{className:"pb-1 pt-3 px-3",children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"font-semibold text-sm text-gray-900",children:["PR #",A.purchase_id]}),e.jsx(i,{className:`${K.color} text-[10px] px-1.5 py-0`,children:K.text})]}),e.jsxs("div",{className:"flex items-center gap-2 text-[10px] text-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-0.5",children:[e.jsx(g,{className:"h-2.5 w-2.5"}),e.jsx("span",{className:"truncate",children:A.site_location})]}),e.jsxs("div",{className:"flex items-center gap-0.5",children:[e.jsx(v,{className:"h-2.5 w-2.5"}),e.jsx("span",{children:(W=A.created_at||A.date,new Date(W).toLocaleDateString("en-AE",{year:"numeric",month:"short",day:"numeric"}))})]})]})]})}),e.jsxs(r,{className:"flex-1 flex flex-col px-3 pt-2 pb-3",children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("p",{className:"text-[10px] text-gray-600",children:"Purpose"}),e.jsx("p",{className:"text-xs font-medium text-gray-900 line-clamp-1",children:A.purpose})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-1.5 mb-2",children:[e.jsxs("div",{className:"bg-gray-50 rounded px-1.5 py-1",children:[e.jsxs("div",{className:"flex items-center gap-0.5",children:[e.jsx(N,{className:"h-2.5 w-2.5 text-gray-500"}),e.jsx("span",{className:"text-[10px] text-gray-600",children:"Qty"})]}),e.jsx("p",{className:"text-xs font-semibold text-gray-900",children:A.total_quantity||0})]}),e.jsxs("div",{className:"bg-gray-50 rounded px-1.5 py-1",children:[e.jsxs("div",{className:"flex items-center gap-0.5",children:[e.jsx(f,{className:"h-2.5 w-2.5 text-gray-500"}),e.jsx("span",{className:"text-[10px] text-gray-600",children:"Total"})]}),e.jsxs("p",{className:"text-xs font-semibold text-gray-900",children:["AED ",A.total_cost?A.total_cost.toLocaleString():"0"]})]})]}),e.jsxs("div",{className:"space-y-1.5 mt-auto pt-1",children:[e.jsxs("div",{className:"flex gap-1",children:[k&&e.jsxs(n,{variant:"outline",size:"sm",onClick:()=>k(A.purchase_id),className:"flex-1 h-6 text-[10px] px-2",disabled:S,children:[e.jsx(w,{className:"h-2.5 w-2.5 mr-0.5"}),"Details"]}),P&&e.jsxs(n,{variant:"outline",size:"sm",onClick:()=>P(A.purchase_id),className:"flex-1 h-6 text-[10px] px-2",disabled:S,children:[e.jsx(y,{className:"h-2.5 w-2.5 mr-0.5"}),"History"]})]}),(U||H)&&e.jsxs("div",{className:"flex gap-1",children:[e.jsx(n,{variant:"default",size:"sm",onClick:()=>{H?D&&D():T(!0)},className:`${H?"w-full":"flex-1"} h-6 text-[10px] px-2 ${H?"bg-blue-600 hover:bg-blue-700":"bg-green-600 hover:bg-green-700"}`,disabled:q||M,children:H?M?e.jsxs(e.Fragment,{children:[e.jsx(l,{variant:"pulse-wave",size:"sm"}),"Resending..."]}):e.jsxs(e.Fragment,{children:[e.jsx(b,{className:"h-2.5 w-2.5 mr-0.5"}),"Resend to Est"]}):q?e.jsxs(e.Fragment,{children:[e.jsx(l,{variant:"pulse-wave",size:"sm"}),"Approving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(_,{className:"h-2.5 w-2.5 mr-0.5"}),"Approve"]})}),!H&&e.jsx(n,{variant:"destructive",size:"sm",onClick:()=>Q(!0),className:"flex-1 h-6 text-[10px] px-2",disabled:L,children:L?e.jsxs(e.Fragment,{children:[e.jsx(l,{variant:"pulse-wave",size:"sm"}),"Rejecting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(R,{className:"h-2.5 w-2.5 mr-0.5"}),"Reject"]})})]})]})]})]})}),e.jsx(o,{open:O,onOpenChange:T,children:e.jsxs(d,{children:[e.jsxs(x,{children:[e.jsx(m,{children:"Approve Purchase Request"}),e.jsxs(p,{children:["Are you sure you want to approve Purchase #",A.purchase_id,"?"]})]}),e.jsxs("div",{className:"my-4",children:[e.jsx(h,{htmlFor:"approval-comments",children:"Comments (Optional)"}),e.jsx(c,{id:"approval-comments",placeholder:"Add any comments for this approval...",value:G,onChange:e=>I(e.target.value),className:"mt-2",rows:3})]}),e.jsxs(j,{children:[e.jsx(n,{variant:"outline",onClick:()=>T(!1),children:"Cancel"}),e.jsx(n,{onClick:()=>{T(!1),z&&z(),I("")},disabled:q,className:"bg-green-600 hover:bg-green-700",children:q?e.jsxs(e.Fragment,{children:[e.jsx(l,{variant:"pulse-wave",size:"sm"}),"Approving..."]}):"Approve"})]})]})}),e.jsx(o,{open:$,onOpenChange:Q,children:e.jsxs(d,{children:[e.jsxs(x,{children:[e.jsx(m,{children:"Reject Purchase Request"}),e.jsxs(p,{children:["Please provide a reason for rejecting Purchase #",A.purchase_id,"."]})]}),e.jsxs("div",{className:"my-4",children:[e.jsx(h,{htmlFor:"rejection-reason",children:"Rejection Reason *"}),e.jsx(c,{id:"rejection-reason",placeholder:"Enter the reason for rejection...",value:V,onChange:e=>B(e.target.value),className:"mt-2",rows:4,required:!0})]}),e.jsxs(j,{children:[e.jsx(n,{variant:"outline",onClick:()=>{B(""),Q(!1)},children:"Cancel"}),e.jsx(n,{onClick:()=>{V.trim()&&E&&(E(V),Q(!1),B(""))},disabled:!V.trim()||L,className:"bg-red-600 hover:bg-red-700",children:L?e.jsxs(e.Fragment,{children:[e.jsx(l,{variant:"pulse-wave",size:"sm"}),"Rejecting..."]}):"Reject"})]})]})})]});var W};export{A as P};
