import{j as e}from"./radix-ui-34961435.js";import{R as s,r as t}from"./react-vendor-3707ac94.js";import{T as a,a as r,b as l,c}from"./tabs-8d248749.js";import{a as i,B as n,M as d,t as m,A as o,c as x}from"./index-12cad093.js";import{I as p}from"./input-dbd0a11e.js";import{C as h,b as u,a as j,c as g}from"./card-e62b6216.js";import{S as N,a as f,b as y,c as v,d as b}from"./select-767f455e.js";import{e as _}from"./estimationService-c5e68334.js";import{m as w,A as C}from"./ui-vendor-42d562f2.js";import{F as S,Q as k,u as D,i as R,k as A,v as T,z as P,ag as L,g as F,ah as E,D as q,aA as M,aj as V,M as I,I as O,b as $,o as z,U as B,ak as H,c as Q,am as U,a8 as W,A as Y,az as Z,w as G,aB as J,e as K,aC as X,T as ee,N as se,X as te,af as ae,at as re,R as le}from"./icons-2fde7931.js";import{D as ce,a as ie,b as ne,c as de,d as me,e as oe}from"./dialog-d443819a.js";import{T as xe}from"./textarea-ff7bd289.js";import{R as pe,a as he}from"./radio-group-188286ff.js";import{L as ue}from"./label-d100d551.js";import{A as je,a as ge}from"./alert-409df19c.js";import{a as Ne}from"./dateFormatter-3b370b4b.js";import"./auth-f9290e45.js";import"./utils-8e4480a0.js";import"./forms-337f692b.js";const fe=s.forwardRef(({purchase:s,onApprove:t,onReject:a,onViewDetails:r,onViewHistory:l,isLoading:c=!1,isReadOnly:d=!1},m)=>{s.status_info?.pm_status||_.getPMStatus(s);const o=s.status_info?.estimation_status?.toLowerCase()||_.getEstimationStatus(s),x=s.total_cost||s.materials_summary?.total_cost||_.calculateTotalCost(s.materials),p=_.getCurrentWorkflowStatus(s),g="completed"===p.status||"completed"===s.latest_status?.status||"complete"===s.latest_status?.status||"completed"===s.status_info?.completed_status||!0===s.accounts_acknowledgement||!0===s.status_info?.accounts_acknowledgement||"accounts"===s.status_info?.receiver&&"acknowledged"===s.status_info?.accounts_status||"accounts"===s.status_info?.sender&&"acknowledged"===s.status_info?.accounts_status||"approved"===s.status_info?.td_status&&"accounts"===s.status_info?.receiver&&"approved"===s.status_info?.accounts_status||"accounts"===s.status_info?.sender&&"approved"===s.status_info?.status,N="estimation"===s.status_info?.receiver&&"technicalDirector"===s.status_info?.sender,f=!g&&("pending"===o||N);return _.hasResubmission(s),s.procurement_approved_status,e.jsx(w.div,{ref:m,initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,scale:.95},transition:{duration:.3},layout:!0,children:e.jsxs(h,{className:"hover:shadow-lg transition-all duration-300 h-full flex flex-col "+(g||"completed"===p.status?"ring-2 ring-blue-200 border-blue-300 bg-blue-50/30":"approved"===o?"ring-2 ring-green-200 border-green-300":"rejected"===o?"ring-2 ring-red-200 border-red-300":f?"ring-2 ring-amber-200 border-amber-300":"border-gray-200"),children:[e.jsx(u,{className:"pb-2 px-3 pt-3",children:e.jsxs("div",{className:"flex justify-between items-start gap-2",children:[e.jsxs("div",{className:"flex items-start gap-2 min-w-0 flex-1",children:[e.jsx(S,{className:"h-4 w-4 text-blue-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("h3",{className:"text-sm font-semibold text-gray-900",children:["Purchase #",s.purchase_id]}),e.jsxs("div",{className:"flex items-center gap-2 mt-0.5 text-xs text-gray-500",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(k,{className:"h-3 w-3"}),s.site_location]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(D,{className:"h-3 w-3"}),(v=s.date,new Date(v).toLocaleDateString("en-AE",{day:"numeric",month:"short",year:"numeric"}))]})]})]})]}),e.jsx("div",{className:"flex flex-col items-end gap-1 min-w-0 flex-shrink-0",children:g||"completed"===p.status?e.jsxs(i,{className:"bg-green-100 text-green-800 text-xs px-2 py-0.5",children:[e.jsx(R,{className:"h-3 w-3 mr-1"}),"Completed"]}):e.jsxs(e.Fragment,{children:[!f&&"pending"===p.status&&e.jsxs(i,{className:"bg-blue-100 text-blue-800 text-xs px-2 py-0.5 max-w-32 truncate",children:[e.jsx(A,{className:"h-3 w-3 mr-1 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:"Pending TD"})]}),!f&&"approved"===p.status&&e.jsxs(i,{className:"bg-green-100 text-green-800 text-xs px-2 py-0.5 max-w-32 truncate",children:[e.jsx(R,{className:"h-3 w-3 mr-1 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:"Approved"})]}),!f&&"rejected"===p.status&&e.jsxs(i,{className:"bg-red-100 text-red-800 text-xs px-2 py-0.5",children:[e.jsx(T,{className:"h-3 w-3 mr-1"}),p.label]}),N&&e.jsxs(i,{className:"bg-orange-100 text-orange-800 text-xs px-2 py-0.5 max-w-32 truncate",children:[e.jsx(P,{className:"h-3 w-3 mr-1 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:"TD Rejected"})]}),f&&!N&&e.jsx(i,{className:"bg-amber-100 text-amber-800 text-xs px-2 py-0.5 max-w-32 truncate",children:e.jsx("span",{className:"truncate",children:"Cost Analysis"})})]})})]})}),e.jsxs(j,{className:"px-3 py-2 space-y-2 flex-1 flex flex-col",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-gray-600 mb-0.5",children:"Purpose"}),e.jsx("p",{className:"text-xs text-gray-800 line-clamp-1",children:s.purpose})]}),e.jsxs("div",{className:"flex items-center justify-between py-1.5 px-2 bg-green-50 rounded",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(L,{className:"h-3 w-3 text-green-600"}),e.jsx("span",{className:"text-xs font-medium text-green-700",children:"Cost Analysis"})]}),e.jsx("span",{className:"text-sm font-bold text-green-600",children:(y=x,`AED ${y.toLocaleString()}`)})]}),s.materials&&s.materials.length>0&&e.jsxs("div",{className:"flex flex-wrap gap-0.5",children:[[...new Set(s.materials.map(e=>e.category))].slice(0,2).map((s,t)=>e.jsx(i,{variant:"outline",className:"text-[9px] px-1.5 py-0.5",children:s},t)),[...new Set(s.materials.map(e=>e.category))].length>2&&e.jsxs(i,{variant:"outline",className:"text-[9px] px-1.5 py-0.5",children:["+",[...new Set(s.materials.map(e=>e.category))].length-2]})]}),N&&s.status_info?.rejection_reason&&e.jsx("div",{className:"p-1.5 bg-orange-50 rounded border border-orange-200",children:e.jsxs("div",{className:"flex items-start gap-1.5",children:[e.jsx(P,{className:"h-3 w-3 text-orange-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs font-medium text-orange-800",children:"TD Rejection Reason:"}),e.jsx("p",{className:"text-xs text-orange-700 mt-0.5",children:s.status_info.rejection_reason})]})]})}),e.jsx("div",{className:"flex-1"}),f&&!d&&e.jsx("div",{className:"space-y-1.5 pt-2 mt-auto border-t border-gray-100",children:e.jsxs("div",{className:"flex gap-1.5",children:[e.jsxs(n,{onClick:()=>t(s.purchase_id),disabled:c,className:"flex-1 bg-green-600 hover:bg-green-700 text-white h-7 text-xs font-medium flex items-center justify-center",children:[e.jsx(R,{className:"h-3 w-3 mr-1"}),N?"Re-approve":"Approve"]}),e.jsxs(n,{onClick:()=>a(s.purchase_id),disabled:c,variant:"outline",className:"flex-1 border-red-200 text-red-600 hover:bg-red-50 hover:border-red-300 h-7 text-xs font-medium flex items-center justify-center",children:[e.jsx(T,{className:"h-3 w-3 mr-1"}),"Reject"]})]})}),!f&&"pending"!==o&&e.jsx("div",{className:"pt-1.5 mt-auto border-t border-gray-100",children:e.jsx("div",{className:"text-center py-1.5 rounded "+("approved"===o?"bg-green-50 text-green-700":"rejected"===o?"bg-red-50 text-red-700":"bg-gray-50 text-gray-700"),children:e.jsx("div",{className:"flex items-center justify-center gap-1 text-xs font-medium",children:"approved"===o?e.jsxs(e.Fragment,{children:[e.jsx(R,{className:"h-3 w-3"}),e.jsx("span",{children:"Approved"})]}):"rejected"===o?e.jsxs(e.Fragment,{children:[e.jsx(T,{className:"h-3 w-3"}),e.jsx("span",{children:"Rejected"})]}):null})})}),e.jsxs("div",{className:"flex gap-1.5 mt-1.5",children:[e.jsxs(n,{onClick:()=>r?r(s.purchase_id):null,variant:"outline",className:"flex-1 h-7 text-xs font-medium border-gray-200 hover:bg-gray-50 flex items-center justify-center",disabled:c,children:[e.jsx(F,{className:"h-3 w-3 mr-1"}),"Details"]}),e.jsxs(n,{onClick:()=>l?l(s.purchase_id):null,variant:"outline",className:"flex-1 h-7 text-xs font-medium border-gray-200 hover:bg-gray-50 flex items-center justify-center",disabled:c,children:[e.jsx(E,{className:"h-3 w-3 mr-1"}),"History"]})]})]})]})});var y,v});fe.displayName="EstimationApprovalCard";const ye=({isOpen:s,onClose:a,purchaseId:r,mode:l,onSuccess:c})=>{const[i,o]=t.useState(""),[x,p]=t.useState("cost"),[h,u]=t.useState(""),[j,g]=t.useState(!1),N=()=>{o(""),p("cost"),u(""),a()},f=()=>"approve"===l?"Approve Purchase Request":"Reject Purchase Request";return e.jsx(ce,{open:s,onOpenChange:N,children:e.jsxs(ie,{className:"sm:max-w-[550px] max-h-[90vh] flex flex-col",children:[e.jsxs(ne,{className:"flex-shrink-0",children:[e.jsx(de,{className:"flex items-center gap-2",children:"approve"===l?e.jsxs(e.Fragment,{children:[e.jsx(R,{className:"h-5 w-5 text-green-600"}),f()]}):e.jsxs(e.Fragment,{children:[e.jsx(T,{className:"h-5 w-5 text-red-600"}),f()]})}),e.jsx(me,{children:"approve"===l?"This will approve the purchase and forward it to the Technical Director for final review.":"Select the rejection type and provide a reason. The purchase will be sent back for revision."})]}),e.jsxs("div",{className:"space-y-4 py-4 overflow-y-auto flex-1 px-1",children:[e.jsx("div",{className:"bg-gray-50 p-2.5 sm:p-3 rounded-lg",children:e.jsxs("p",{className:"text-xs sm:text-sm font-medium text-gray-700",children:["Purchase ID: ",e.jsxs("span",{className:"text-base sm:text-lg font-semibold text-gray-900",children:["#",r]})]})}),"reject"===l&&e.jsxs("div",{className:"space-y-2 sm:space-y-3",children:[e.jsx(ue,{className:"text-xs sm:text-sm font-medium",children:"Rejection Type"}),e.jsxs(pe,{value:x,onValueChange:e=>p(e),children:[e.jsxs("div",{className:"flex items-start space-x-2 sm:space-x-3 p-2.5 sm:p-3 border rounded-lg hover:bg-gray-50 transition-colors",children:[e.jsx(he,{value:"cost",id:"cost",className:"mt-0.5 sm:mt-1"}),e.jsxs(ue,{htmlFor:"cost",className:"flex-1 cursor-pointer",children:[e.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2 text-xs sm:text-sm font-medium",children:[e.jsx(L,{className:"h-3.5 w-3.5 sm:h-4 sm:w-4 text-amber-600 flex-shrink-0"}),"Cost Issue"]}),e.jsx("p",{className:"text-[10px] sm:text-xs text-gray-600 mt-0.5 sm:mt-1",children:"Budget concerns, pricing issues, or cost optimization needed. Will be sent back to Procurement team."})]})]}),e.jsxs("div",{className:"flex items-start space-x-2 sm:space-x-3 p-2.5 sm:p-3 border rounded-lg hover:bg-gray-50 transition-colors",children:[e.jsx(he,{value:"pm_flag",id:"pm_flag",className:"mt-0.5 sm:mt-1"}),e.jsxs(ue,{htmlFor:"pm_flag",className:"flex-1 cursor-pointer",children:[e.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2 text-xs sm:text-sm font-medium",children:[e.jsx(q,{className:"h-3.5 w-3.5 sm:h-4 sm:w-4 text-blue-600 flex-shrink-0"}),"PM Flag Issue"]}),e.jsx("p",{className:"text-[10px] sm:text-xs text-gray-600 mt-0.5 sm:mt-1",children:"Project specifications, scope, or requirements need clarification. Will be sent back to Project Manager."})]})]})]})]}),"reject"===l&&e.jsxs("div",{className:"space-y-1.5 sm:space-y-2",children:[e.jsxs(ue,{htmlFor:"rejection-reason",className:"text-xs sm:text-sm font-medium",children:["Rejection Reason ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(xe,{id:"rejection-reason",placeholder:"Provide a clear reason for rejection (minimum 10 characters)...",value:h,onChange:e=>u(e.target.value.slice(0,500)),rows:3,className:"resize-none text-xs sm:text-sm",required:!0}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("p",{className:"text-[10px] sm:text-xs text-gray-500",children:[h.length,"/500 characters (minimum 10)"]}),h.length<10&&h.length>0&&e.jsx("p",{className:"text-[10px] sm:text-xs text-red-500",children:"Too short"})]})]}),e.jsxs("div",{className:"space-y-1.5 sm:space-y-2",children:[e.jsxs(ue,{htmlFor:"comments",className:"text-xs sm:text-sm font-medium",children:["Additional Comments ","reject"===l&&"(Optional)"]}),e.jsx(xe,{id:"comments",placeholder:"approve"===l?"Add any notes or conditions for the Technical Director...":"Add any additional context or suggestions...",value:i,onChange:e=>o(e.target.value.slice(0,1e3)),rows:3,className:"resize-none text-xs sm:text-sm"}),e.jsxs("p",{className:"text-[10px] sm:text-xs text-gray-500",children:[i.length,"/1000 characters"]})]}),e.jsxs(je,{className:"approve"===l?"border-green-200 bg-green-50":"border-amber-200 bg-amber-50",children:[e.jsx(P,{className:"h-4 w-4"}),e.jsx(ge,{children:"approve"===l?e.jsxs(e.Fragment,{children:["Approving this purchase will forward it to the ",e.jsx("strong",{children:"Technical Director"})," for final review and approval. An email notification will be sent automatically."]}):e.jsx(e.Fragment,{children:"cost"===x?e.jsxs(e.Fragment,{children:["Rejecting for cost issues will send this back to the ",e.jsx("strong",{children:"Procurement team"})," for revision. They will need to address the cost concerns before resubmitting."]}):e.jsxs(e.Fragment,{children:["Rejecting for PM flag issues will send this back to the ",e.jsx("strong",{children:"Project Manager"})," for clarification. They will need to address the concerns before resubmitting."]})})})]})]}),e.jsxs(oe,{className:"flex-shrink-0 border-t pt-4",children:[e.jsx(n,{variant:"outline",onClick:N,disabled:j,children:"Cancel"}),e.jsx(n,{onClick:async()=>{if(r){if("reject"===l){if(!h.trim())return void m.error("Please provide a rejection reason");if(h.trim().length<10)return void m.error("Rejection reason must be at least 10 characters")}g(!0);try{let e;if("approve"===l)e=await _.submitApproval(r,i),m.success("Purchase approved and sent to Technical Director");else{e=await _.submitRejection(r,x,h,i);const s="cost"===x?"Procurement":"Project Manager";m.success(`Purchase rejected and sent back to ${s}`)}e.email_warning&&m.warning(e.email_warning),c&&c(),N()}catch(e){const s=e.response?.data?.error||"Failed to submit decision";s.toLowerCase().includes("already approved")?(m.warning("This purchase has already been approved"),c&&c(),N()):m.error(s)}finally{g(!1)}}},disabled:j||"reject"===l&&!h.trim(),className:"approve"===l?"bg-green-600 hover:bg-green-700":"bg-red-600 hover:bg-red-700",children:j?e.jsxs(e.Fragment,{children:[e.jsx(d,{variant:"pulse-wave",size:"lg"}),"Processing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(M,{className:"mr-2 h-4 w-4"}),"approve"===l?"Approve & Send to TD":"Reject & Send Back"]})})]})]})})},ve=({isOpen:s,onClose:p,purchaseId:h,showHistoryOnly:u=!1})=>{const[j,g]=t.useState(!1),[N,f]=t.useState(null),[y,v]=t.useState("overview"),[b,w]=t.useState(!1);t.useEffect(()=>{s&&h&&(C(),v("overview"))},[s,h,u]);const C=async()=>{if(h)try{g(!0);const e=u?await _.getPurchaseHistory(h):await _.getPurchaseDetails(h);if(u){const s=e.purchase||{},t=s.approvals?.action||[],a=t.filter(e=>"procurement"===e.role||"procurement"===e.sender),r=t.filter(e=>"projectManager"===e.role||"projectManager"===e.sender),l=t.filter(e=>"estimation"===e.role||"estimation"===e.sender),c=t.filter(e=>"technicalDirector"===e.role||"technicalDirector"===e.sender),i=t.filter(e=>"accounts"===e.role||"accounts"===e.sender),n=t.length>0?t[t.length-1]:{},d={purchase_id:s.purchase_id,purchase_details:{site_location:s.site_location||"Not specified",purpose:s.purpose||"Not specified",created_at:s.created_at,date:s.date,requested_by:s.requested_by||"Not specified",project_id:s.project_id,email_sent:s.email_sent||!1,file_path:s.file_path||null,materials_summary:{total_materials:s.materials?.length||0,total_quantity:s.materials?.reduce((e,s)=>e+(s.quantity||0),0)||0,total_cost:s.materials?.reduce((e,s)=>e+(s.quantity||0)*(s.cost||0),0)||0,categories:[...new Set(s.materials?.map(e=>e.category).filter(Boolean)||[])],materials:s.materials||[]}},latest_pm_proc_status:{status:n.status||s.status||"pending",sender:n.sender,receiver:n.receiver,role:n.role,comments:n.comments,rejection_reason:n.rejection_reason},procurement_statuses:a.map(e=>({...e,date:e.timestamp||e.created_at||e.decision_date})),project_manager_statuses:r.map(e=>({...e,date:e.timestamp||e.created_at||e.decision_date})),estimation_statuses:l.map(e=>({...e,date:e.timestamp||e.created_at||e.decision_date})),technical_director_statuses:c.map(e=>({...e,date:e.timestamp||e.created_at||e.decision_date})),accounts_statuses:i.map(e=>({...e,date:e.timestamp||e.created_at||e.decision_date})),summary:{total_procurement_statuses:a.length,total_pm_statuses:r.length,total_estimation_statuses:l.length,total_technical_director_statuses:c.length,total_accounts_statuses:i.length,pm_approved_count:r.filter(e=>"approved"===e.status).length}};f(d)}else{const s=e.purchase||{},t=e.latest_status||{},a={purchase_id:s.purchase_id,purchase_details:{site_location:s.site_location||"Not specified",purpose:s.purpose||"Not specified",created_at:s.created_at,date:s.date,requested_by:s.requested_by||"Not specified",project_id:s.project_id,email_sent:s.email_sent||!1,file_path:s.file_path||null,materials_summary:{total_materials:s.materials?.length||0,total_quantity:s.materials?.reduce((e,s)=>e+(s.quantity||0),0)||0,total_cost:s.materials?.reduce((e,s)=>e+(s.quantity||0)*(s.cost||0),0)||0,categories:[...new Set(s.materials?.map(e=>e.category).filter(Boolean)||[])],materials:s.materials||[]}},latest_pm_proc_status:{status:t.status||"pending",sender:t.sender,receiver:t.receiver,role:t.role,comments:t.comments,rejection_reason:t.rejection_reason},procurement_statuses:[],project_manager_statuses:[],estimation_statuses:[],summary:{total_procurement_statuses:0,total_pm_statuses:0,total_estimation_statuses:0,pm_approved_count:0}};f(a)}}catch(e){m.error("Failed to load purchase details")}finally{g(!1)}},P=e=>e?Ne(e):"N/A",E=e=>`AED ${e.toLocaleString()}`,q=e=>{switch(e?.toLowerCase()){case"approved":return"bg-green-100 text-green-800 border-green-200";case"rejected":return"bg-red-100 text-red-800 border-red-200";case"pending":return"bg-yellow-100 text-yellow-800 border-yellow-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},M=s=>{switch(s?.toLowerCase()){case"approved":return e.jsx(R,{className:"w-5 h-5 text-green-600"});case"rejected":return e.jsx(T,{className:"w-5 h-5 text-red-600"});case"pending":return e.jsx(A,{className:"w-5 h-5 text-yellow-600"});default:return e.jsx(A,{className:"w-5 h-5 text-gray-600"})}},J=e=>({projectManager:"Project Manager",procurement:"Procurement",estimation:"Estimation",technicalDirector:"Technical Director",accounts:"Accounts",siteSupervisor:"Site Supervisor",mepSupervisor:"MEP Supervisor",design:"Design"}[e]||e),K=[...N?.procurement_statuses||[],...N?.project_manager_statuses||[],...N?.estimation_statuses||[],...N?.technical_director_statuses||[],...N?.accounts_statuses||[]].sort((e,s)=>(e?.timestamp?new Date(e.timestamp).getTime():e?.date?new Date(e.date).getTime():0)-(s?.timestamp?new Date(s.timestamp).getTime():s?.date?new Date(s.date).getTime():0)),X=N?.latest_pm_proc_status?.status||"pending";return s?e.jsx(ce,{open:s,onOpenChange:p,children:e.jsxs(ie,{className:"max-w-5xl max-h-[90vh] overflow-hidden p-0 bg-white",children:[e.jsx(ne,{className:"px-6 py-4 bg-gradient-to-r from-[#243d8a]/5 to-[#243d8a]/10 shadow-lg border-b border-[#243d8a]/20",children:e.jsxs(de,{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-[#243d8a]/10 backdrop-blur rounded-lg",children:e.jsx(S,{className:"w-5 h-5 text-[#243d8a]"})}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h2",{className:"text-[#243d8a] text-lg font-semibold",children:"Purchase Request Details"}),e.jsxs(i,{className:"bg-[#243d8a]/10 text-[#243d8a] px-3 py-1",children:[e.jsx(V,{className:"w-3 h-3 mr-1"}),"PR-",N?.purchase_id||h]}),N&&"completed"===X&&e.jsxs(i,{className:"bg-green-100 text-green-700 px-3 py-1",children:[e.jsx(A,{className:"w-3 h-3 mr-1"}),"COMPLETED"]})]})]}),e.jsx("div",{className:"flex items-center gap-2"})]})}),e.jsx("div",{className:"flex-1 overflow-hidden",children:j?e.jsxs("div",{className:"flex flex-col justify-center items-center py-16",children:[e.jsx(d,{variant:"pulse-wave",size:"lg"}),e.jsx("p",{className:"text-gray-600 font-medium mt-4",children:"Loading purchase details..."})]}):N?e.jsx(e.Fragment,{children:u?e.jsxs("div",{className:"p-6 max-h-[calc(90vh-200px)] overflow-y-auto scrollbar-hide [&::-webkit-scrollbar]:hidden [-ms-overflow-style:none] [scrollbar-width:none]",children:[e.jsx("div",{className:"bg-gray-50 px-6 py-4 border-b border-gray-200 mb-6",children:e.jsxs("div",{className:"grid grid-cols-3 gap-8",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(F,{className:"h-5 w-5 text-blue-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-900 mb-2",children:"Purchase Details"}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Purpose:"}),e.jsx("span",{className:"text-sm text-gray-900 flex-1",children:N?.purchase_details?.purpose||"Not specified"})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Location:"}),e.jsx("span",{className:"text-sm text-gray-900",children:N?.purchase_details?.site_location||"Not specified"})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Project:"}),e.jsxs("span",{className:"text-sm text-gray-900",children:["#",N?.purchase_details?.project_id||"N/A"]})]})]})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 bg-purple-100 rounded-lg",children:e.jsx(B,{className:"h-5 w-5 text-purple-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-900 mb-2",children:"Request Info"}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Requested by:"}),e.jsx("span",{className:"text-sm text-gray-900 flex-1",children:N?.purchase_details?.requested_by||"N/A"})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Date:"}),e.jsx("span",{className:"text-sm text-gray-900",children:N?.purchase_details?.date?Ne(N.purchase_details.date):"N/A"})]})]})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 bg-purple-100 rounded-lg",children:e.jsx($,{className:"h-5 w-5 text-purple-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-900 mb-2",children:"Timeline Stats"}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Total Steps:"}),e.jsx("span",{className:"text-sm text-gray-900",children:K.length})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Approvals:"}),e.jsx("span",{className:"text-sm text-green-600 font-medium",children:K.filter(e=>"approved"===e.status||"completed"===e.status).length})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Rejections:"}),e.jsx("span",{className:"text-sm text-red-600 font-medium",children:K.filter(e=>"rejected"===e.status).length})]})]})]})]})]})}),e.jsx("h2",{className:"text-xl font-semibold mb-6 text-center",children:"Approval History"}),K.length>0?e.jsx("div",{className:"space-y-4",children:K.map((s,t)=>e.jsxs("div",{className:"relative",children:[t<K.length-1&&e.jsx("div",{className:"absolute left-6 top-12 bottom-0 w-0.5 bg-gray-200"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center "+("approved"===s.status?"bg-green-100":"rejected"===s.status?"bg-red-100":"completed"===s.status||"complete"===s.status?"bg-blue-100":"bg-yellow-100"),children:"completed"===s.status||"complete"===s.status?e.jsx(R,{className:"h-5 w-5 text-blue-600"}):M(s.status)})}),e.jsxs("div",{className:"flex-1 bg-white border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:J(s.role)}),e.jsx(i,{className:`${"completed"===s.status||"complete"===s.status?"bg-blue-100 text-blue-700":q(s.status)} border uppercase`,children:s.status})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-2",children:[(s.decided_by||s.decision_by?.full_name)&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase",children:"Decided By"}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:s.decided_by||s.decision_by?.full_name})]}),(s.sender||s.receiver)&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase",children:"Workflow"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-sm text-gray-700",children:s.sender?.replace(/([A-Z])/g," $1").trim().replace("project Manager","Project Manager").replace("technical Director","Technical Director")}),s.sender&&s.receiver&&e.jsxs(e.Fragment,{children:[e.jsx(Y,{className:"h-3 w-3 text-gray-400"}),e.jsx("span",{className:"text-sm text-gray-700",children:s.receiver?.replace(/([A-Z])/g," $1").trim().replace("project Manager","Project Manager").replace("technical Director","Technical Director")})]})]})]})]}),s.comments&&e.jsx("div",{className:"bg-blue-50 border-l-4 border-blue-400 p-3 rounded mt-3",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(Z,{className:"w-4 h-4 text-blue-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-blue-900",children:"Comments"}),e.jsx("p",{className:"text-sm text-blue-800",children:s.comments})]})]})}),s.rejection_reason&&e.jsx("div",{className:"bg-red-50 border-l-4 border-red-400 p-3 rounded mt-3",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(G,{className:"w-4 h-4 text-red-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-red-900",children:"Rejection Reason"}),e.jsx("p",{className:"text-sm text-red-800",children:s.rejection_reason}),s.reject_category&&e.jsx(i,{className:"bg-red-100 text-red-700 mt-2",children:s.reject_category})]})]})}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:P(s.timestamp||s.date||s.created_at)})]})]})]},t))}):e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx(A,{className:"w-16 h-16 mx-auto mb-4 text-gray-300"}),e.jsx("p",{className:"text-lg",children:"No history available"})]})]}):e.jsxs("div",{className:"w-full",children:[e.jsx("div",{className:"px-6 py-4 bg-gray-50",children:e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsx("div",{className:"bg-white rounded-lg p-4 border border-gray-200",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Total Amount"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:E(N?.purchase_details?.materials_summary?.total_cost||0)})]}),e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(L,{className:"w-5 h-5 text-blue-600"})})]})}),e.jsx("div",{className:"bg-white rounded-lg p-4 border border-gray-200",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Materials"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:[N?.purchase_details?.materials_summary?.total_materials||0," Items"]})]}),e.jsx("div",{className:"p-2 bg-purple-100 rounded-lg",children:e.jsx(F,{className:"w-5 h-5 text-purple-600"})})]})}),e.jsx("div",{className:"bg-white rounded-lg p-4 border border-gray-200",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Email Status"}),e.jsxs(i,{className:N?.purchase_details?.email_sent?"bg-green-100 text-green-700 border-green-200 px-3 py-1":"bg-gray-100 text-gray-700 border-gray-200 px-3 py-1",children:[e.jsx(R,{className:"w-4 h-4 mr-1"}),N?.purchase_details?.email_sent?"Sent":"Not Sent"]})]}),e.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:e.jsx(I,{className:"w-5 h-5 text-green-600"})})]})})]})}),e.jsxs(a,{value:y,onValueChange:v,className:"w-full",children:[e.jsx("div",{className:"bg-white border-b",children:e.jsxs(r,{className:"flex justify-start gap-8 bg-transparent p-0 h-auto px-6",children:[e.jsxs(l,{value:"overview",className:"data-[state=active]:border-b-2 data-[state=active]:border-blue-500 data-[state=active]:text-blue-600 border-b-2 border-transparent rounded-none pb-3 pt-3 font-medium transition-all hover:text-blue-500",children:[e.jsx(O,{className:"w-4 h-4 mr-2"}),"Details"]}),e.jsxs(l,{value:"materials",className:"data-[state=active]:border-b-2 data-[state=active]:border-blue-500 data-[state=active]:text-blue-600 border-b-2 border-transparent rounded-none pb-3 pt-3 font-medium transition-all hover:text-blue-500",children:[e.jsx(F,{className:"w-4 h-4 mr-2"}),"Materials"]}),e.jsxs(l,{value:"latest",className:"data-[state=active]:border-b-2 data-[state=active]:border-blue-500 data-[state=active]:text-blue-600 border-b-2 border-transparent rounded-none pb-3 pt-3 font-medium transition-all hover:text-blue-500",children:[e.jsx($,{className:"w-4 h-4 mr-2"}),"Latest Status"]})]})}),e.jsxs("div",{className:"p-6 max-h-[calc(90vh-200px)] overflow-y-auto scrollbar-hide [&::-webkit-scrollbar]:hidden [-ms-overflow-style:none] [scrollbar-width:none]",children:[e.jsxs(c,{value:"overview",className:"mt-0 space-y-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(O,{className:"w-5 h-5 text-gray-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"Basic Information"})]}),e.jsxs("div",{className:"bg-white rounded-lg p-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-x-12 gap-y-6",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(z,{className:"w-4 h-4 text-gray-400"}),e.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wider",children:"PROJECT ID"})]}),e.jsx("p",{className:"text-base font-semibold text-gray-900",children:N.purchase_details?.project_id||"N/A"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(B,{className:"w-4 h-4 text-gray-400"}),e.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wider",children:"REQUESTED BY"})]}),e.jsx("p",{className:"text-base font-semibold text-gray-900",children:N.purchase_details?.requested_by})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(k,{className:"w-4 h-4 text-gray-400"}),e.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wider",children:"SITE LOCATION"})]}),e.jsx("p",{className:"text-base font-semibold text-gray-900",children:N.purchase_details?.site_location})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(D,{className:"w-4 h-4 text-gray-400"}),e.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wider",children:"REQUEST DATE"})]}),e.jsx("p",{className:"text-base font-semibold text-gray-900",children:P(N.purchase_details?.date||N.purchase_details?.created_at)})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(H,{className:"w-4 h-4 text-gray-400"}),e.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wider",children:"CREATED BY"})]}),e.jsx("p",{className:"text-base font-semibold text-gray-900",children:N.purchase_details?.requested_by})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(I,{className:"w-4 h-4 text-gray-400"}),e.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wider",children:"EMAIL STATUS"})]}),e.jsxs(i,{className:N.purchase_details?.email_sent?"bg-green-100 text-green-700 border-green-200 px-3 py-1":"bg-gray-100 text-gray-700 border-gray-200 px-3 py-1",children:[e.jsx(R,{className:"w-4 h-4 mr-1"}),N.purchase_details?.email_sent?"Sent":"Not Sent"]})]})]})]}),e.jsxs("div",{className:"mt-6 pt-6 border-t border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Q,{className:"w-4 h-4 text-gray-400"}),e.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wider",children:"PURPOSE"})]}),e.jsx("p",{className:"text-base font-semibold text-gray-900",children:N.purchase_details?.purpose})]})]})]}),N.purchase_details?.file_path&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(U,{className:"w-5 h-5 text-gray-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"Attachment"})]}),e.jsx("div",{className:"bg-white rounded-lg p-6",children:e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(S,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:N.purchase_details.file_path.split("/").pop()||"Purchase Document"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Click to download the attached document"})]})]}),e.jsx(n,{onClick:async()=>{if(N?.purchase_id){w(!0);try{m.info("Fetching attachment...");const e=await fetch(`${o}${x.DOWNLOAD_FILES("estimation",N.purchase_id)}`,{headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`}}),s=await e.json();if(s.success&&s.purchase_files&&s.purchase_files.length>0){const e=s.purchase_files[0],t=e.public_url||`${o}/download_file/${e.file_path}`,a=document.createElement("a");a.href=t,a.download=e.file_path?.split("/").pop()||"attachment",a.style.display="none",document.body.appendChild(a),a.click(),document.body.removeChild(a),m.success("Downloading attachment...")}else s.accounts_files&&s.accounts_files.length>0?m.info("This purchase has accounts-related files. Please check with the Accounts department."):m.warning("No attachments found for this purchase.")}catch(e){if(N.purchase_details?.file_path){try{const e=await fetch(`${o}/api/get_file_url/${N.purchase_id}`,{headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`}});if(e.ok){const s=await e.json();if(s.public_url){const e=document.createElement("a");return e.href=s.public_url,e.download=N.purchase_details.file_path?.split("/").pop()||"attachment",e.style.display="none",document.body.appendChild(e),e.click(),document.body.removeChild(e),void m.info("Downloading attachment...")}}}catch(s){}const e=`${o}/uploads/${N.purchase_details.file_path}`,t=N.purchase_details.file_path.split("/").pop()||"attachment",a=document.createElement("a");a.href=e,a.download=t,a.style.display="none",document.body.appendChild(a),a.click(),document.body.removeChild(a),m.info("Downloading attachment...")}else m.error("Failed to download attachment. Please try again later.")}finally{w(!1)}}},variant:"outline",size:"sm",disabled:b,className:"border-blue-200 text-blue-600 hover:bg-blue-50 hover:border-blue-300",children:b?e.jsxs(e.Fragment,{children:[e.jsx(d,{variant:"pulse-wave",size:"lg"}),"Downloading..."]}):e.jsxs(e.Fragment,{children:[e.jsx(W,{className:"w-4 h-4 mr-2"}),"Download"]})})]})})]})]}),e.jsxs(c,{value:"materials",className:"mt-0 space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Materials List"}),N.purchase_details?.materials_summary?.materials&&N.purchase_details.materials_summary.materials.length>0?e.jsxs("div",{className:"space-y-4",children:[N.purchase_details.materials_summary.materials.map((s,t)=>e.jsxs("div",{className:"bg-gray-50 rounded-lg p-5",children:[e.jsx("div",{className:"mb-3",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-900 text-base",children:s.description||`Material ${t+1}`}),s.specification&&e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:s.specification})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[s.category&&e.jsx(i,{className:"bg-blue-100 text-blue-700 border-0",children:s.category}),s.priority&&e.jsx(i,{className:"high"===s.priority?"bg-red-100 text-red-700 border-0":"medium"===s.priority?"bg-yellow-100 text-yellow-700 border-0":"bg-green-100 text-green-700 border-0",children:s.priority.toUpperCase()})]})]})}),e.jsxs("div",{className:"grid grid-cols-3 gap-6 pt-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase mb-1",children:"Quantity:"}),e.jsxs("p",{className:"font-semibold text-gray-900",children:[s.quantity," ",s.unit]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase mb-1",children:"Unit Cost:"}),e.jsx("p",{className:"font-semibold text-green-600",children:E(s.cost||0)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase mb-1",children:"Total:"}),e.jsx("p",{className:"font-semibold text-green-600 text-lg",children:E((s.quantity||0)*(s.cost||0))})]})]})]},s.material_id||t)),e.jsx("div",{className:"border-t-2 pt-4 mt-6",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-lg font-semibold text-gray-900",children:"Grand Total:"}),e.jsx("span",{className:"text-2xl font-bold text-green-600",children:E(N.purchase_details?.materials_summary?.total_cost||0)})]})})]}):e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx(F,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{children:"No materials found"})]})]}),e.jsxs(c,{value:"latest",className:"mt-0 space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(O,{className:"w-5 h-5 text-gray-600"}),e.jsx("h3",{className:"text-lg font-semibold",children:"Latest Information"})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-5",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700 uppercase mb-4",children:"Purchase Details"}),e.jsxs("div",{className:"grid grid-cols-2 gap-x-8 gap-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Purchase ID:"}),e.jsxs("span",{className:"text-sm font-medium text-gray-900",children:["PR-",N.purchase_id]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Request Date:"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:P(N.purchase_details?.date||N.purchase_details?.created_at)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Site Location:"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:N.purchase_details?.site_location})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Project ID:"}),e.jsxs("span",{className:"text-sm font-medium text-gray-900",children:["#",N.purchase_details?.project_id||"N/A"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Created By:"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:N.purchase_details?.requested_by||"N/A"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Email Sent:"}),e.jsx(i,{className:N.purchase_details?.email_sent?"bg-green-100 text-green-700":"bg-gray-100 text-gray-700",children:N.purchase_details?.email_sent?"Yes":"No"})]}),N.purchase_details?.materials_summary?.categories?.length>0&&e.jsx("div",{className:"col-span-2",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Categories:"}),e.jsx("div",{className:"flex flex-wrap gap-2 justify-end",children:N.purchase_details.materials_summary.categories.map(s=>e.jsx(i,{variant:"outline",className:"text-xs",children:s},s))})]})}),e.jsx("div",{className:"col-span-2",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Purpose:"}),e.jsx("span",{className:"text-sm font-medium text-gray-900 text-right max-w-xs",children:N.purchase_details?.purpose})]})})]})]}),N.latest_pm_proc_status&&e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-5",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700 uppercase mb-4",children:"Latest Status Information"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-x-8 gap-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Status:"}),e.jsx(i,{className:`${q(N.latest_pm_proc_status.status)} uppercase`,children:N.latest_pm_proc_status.status})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Role:"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:J(N.latest_pm_proc_status.role||"")})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"From:"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:J(N.latest_pm_proc_status.sender||"")})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"To:"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:J(N.latest_pm_proc_status.receiver||"")})]})]}),N.latest_pm_proc_status.comments&&e.jsxs("div",{className:"border-t pt-3 mt-3",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Comments:"}),e.jsx("div",{className:"bg-blue-50 p-3 rounded-md",children:e.jsx("p",{className:"text-sm font-medium text-gray-900",children:N.latest_pm_proc_status.comments})})]}),N.latest_pm_proc_status.rejection_reason&&e.jsxs("div",{className:"border-t pt-3 mt-3",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Rejection Reason:"}),e.jsx("div",{className:"bg-red-50 p-3 rounded-md",children:e.jsx("p",{className:"text-sm font-medium text-red-700",children:N.latest_pm_proc_status.rejection_reason})})]}),N.latest_pm_proc_status.reject_category&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Reject Category:"}),e.jsx(i,{variant:"destructive",children:N.latest_pm_proc_status.reject_category})]})]})]}),N.purchase_details?.materials_summary&&e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-5",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700 uppercase mb-4",children:"Materials Summary"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:N.purchase_details.materials_summary.total_materials||0}),e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"Total Items"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-green-600",children:N.purchase_details.materials_summary.total_quantity||0}),e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"Total Quantity"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xl font-bold text-green-600",children:E(N.purchase_details.materials_summary.total_cost||0)}),e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"Total Value"})]})]})]}),(N.purchase_details?.created_at||N.purchase_details?.last_modified_at)&&e.jsx("div",{className:"bg-gray-50 rounded-lg p-4 text-sm",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[N.purchase_details?.created_at&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Created At: "}),e.jsx("span",{className:"font-medium",children:P(N.purchase_details.created_at)})]}),N.purchase_details?.last_modified_at&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Last Modified: "}),e.jsx("span",{className:"font-medium",children:P(N.purchase_details.last_modified_at)})]})]})})]})]})]})]})}):e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx(G,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{children:"No purchase data available"})]})})]})}):null},be=()=>{const[s,o]=t.useState("pending"),[x,D]=t.useState([]),[R,T]=t.useState([]),[F,E]=t.useState(!0),[q,M]=t.useState(""),[V,I]=t.useState("date"),[O,$]=t.useState("desc"),[B,H]=t.useState("all"),[Q,U]=t.useState(!1),[W,Y]=t.useState("all"),[Z,G]=t.useState("all"),[ce,ie]=t.useState("all"),[ne,de]=t.useState("all"),[me,oe]=t.useState([]),[xe,pe]=t.useState([]),[he,ue]=t.useState("all"),[je,ge]=t.useState("all"),[Ne,be]=t.useState([]),[_e,we]=t.useState(!1),[Ce,Se]=t.useState(!1),[ke,De]=t.useState(!1),[Re,Ae]=t.useState(null),[Te,Pe]=t.useState(null),[Le,Fe]=t.useState("approve"),[Ee,qe]=t.useState({pendingCount:0,approvedCount:0,rejectedCount:0,tdRejectedCount:0,completedCount:0,totalValue:0,avgProcessingTime:0,totalQuantity:0,costRejections:0,pmFlagRejections:0}),Me=async()=>{try{E(!0);const e=await _.getEstimationPurchases();if(e&&e.purchases){const s=e.purchases;D(s);const t=new Set;s.forEach(e=>{e.materials&&e.materials.forEach(e=>{e.category&&t.add(e.category)})}),be(Array.from(t).sort());let a=[],r=[],l=[],c=[],i=[];s.forEach(e=>{if("completed"===e.latest_status?.status||"complete"===e.latest_status?.status||"completed"===e.status_info?.completed_status||!0===e.accounts_acknowledgement||"accounts"===e.status_info?.receiver&&"approved"===e.status_info?.accounts_status||"accounts"===e.status_info?.sender&&"approved"===e.status_info?.status)i.push(e);else{const s=e.status_info?.estimation_status?.toLowerCase(),t="estimation"===e.status_info?.receiver&&"technicalDirector"===e.status_info?.sender,i="rejected"===s&&"estimation"===e.status_info?.sender;t?c.push(e):"pending"===s?a.push(e):"approved"===s?r.push(e):i&&l.push(e)}});const n=x.reduce((e,s)=>e+(s.total_cost||s.materials_summary?.total_cost||(s.materials?s.materials.reduce((e,s)=>e+s.cost*s.quantity,0):0)),0),d=x.reduce((e,s)=>e+(s.total_quantity||(s.materials?s.materials.reduce((e,s)=>e+s.quantity,0):0)),0);qe({pendingCount:a.length,approvedCount:r.length,rejectedCount:l.length,tdRejectedCount:c.length,completedCount:i.length,totalValue:n,avgProcessingTime:0,totalQuantity:d,costRejections:l.filter(e=>e.status_info?.rejection_reason?.includes("cost")).length,pmFlagRejections:l.filter(e=>e.status_info?.rejection_reason?.includes("PM")).length})}else D([]),qe({pendingCount:0,approvedCount:0,rejectedCount:0,tdRejectedCount:0,completedCount:0,totalValue:0,avgProcessingTime:0,totalQuantity:0,costRejections:0,pmFlagRejections:0})}catch(e){D([]),qe({pendingCount:0,approvedCount:0,rejectedCount:0,tdRejectedCount:0,totalValue:0,avgProcessingTime:0,totalQuantity:0,costRejections:0,pmFlagRejections:0})}finally{E(!1)}};t.useEffect(()=>{Me()},[]);const Ve=e=>e.total_cost||e.materials_summary?.total_cost||(e.materials?e.materials.reduce((e,s)=>e+s.cost*s.quantity,0):0),Ie=e=>{if(!e.materials||0===e.materials.length)return"medium";const s=e.materials.map(e=>e.priority?.toLowerCase()).filter(Boolean);return s.includes("high")?"high":s.includes("medium")?"medium":s.includes("low")?"low":"medium"};t.useEffect(()=>{let e=[...x];switch(s){case"pending":e=x.filter(e=>{if("completed"===e.latest_status?.status||"complete"===e.latest_status?.status||"completed"===e.status_info?.completed_status||!0===e.accounts_acknowledgement||"accounts"===e.status_info?.receiver&&"approved"===e.status_info?.accounts_status||"accounts"===e.status_info?.sender&&"approved"===e.status_info?.status)return!1;const s=e.status_info?.estimation_status?.toLowerCase();return"pending"===s});break;case"approved":e=x.filter(e=>{if("completed"===e.latest_status?.status||"complete"===e.latest_status?.status||"completed"===e.status_info?.completed_status||!0===e.accounts_acknowledgement||"accounts"===e.status_info?.receiver&&"approved"===e.status_info?.accounts_status||"accounts"===e.status_info?.sender&&"approved"===e.status_info?.status)return!1;const s=e.status_info?.estimation_status?.toLowerCase();return"approved"===s});break;case"rejected":e=x.filter(e=>{if("completed"===e.latest_status?.status||"complete"===e.latest_status?.status||"completed"===e.status_info?.completed_status||!0===e.accounts_acknowledgement||"accounts"===e.status_info?.receiver&&"approved"===e.status_info?.accounts_status||"accounts"===e.status_info?.sender&&"approved"===e.status_info?.status)return!1;const s=e.status_info?.estimation_status?.toLowerCase();return"rejected"===s&&"estimation"===e.status_info?.sender});break;case"td-rejected":e=x.filter(e=>!("completed"===e.latest_status?.status||"complete"===e.latest_status?.status||"completed"===e.status_info?.completed_status||!0===e.accounts_acknowledgement||"accounts"===e.status_info?.receiver&&"approved"===e.status_info?.accounts_status||"accounts"===e.status_info?.sender&&"approved"===e.status_info?.status)&&("estimation"===e.status_info?.receiver&&"technicalDirector"===e.status_info?.sender));break;case"completed":e=x.filter(e=>"completed"===e.latest_status?.status||"complete"===e.latest_status?.status||"completed"===e.status_info?.completed_status||!0===e.accounts_acknowledgement||"accounts"===e.status_info?.receiver&&"approved"===e.status_info?.accounts_status||"accounts"===e.status_info?.sender&&"approved"===e.status_info?.status)}if("all"!==B&&(e=e.filter(e=>{const s=Ve(e);switch(B){case"low":return s<5e3;case"medium":return s>=5e3&&s<25e3;case"high":return s>=25e3;default:return!0}})),"all"!==he&&(e=e.filter(e=>Ie(e)===he)),"all"!==je&&(e=e.filter(e=>e.materials?.some(e=>e.category===je)||!1)),q){const s=q.toLowerCase();e=e.filter(e=>{const t=e.purchase_id?e.purchase_id.toString():"",a=e.purpose||"",r=e.site_location||"",l=e.project_id?e.project_id.toString():"",c=e.requested_by||"",i=t.includes(s)||a.toLowerCase().includes(s)||r.toLowerCase().includes(s)||l.toLowerCase().includes(s)||c.toLowerCase().includes(s),n=e.materials?.some(e=>{const t=e.description||"",a=e.category||"";return t.toLowerCase().includes(s)||a.toLowerCase().includes(s)})||!1;return i||n})}if("all"!==W&&(e=e.filter(e=>e.status===W)),"all"!==Z&&(e=e.filter(e=>e.project_id?.toString()===Z)),"all"!==ce&&(e=e.filter(e=>e.site_location===ce)),"all"!==ne){const s=new Date,t=e=>{const t=new Date(e);switch(ne){case"today":return t.toDateString()===s.toDateString();case"week":return t>=new Date(s.getTime()-6048e5);case"month":return t>=new Date(s.getTime()-2592e6);case"quarter":return t>=new Date(s.getTime()-7776e6);default:return!0}};e=e.filter(e=>t(e.date||e.created_at))}e.sort((e,s)=>{let t,a;switch(V){case"date":t=new Date(e.date||e.created_at||"").getTime(),a=new Date(s.date||s.created_at||"").getTime();break;case"amount":t=Ve(e),a=Ve(s);break;case"priority":const r={high:3,medium:2,low:1};t=r[Ie(e)],a=r[Ie(s)];break;default:t=e.purchase_id,a=s.purchase_id}return"asc"===O?t>a?1:-1:t<a?1:-1}),T(e)},[x,s,V,O,B,he,je,q,W,Z,ce,ne]);const Oe=e=>{Ae(e),Fe("approve"),we(!0)},$e=e=>{Ae(e),Fe("reject"),we(!0)},ze=e=>{const s=x.find(s=>s.purchase_id===e);s&&(Pe(s),Ae(e),Se(!0))},Be=e=>{const s=x.find(s=>s.purchase_id===e);s&&(Pe(s),Ae(e),De(!0))},He="date"!==V||"desc"!==O||"all"!==B||"all"!==he||"all"!==je||""!==q||"all"!==W||"all"!==Z||"all"!==ce||"all"!==ne;return e.jsxs("div",{className:"w-full px-4 sm:px-6 lg:px-8 py-6",children:[e.jsx("div",{className:"mb-4",children:e.jsx(w.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"bg-gradient-to-r from-[#243d8a]/5 to-[#243d8a]/10 rounded-xl shadow-xl p-6 border border-[#243d8a]/20",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 bg-[#243d8a] rounded-lg shadow-lg",children:e.jsx(J,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-[#243d8a]",children:"Estimation Hub"}),e.jsx("p",{className:"text-[#243d8a]/80 mt-1",children:"Review and analyze cost implications"})]})]})})}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6 gap-2 sm:gap-3 mb-4",children:[e.jsxs(h,{className:"hover:shadow-md transition-shadow",children:[e.jsx(u,{className:"pb-1 px-3 pt-3",children:e.jsxs(g,{className:"text-xs font-medium text-gray-600 flex items-center gap-1",children:[e.jsx(A,{className:"h-3 w-3 text-amber-500 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:"Pending Review"})]})}),e.jsxs(j,{className:"px-3 pb-3",children:[e.jsx("p",{className:"text-lg sm:text-xl font-bold text-amber-600",children:Ee.pendingCount}),e.jsx("p",{className:"text-xs text-gray-500 truncate",children:"Awaiting analysis"})]})]}),e.jsxs(h,{className:"hover:shadow-md transition-shadow",children:[e.jsx(u,{className:"pb-1 px-3 pt-3",children:e.jsxs(g,{className:"text-xs font-medium text-gray-600 flex items-center gap-1",children:[e.jsx(K,{className:"h-3 w-3 text-green-500 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:"Approved"})]})}),e.jsxs(j,{className:"px-3 pb-3",children:[e.jsx("p",{className:"text-lg sm:text-xl font-bold text-green-600",children:Ee.approvedCount}),e.jsx("p",{className:"text-xs text-gray-500 truncate",children:"Sent to TD"})]})]}),e.jsxs(h,{className:"hover:shadow-md transition-shadow",children:[e.jsx(u,{className:"pb-1 px-3 pt-3",children:e.jsxs(g,{className:"text-xs font-medium text-gray-600 flex items-center gap-1",children:[e.jsx(X,{className:"h-3 w-3 text-red-500 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:"Rejected"})]})}),e.jsxs(j,{className:"px-3 pb-3",children:[e.jsx("p",{className:"text-lg sm:text-xl font-bold text-red-600",children:Ee.rejectedCount}),e.jsxs("div",{className:"text-xs text-gray-500 space-y-0.5",children:[e.jsxs("p",{className:"truncate",children:["Cost: ",Ee.costRejections]}),e.jsxs("p",{className:"truncate",children:["PM Flag: ",Ee.pmFlagRejections]})]})]})]}),e.jsxs(h,{className:"hover:shadow-md transition-shadow",children:[e.jsx(u,{className:"pb-1 px-3 pt-3",children:e.jsxs(g,{className:"text-xs font-medium text-gray-600 flex items-center gap-1",children:[e.jsx(P,{className:"h-3 w-3 text-orange-500 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:"TD Rejected"})]})}),e.jsxs(j,{className:"px-3 pb-3",children:[e.jsx("p",{className:"text-lg sm:text-xl font-bold text-orange-600",children:Ee.tdRejectedCount}),e.jsx("p",{className:"text-xs text-gray-500 truncate",children:"Sent back by TD"})]})]}),e.jsxs(h,{className:"hover:shadow-md transition-shadow",children:[e.jsx(u,{className:"pb-1 px-3 pt-3",children:e.jsxs(g,{className:"text-xs font-medium text-gray-600 flex items-center gap-1",children:[e.jsx(L,{className:"h-3 w-3 text-green-500 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:"Total Value"})]})}),e.jsxs(j,{className:"px-3 pb-3",children:[e.jsx("p",{className:"text-sm sm:text-base font-bold text-green-600 truncate",children:(Qe=Ee.totalValue,`AED ${Qe.toLocaleString()}`)}),e.jsx("p",{className:"text-xs text-gray-500 truncate",children:"Pending value"})]})]}),e.jsxs(h,{className:"hover:shadow-md transition-shadow sm:col-span-2 lg:col-span-1",children:[e.jsx(u,{className:"pb-1 px-3 pt-3",children:e.jsxs(g,{className:"text-xs font-medium text-gray-600 flex items-center gap-1",children:[e.jsx(ee,{className:"h-3 w-3 text-purple-500 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:"Total Quantity"})]})}),e.jsxs(j,{className:"px-3 pb-3",children:[e.jsx("p",{className:"text-lg sm:text-xl font-bold text-purple-600",children:Ee.totalQuantity}),e.jsx("p",{className:"text-xs text-gray-500 truncate",children:"Pending items"})]})]})]}),e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(se,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),e.jsx(p,{type:"text",placeholder:"Search by PR#, purpose, location, project, or material...",value:q,onChange:e=>M(e.target.value),className:"pl-10 pr-10"}),q&&e.jsx("button",{onClick:()=>M(""),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600","aria-label":"Clear search",title:"Clear search",children:e.jsx(te,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(n,{onClick:()=>U(!Q),variant:He?"default":"outline",className:He?"bg-red-600 hover:bg-red-700":"",children:[e.jsx(ae,{className:"h-4 w-4 mr-2"}),"Filters",He&&e.jsx(i,{variant:"secondary",className:"ml-2 bg-white text-red-600",children:"Active"})]}),e.jsxs(N,{value:O,onValueChange:e=>$(e),children:[e.jsx(f,{className:"w-[140px]",children:e.jsx(y,{placeholder:"Sort"})}),e.jsxs(v,{children:[e.jsx(b,{value:"desc",children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(re,{className:"h-3.5 w-3.5"}),"Newest First"]})}),e.jsx(b,{value:"asc",children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(re,{className:"h-3.5 w-3.5 rotate-180"}),"Oldest First"]})})]})]}),e.jsx(n,{onClick:Me,disabled:F,variant:"outline",children:e.jsx(le,{className:"h-4 w-4 "+(F?"animate-spin":"")})})]})]}),e.jsx(C,{children:Q&&e.jsx(w.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.2},className:"overflow-hidden",children:e.jsxs(h,{className:"p-4",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"Status"}),e.jsxs(N,{value:W,onValueChange:Y,children:[e.jsx(f,{children:e.jsx(y,{placeholder:"All Status"})}),e.jsxs(v,{children:[e.jsx(b,{value:"all",children:"All Status"}),e.jsx(b,{value:"pending",children:"Pending"}),e.jsx(b,{value:"approved",children:"Approved"}),e.jsx(b,{value:"rejected",children:"Rejected"}),e.jsx(b,{value:"under_review",children:"Under Review"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"Project"}),e.jsxs(N,{value:Z,onValueChange:G,children:[e.jsx(f,{children:e.jsx(y,{placeholder:"All Projects"})}),e.jsxs(v,{children:[e.jsx(b,{value:"all",children:"All Projects"}),me.map(s=>e.jsx(b,{value:s,children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(z,{className:"h-3 w-3"}),"Project ",s]})},s))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"Location"}),e.jsxs(N,{value:ce,onValueChange:ie,children:[e.jsx(f,{children:e.jsx(y,{placeholder:"All Locations"})}),e.jsxs(v,{children:[e.jsx(b,{value:"all",children:"All Locations"}),xe.map(s=>e.jsx(b,{value:s,children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(k,{className:"h-3 w-3"}),s]})},s))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"Date Range"}),e.jsxs(N,{value:ne,onValueChange:de,children:[e.jsx(f,{children:e.jsx(y,{placeholder:"All Time"})}),e.jsxs(v,{children:[e.jsx(b,{value:"all",children:"All Time"}),e.jsx(b,{value:"today",children:"Today"}),e.jsx(b,{value:"week",children:"Last 7 Days"}),e.jsx(b,{value:"month",children:"Last 30 Days"}),e.jsx(b,{value:"quarter",children:"Last 90 Days"})]})]})]})]}),He&&e.jsx("div",{className:"mt-4 flex justify-end",children:e.jsxs(n,{onClick:()=>{Y("all"),G("all"),ie("all"),de("all")},variant:"outline",size:"sm",className:"text-red-600 hover:text-red-700",children:[e.jsx(te,{className:"h-4 w-4 mr-2"}),"Clear All Filters"]})})]})})})]}),e.jsxs(a,{value:s,onValueChange:o,className:"space-y-4",children:[e.jsx("div",{className:"w-full overflow-x-auto",children:e.jsxs(r,{className:"grid w-full grid-cols-5 h-auto max-w-full",children:[e.jsxs(l,{value:"pending",className:"flex items-center justify-center gap-1 sm:gap-2 data-[state=active]:bg-white data-[state=active]:text-amber-600 text-xs sm:text-sm py-2 sm:py-2.5 whitespace-nowrap",children:[e.jsx(A,{className:"h-3 w-3 sm:h-4 sm:w-4 flex-shrink-0"}),e.jsx("span",{className:"hidden xs:inline",children:"Pending"}),e.jsxs("span",{className:"text-[10px] xs:text-xs sm:text-sm",children:["(",Ee.pendingCount,")"]})]}),e.jsxs(l,{value:"approved",className:"flex items-center justify-center gap-1 sm:gap-2 data-[state=active]:bg-white data-[state=active]:text-green-600 text-xs sm:text-sm py-2 sm:py-2.5 whitespace-nowrap",children:[e.jsx(K,{className:"h-3 w-3 sm:h-4 sm:w-4 flex-shrink-0"}),e.jsx("span",{className:"hidden xs:inline",children:"Approved"}),e.jsxs("span",{className:"text-[10px] xs:text-xs sm:text-sm",children:["(",Ee.approvedCount,")"]})]}),e.jsxs(l,{value:"rejected",className:"flex items-center justify-center gap-1 sm:gap-2 data-[state=active]:bg-white data-[state=active]:text-red-600 text-xs sm:text-sm py-2 sm:py-2.5 whitespace-nowrap",children:[e.jsx(X,{className:"h-3 w-3 sm:h-4 sm:w-4 flex-shrink-0"}),e.jsx("span",{className:"hidden xs:inline",children:"Rejected"}),e.jsxs("span",{className:"text-[10px] xs:text-xs sm:text-sm",children:["(",Ee.rejectedCount,")"]})]}),e.jsxs(l,{value:"td-rejected",className:"flex items-center justify-center gap-1 sm:gap-2 data-[state=active]:bg-white data-[state=active]:text-orange-600 text-xs sm:text-sm py-2 sm:py-2.5 whitespace-nowrap",children:[e.jsx(P,{className:"h-3 w-3 sm:h-4 sm:w-4 flex-shrink-0"}),e.jsx("span",{className:"hidden xs:inline",children:"TD Rejected"}),e.jsxs("span",{className:"text-[10px] xs:text-xs sm:text-sm",children:["(",Ee.tdRejectedCount,")"]})]}),e.jsxs(l,{value:"completed",className:"flex items-center justify-center gap-1 sm:gap-2 data-[state=active]:bg-white data-[state=active]:text-green-600 text-xs sm:text-sm py-2 sm:py-2.5 whitespace-nowrap",children:[e.jsx(S,{className:"h-3 w-3 sm:h-4 sm:w-4 flex-shrink-0"}),e.jsx("span",{className:"hidden xs:inline",children:"Completed"}),e.jsxs("span",{className:"text-[10px] xs:text-xs sm:text-sm",children:["(",Ee.completedCount,")"]})]})]})}),e.jsx(c,{value:"pending",className:"space-y-4",children:F?e.jsx("div",{className:"flex justify-center items-center py-12",children:e.jsx(d,{variant:"pulse-wave",size:"lg"})}):0===R.length?e.jsx(h,{children:e.jsxs(j,{className:"flex flex-col items-center justify-center py-8 sm:py-12",children:[e.jsx(P,{className:"h-10 w-10 sm:h-12 sm:w-12 text-gray-400 mb-3 sm:mb-4"}),e.jsx("p",{className:"text-base sm:text-lg font-medium text-gray-900",children:"No purchases found"}),e.jsx("p",{className:"text-xs sm:text-sm text-gray-500 mt-1 text-center px-4",children:q?"Try adjusting your search criteria":"pending"===s?"No purchases require estimation review at this time":`No ${s} purchases to display`})]})}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-3",children:e.jsx(C,{mode:"popLayout",children:R.map(s=>e.jsx(fe,{purchase:s,onApprove:Oe,onReject:$e,onViewDetails:ze,onViewHistory:Be,isLoading:F},s.purchase_id))})})}),e.jsx(c,{value:"approved",className:"space-y-4",children:F?e.jsx("div",{className:"flex justify-center items-center py-12",children:e.jsx(d,{variant:"pulse-wave",size:"lg"})}):0===R.length?e.jsx(h,{children:e.jsxs(j,{className:"flex flex-col items-center justify-center py-8 sm:py-12",children:[e.jsx(K,{className:"h-10 w-10 sm:h-12 sm:w-12 text-green-500 mb-3 sm:mb-4"}),e.jsx("p",{className:"text-base sm:text-lg font-medium text-gray-900",children:"No approved purchases"}),e.jsx("p",{className:"text-xs sm:text-sm text-gray-500 mt-1 text-center px-4",children:"Approved purchases will appear here"})]})}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-3",children:e.jsx(C,{mode:"popLayout",children:R.map(s=>e.jsx(fe,{purchase:s,onApprove:Oe,onReject:$e,onViewDetails:ze,onViewHistory:Be,isLoading:F},s.purchase_id))})})}),e.jsx(c,{value:"rejected",className:"space-y-4",children:F?e.jsx("div",{className:"flex justify-center items-center py-12",children:e.jsx(d,{variant:"pulse-wave",size:"lg"})}):0===R.length?e.jsx(h,{children:e.jsxs(j,{className:"flex flex-col items-center justify-center py-8 sm:py-12",children:[e.jsx(X,{className:"h-10 w-10 sm:h-12 sm:w-12 text-red-500 mb-3 sm:mb-4"}),e.jsx("p",{className:"text-base sm:text-lg font-medium text-gray-900",children:"No rejected purchases"}),e.jsx("p",{className:"text-xs sm:text-sm text-gray-500 mt-1 text-center px-4",children:"Rejected purchases will appear here"})]})}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-3",children:e.jsx(C,{mode:"popLayout",children:R.map(s=>e.jsx(fe,{purchase:s,onApprove:Oe,onReject:$e,onViewDetails:ze,onViewHistory:Be,isLoading:F},s.purchase_id))})})}),e.jsx(c,{value:"td-rejected",className:"space-y-4",children:F?e.jsx("div",{className:"flex justify-center items-center py-12",children:e.jsx(d,{variant:"pulse-wave",size:"lg"})}):0===R.length?e.jsx(h,{children:e.jsxs(j,{className:"flex flex-col items-center justify-center py-8 sm:py-12",children:[e.jsx(P,{className:"h-10 w-10 sm:h-12 sm:w-12 text-orange-500 mb-3 sm:mb-4"}),e.jsx("p",{className:"text-base sm:text-lg font-medium text-gray-900",children:"No TD rejected purchases"}),e.jsx("p",{className:"text-xs sm:text-sm text-gray-500 mt-1 text-center px-4",children:"Purchases rejected by Technical Director will appear here"})]})}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-3",children:e.jsx(C,{mode:"popLayout",children:R.map(s=>e.jsx(fe,{purchase:s,onApprove:Oe,onReject:$e,onViewDetails:ze,onViewHistory:Be,isLoading:F},s.purchase_id))})})}),e.jsx(c,{value:"completed",className:"space-y-4",children:F?e.jsx("div",{className:"flex justify-center items-center py-12",children:e.jsx(d,{variant:"pulse-wave",size:"lg"})}):0===R.length?e.jsx(h,{children:e.jsxs(j,{className:"flex flex-col items-center justify-center py-8 sm:py-12",children:[e.jsx(S,{className:"h-10 w-10 sm:h-12 sm:w-12 text-green-500 mb-3 sm:mb-4"}),e.jsx("p",{className:"text-base sm:text-lg font-medium text-gray-900",children:"No completed purchases"}),e.jsx("p",{className:"text-xs sm:text-sm text-gray-500 mt-1 text-center px-4",children:"Completed purchases will appear here"})]})}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-3",children:e.jsx(C,{mode:"popLayout",children:R.map(s=>e.jsx(fe,{purchase:s,onApprove:Oe,onReject:$e,onViewDetails:ze,onViewHistory:Be,isLoading:F},s.purchase_id))})})})]}),e.jsx(ye,{isOpen:_e,onClose:()=>we(!1),purchaseId:Re,mode:Le,onSuccess:async()=>{E(!0),await new Promise(e=>setTimeout(e,1500)),await Me(),"approve"===Le?(o("approved"),m.success("Purchase moved to Approved tab")):"reject"===Le&&(o("rejected"),m.success("Purchase moved to Rejected tab"))}}),e.jsx(ve,{isOpen:Ce,onClose:()=>{Se(!1),Pe(null)},purchaseId:Re}),e.jsx(ve,{isOpen:ke,onClose:()=>{De(!1),Pe(null)},purchaseId:Re,showHistoryOnly:!0})]});var Qe};export{be as default};
