import{j as e}from"./radix-ui-34961435.js";import{u as s,r as a}from"./react-vendor-3707ac94.js";import{M as t,B as r,a as i,t as n}from"./index-12cad093.js";import{p as l}from"./projectManagerService-fd1f363b.js";import{C as c,a as o,b as d,c as p}from"./card-e62b6216.js";import{g as h,k as m,i as x,v as j,b as u,T as g,aT as v,as as f,m as y,a as N,aU as b,O as w,j as A,n as M,_ as T}from"./icons-2fde7931.js";import{m as P}from"./ui-vendor-42d562f2.js";import{P as k}from"./PurchaseApprovalCard-09fd0945.js";import{A as C}from"./ApprovalModal-b4443bb7.js";import{P as S}from"./progress-c4fdb9d3.js";import{R as _,A as B,C as O,X as R,Y as z,T as D,d as $,f as K,P as L,b as I,c as E,g as q,h as F,i as G,j as W,k as H}from"./charts-4816d993.js";import"./auth-f9290e45.js";import"./utils-8e4480a0.js";import"./forms-337f692b.js";import"./textarea-ff7bd289.js";import"./dialog-d443819a.js";import"./label-d100d551.js";import"./radio-group-188286ff.js";import"./alert-409df19c.js";const J=({data:s})=>{const a=(e,s)=>{if(0===s)return{value:0,direction:"neutral"};const a=(e-s)/s*100;return{value:Math.abs(a),direction:a>0?"up":a<0?"down":"neutral"}},t={approved:Math.max(0,s.approvedThisMonth-3),rejected:Math.max(0,s.rejectedThisMonth-1),pending:Math.max(0,s.pendingApprovals-2)},r=[{title:"Total Purchases",value:s.totalPurchases,icon:h,color:"text-blue-600",bgColor:"bg-blue-50",trend:a(s.totalPurchases,s.totalPurchases-5),description:"All time"},{title:"Pending Approvals",value:s.pendingApprovals,icon:m,color:"text-orange-600",bgColor:"bg-orange-50",trend:a(s.pendingApprovals,t.pending),description:"Awaiting review"},{title:"Approved This Month",value:s.approvedThisMonth,icon:x,color:"text-green-600",bgColor:"bg-green-50",trend:a(s.approvedThisMonth,t.approved),description:"Current month"},{title:"Rejected This Month",value:s.rejectedThisMonth,icon:j,color:"text-red-600",bgColor:"bg-red-50",trend:a(s.rejectedThisMonth,t.rejected),description:"Current month"},{title:"Avg. Approval Time",value:`${s.averageApprovalTime}`,unit:"days",icon:u,color:"text-purple-600",bgColor:"bg-purple-50",trend:a(s.averageApprovalTime,s.averageApprovalTime+.5),description:"Processing time"},{title:"Approval Rate",value:s.totalPurchases>0?Math.round(s.approvedThisMonth/(s.approvedThisMonth+s.rejectedThisMonth||1)*100):0,unit:"%",icon:g,color:"text-indigo-600",bgColor:"bg-indigo-50",trend:{value:5,direction:"up"},description:"This month"}],i=s=>{switch(s){case"up":return e.jsx(g,{className:"h-4 w-4"});case"down":return e.jsx(f,{className:"h-4 w-4"});default:return e.jsx(v,{className:"h-4 w-4"})}},n=(e,s=!0)=>"neutral"===e?"text-gray-500":"up"===e?s?"text-green-600":"text-red-600":s?"text-red-600":"text-green-600";return e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6 gap-4",children:r.map((s,a)=>e.jsx(P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.05*a},children:e.jsx(c,{className:"hover:shadow-md transition-shadow",children:e.jsxs(o,{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsx("div",{className:`${s.bgColor} p-3 rounded-lg`,children:e.jsx(s.icon,{className:`h-6 w-6 ${s.color}`})}),s.trend&&e.jsxs("div",{className:`flex items-center gap-1 ${n(s.trend.direction,!s.title.includes("Rejected")&&!s.title.includes("Time"))}`,children:[i(s.trend.direction),e.jsxs("span",{className:"text-sm font-medium",children:[s.trend.value.toFixed(1),"%"]})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:s.title}),e.jsxs("div",{className:"flex items-baseline gap-1",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:s.value}),s.unit&&e.jsx("span",{className:"text-sm text-gray-600",children:s.unit})]}),e.jsx("p",{className:"text-xs text-gray-500",children:s.description})]})]})})},s.title))})},Q=()=>{const h=s();a.useState("all");const[m,x]=a.useState(!0),[j,g]=a.useState({totalPurchases:0,pendingApprovals:0,approvedThisMonth:0,rejectedThisMonth:0,averageApprovalTime:0,recentPurchases:[],approvalTrends:[],categoryBreakdown:[]}),[v,f]=a.useState(!1),[y,N]=a.useState(null),[b,P]=a.useState("approve"),[Q,U]=a.useState(!1),V=async()=>{try{x(!0);const e=await l.getPMDashboardData();g(e)}catch(e){403!==e.response?.status&&n.error("Failed to fetch dashboard data")}finally{x(!1)}};a.useEffect(()=>{V()},[]);const X=e=>{const s=j.recentPurchases.find(s=>s.purchase_id===e);s&&(N(s),P("approve"),f(!0))},Y=e=>{const s=j.recentPurchases.find(s=>s.purchase_id===e);s&&(N(s),P("reject"),f(!0))},Z=e=>{h(`/project-manager/purchase/${e}`)};if(m)return e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx(t,{variant:"pulse-wave",size:"lg"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Loading dashboard..."})]})});const ee=(j.approvalTrends||[]).map((e,s)=>({week:e.month.substring(0,3),planned:e.approved+e.rejected+e.pending,actual:e.approved})).slice(0,6),se=(j.categoryBreakdown||[]).slice(0,4).map((e,s)=>({name:e.category,value:Math.round(e.value/Math.max(1,j.categoryBreakdown.reduce((e,s)=>e+s.value,0))*100),color:["#8b5cf6","#3b82f6","#10b981","#f59e0b"][s]||"#6b7280"})),ae=Math.max(1,j.totalPurchases),te=[{status:"Approved",count:j.approvedThisMonth,percentage:Math.round(j.approvedThisMonth/ae*100)},{status:"Pending",count:j.pendingApprovals,percentage:Math.round(j.pendingApprovals/ae*100)},{status:"Rejected",count:j.rejectedThisMonth,percentage:Math.round(j.rejectedThisMonth/ae*100)},{status:"In Process",count:Math.max(0,ae-j.approvedThisMonth-j.pendingApprovals-j.rejectedThisMonth),percentage:Math.max(0,100-Math.round(j.approvedThisMonth/ae*100)-Math.round(j.pendingApprovals/ae*100)-Math.round(j.rejectedThisMonth/ae*100))}];j.totalPurchases.toString(),j.pendingApprovals.toString(),j.pendingApprovals>5&&j.pendingApprovals,j.pendingApprovals,j.approvedThisMonth.toString(),j.averageApprovalTime;const re=(j.recentPurchases||[]).slice(0,4).map(e=>({id:e.purchase_id,name:e.site_location,progress:"approved"===e.pm_status?100:"rejected"===e.pm_status?0:50,status:"approved"===e.pm_status?"on-track":"rejected"===e.pm_status?"delayed":"at-risk",deadline:e.date,budget:`AED ${e.materials_summary?.total_cost?e.materials_summary.total_cost.toLocaleString():"0"}`,purpose:e.purpose})),ie=(j.recentPurchases||[]).filter(e=>!e.pm_status||"pending"===e.pm_status);return e.jsxs("div",{className:"p-6 space-y-6 bg-gray-50 min-h-screen",children:[e.jsx("div",{className:"flex justify-between items-center",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Project Manager Dashboard"}),e.jsx("p",{className:"text-gray-500 mt-1",children:"Monitor and manage all active projects"})]})}),m?e.jsx("div",{className:"text-center py-8",children:e.jsx(t,{variant:"pulse-wave",size:"md"})}):e.jsx(J,{data:j}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs(c,{className:"lg:col-span-2",children:[e.jsxs(d,{className:"flex flex-row items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(u,{className:"h-5 w-5 text-blue-500"}),e.jsx(p,{children:"Project Timeline Progress"})]}),e.jsx(r,{variant:"ghost",size:"icon",children:e.jsx(w,{className:"h-4 w-4"})})]}),e.jsx(o,{children:e.jsx(_,{width:"100%",height:300,children:e.jsxs(B,{data:ee,children:[e.jsxs("defs",{children:[e.jsxs("linearGradient",{id:"colorPlanned",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#3b82f6",stopOpacity:.3}),e.jsx("stop",{offset:"95%",stopColor:"#3b82f6",stopOpacity:0})]}),e.jsxs("linearGradient",{id:"colorActual",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#10b981",stopOpacity:.3}),e.jsx("stop",{offset:"95%",stopColor:"#10b981",stopOpacity:0})]})]}),e.jsx(O,{strokeDasharray:"3 3",stroke:"#f0f0f0"}),e.jsx(R,{dataKey:"week",stroke:"#888",fontSize:12}),e.jsx(z,{stroke:"#888",fontSize:12}),e.jsx(D,{}),e.jsx($,{}),e.jsx(K,{type:"monotone",dataKey:"planned",stroke:"#3b82f6",fillOpacity:1,fill:"url(#colorPlanned)",strokeWidth:2,name:"Planned %"}),e.jsx(K,{type:"monotone",dataKey:"actual",stroke:"#10b981",fillOpacity:1,fill:"url(#colorActual)",strokeWidth:2,name:"Actual %"})]})})})]}),e.jsxs(c,{children:[e.jsxs(d,{className:"flex flex-row items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(A,{className:"h-5 w-5 text-purple-500"}),e.jsx(p,{children:"Resource Allocation"})]}),e.jsx(r,{variant:"ghost",size:"icon",children:e.jsx(w,{className:"h-4 w-4"})})]}),e.jsxs(o,{children:[e.jsx(_,{width:"100%",height:250,children:e.jsxs(L,{children:[e.jsx(I,{data:se,cx:"50%",cy:"50%",innerRadius:60,outerRadius:90,paddingAngle:2,dataKey:"value",children:se.map((s,a)=>e.jsx(E,{fill:s.color},`cell-${a}`))}),e.jsx(D,{})]})}),e.jsx("div",{className:"mt-4 space-y-2",children:se.map(s=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:s.color}}),e.jsx("span",{className:"text-sm text-gray-600",children:s.name})]}),e.jsxs("span",{className:"text-sm font-medium",children:[s.value,"%"]})]},s.name))})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(c,{children:[e.jsxs(d,{className:"flex flex-row items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(M,{className:"h-5 w-5 text-green-500"}),e.jsx(p,{children:"Team Performance Analysis"})]}),e.jsx(r,{variant:"ghost",size:"icon",children:e.jsx(w,{className:"h-4 w-4"})})]}),e.jsx(o,{children:e.jsx(_,{width:"100%",height:300,children:e.jsxs(q,{data:[{skill:"Technical",A:85,B:90},{skill:"Communication",A:92,B:85},{skill:"Problem Solving",A:88,B:87},{skill:"Time Management",A:78,B:92},{skill:"Quality",A:90,B:88},{skill:"Innovation",A:85,B:82}],children:[e.jsx(F,{stroke:"#e5e7eb"}),e.jsx(G,{dataKey:"skill",stroke:"#888",fontSize:12}),e.jsx(W,{angle:90,domain:[0,100],stroke:"#888",fontSize:10}),e.jsx(H,{name:"Team A",dataKey:"A",stroke:"#3b82f6",fill:"#3b82f6",fillOpacity:.3}),e.jsx(H,{name:"Team B",dataKey:"B",stroke:"#10b981",fill:"#10b981",fillOpacity:.3}),e.jsx($,{}),e.jsx(D,{})]})})})]}),e.jsxs(c,{children:[e.jsxs(d,{className:"flex flex-row items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(T,{className:"h-5 w-5 text-orange-500"}),e.jsx(p,{children:"Task Distribution"})]}),e.jsx(r,{variant:"ghost",size:"icon",children:e.jsx(w,{className:"h-4 w-4"})})]}),e.jsxs(o,{className:"space-y-4",children:[te.map((s,a)=>e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:s.status}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-sm text-gray-500",children:[s.count," purchases"]}),e.jsxs(i,{variant:"outline",children:[s.percentage,"%"]})]})]}),e.jsx(S,{value:s.percentage,className:"h-2",style:{"--progress-background":0===a?"#10b981":1===a?"#f59e0b":2===a?"#ef4444":"#3b82f6"}})]},s.status)),e.jsx("div",{className:"pt-4 border-t",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium",children:"Total Purchases"}),e.jsx("span",{className:"text-lg font-bold",children:j.totalPurchases})]})})]})]})]}),e.jsxs(c,{children:[e.jsx(d,{children:e.jsx(p,{children:"Recent Purchase Requests"})}),e.jsx(o,{children:m?e.jsx("div",{className:"text-center py-8",children:e.jsx(t,{variant:"pulse-wave",size:"md"})}):ie.length>0?e.jsx("div",{className:"space-y-4",children:ie.slice(0,3).map(s=>e.jsx(k,{purchase:s,onApprove:X,onReject:Y,onViewDetails:Z,isLoading:Q},s.purchase_id))}):re.length>0?e.jsx("div",{className:"space-y-4",children:re.map(s=>e.jsxs("div",{className:"border rounded-lg p-4 hover:bg-gray-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-gray-900",children:["Purchase #",s.id," - ",s.name]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:s.purpose}),e.jsxs("div",{className:"flex items-center gap-4 mt-1",children:[e.jsxs("span",{className:"text-sm text-gray-500",children:["Budget: ",s.budget]}),e.jsxs("span",{className:"text-sm text-gray-500",children:["Date: ",new Date(s.deadline).toLocaleDateString()]})]})]}),e.jsx(i,{variant:"on-track"===s.status?"default":"delayed"===s.status?"destructive":"secondary",children:s.status})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Progress"}),e.jsxs("span",{className:"font-medium",children:[s.progress,"%"]})]}),e.jsx(S,{value:s.progress,className:"h-2"})]})]},s.id))}):e.jsx("div",{className:"text-center py-8 text-gray-500",children:"No purchase requests available"})})]}),e.jsx(C,{isOpen:v,onClose:()=>{f(!1),N(null)},purchase:y,mode:b,onConfirm:async e=>{try{let s;if(U(!0),s="approve"===e.action?await l.approvePurchase(e.purchaseId,e.comments):await l.rejectPurchase(e.purchaseId,e.rejectionReason||"",e.comments),!s.success)throw new Error(s.error||"Operation failed");n.success(s.message||`Purchase ${e.action}d successfully`),await V(),f(!1),N(null)}catch(s){n.error(s.response?.data?.error||s.message||"Failed to process request")}finally{U(!1)}},isLoading:Q})]})};export{Q as default};
