import{j as e}from"./radix-ui-34961435.js";import{r as s}from"./react-vendor-3707ac94.js";import{T as a,a as t,b as l,c as r}from"./tabs-8d248749.js";import{a as c,B as i,M as n,t as d,A as x}from"./index-12cad093.js";import{I as m}from"./input-dbd0a11e.js";import{C as o,b as h,c as p,a as j}from"./card-e62b6216.js";import{S as u,a as g,b as N,c as v,d as y}from"./select-767f455e.js";import{S as f}from"./separator-a0f6b9f9.js";import{m as b,A as w}from"./ui-vendor-42d562f2.js";import{Q as _,U as C,u as A,g as k,ag as S,a as L,v as D,E as P,ah as T,l as R,z as E,i as z,F as V,w as I,R as q,M as F,I as O,b as H,k as Q,o as $,ak as U,c as M,am as B,a8 as Z,aD as G,aA as J,az as W,e as Y,aC as K,T as X,N as ee,af as se,X as ae}from"./icons-2fde7931.js";import{D as te,a as le,b as re,c as ce,d as ie,e as ne}from"./dialog-d443819a.js";import{T as de}from"./textarea-ff7bd289.js";import{L as xe}from"./label-d100d551.js";import{A as me,a as oe}from"./alert-409df19c.js";import{t as he}from"./technicalDirectorService-7b18d54a.js";import{a as pe}from"./dateFormatter-3b370b4b.js";import"./auth-f9290e45.js";import"./utils-8e4480a0.js";import"./forms-337f692b.js";const je=({purchase:s,onApprove:a,onReject:t,onViewDetails:l,onViewHistory:r,isLoading:n=!1})=>{const d=s.technical_director_status?.toLowerCase()||"pending",x="approved"===(s.estimation_status?.toLowerCase()||"pending")&&(!d||"pending"===d),m="completed"===s.latest_status?.status||"complete"===s.latest_status?.status||!0===s.accounts_acknowledgement,u=s.materials?.[0]?.priority||"medium";return e.jsx(b.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},whileHover:{y:-2},transition:{duration:.2},className:"h-full",children:e.jsxs(o,{className:"h-full hover:shadow-lg transition-shadow max-w-sm mx-auto",children:[e.jsx(h,{className:"pb-2 px-4 pt-4",children:e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs(p,{className:"text-base font-semibold truncate",children:["PR #",s.purchase_id]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-0.5 truncate",children:["Project: ",s.project_id]})]}),e.jsxs("div",{className:"flex flex-col gap-1 items-end flex-shrink-0",children:[e.jsx(c,{className:`${(()=>{if(m)return"bg-green-100 text-green-800 border-green-200";switch(d){case"approved":return"bg-green-100 text-green-800 border-green-200";case"rejected":return"bg-red-100 text-red-800 border-red-200";default:return"bg-yellow-100 text-yellow-800 border-yellow-200"}})()} text-xs`,variant:"outline",children:m?"Completed":"pending"===d?"Pending":"approved"===d?"Approved":"rejected"===d?"Rejected":"Pending"}),e.jsxs(c,{className:`${(()=>{switch(u?.toLowerCase()){case"high":return"bg-red-100 text-red-800 border-red-200";case"medium":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"low":return"bg-yellow-50 text-yellow-600 border-yellow-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}})()} text-xs`,variant:"outline",children:[u?.charAt(0).toUpperCase()+u?.slice(1)," priority"]})]})]})}),e.jsxs(j,{className:"space-y-3 px-4 pb-4",children:[e.jsxs("div",{className:"space-y-1.5 text-xs",children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-gray-600",children:[e.jsx(_,{className:"h-3 w-3 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:s.site_location})]}),e.jsxs("div",{className:"flex items-center gap-1.5 text-gray-600",children:[e.jsx(C,{className:"h-3 w-3 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:s.requested_by})]}),e.jsxs("div",{className:"flex items-center gap-1.5 text-gray-600",children:[e.jsx(A,{className:"h-3 w-3 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:new Date(s.date).toLocaleDateString()})]})]}),e.jsx(f,{}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-gray-600",children:[e.jsx(k,{className:"h-3 w-3"}),e.jsxs("span",{children:[s.material_count||0," items"]})]}),e.jsxs("span",{className:"text-gray-600",children:["Qty: ",s.total_quantity||0]})]}),e.jsxs("div",{className:"flex items-center justify-between bg-indigo-50 rounded-md px-2 py-1.5",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(S,{className:"h-3 w-3 text-green-600"}),e.jsx("span",{className:"text-xs font-medium text-green-900",children:"Total"})]}),e.jsxs("span",{className:"text-xs font-bold text-green-600 truncate",children:["AED ",(s.total_cost||0).toLocaleString()]})]})]}),"rejected"===d&&s.technical_director_rejection_reason&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-md px-2 py-1.5",children:e.jsxs("p",{className:"text-xs text-red-700 line-clamp-2",children:[e.jsx("span",{className:"font-medium",children:"Reason:"})," ",s.technical_director_rejection_reason]})}),e.jsx(f,{}),e.jsx("div",{className:"space-y-1.5",children:x?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 gap-1.5",children:[e.jsxs(i,{onClick:()=>a(s.purchase_id),disabled:n,className:"bg-green-600 hover:bg-green-700 text-white h-8 text-xs",size:"sm",children:[e.jsx(L,{className:"h-3 w-3 mr-1"}),"Approve"]}),e.jsxs(i,{onClick:()=>t(s.purchase_id),disabled:n,variant:"outline",className:"border-red-200 text-red-600 hover:bg-red-50 h-8 text-xs",size:"sm",children:[e.jsx(D,{className:"h-3 w-3 mr-1"}),"Reject"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-1.5",children:[e.jsxs(i,{onClick:()=>l(s.purchase_id),variant:"outline",className:"h-8 text-xs",size:"sm",children:[e.jsx(P,{className:"h-3 w-3 mr-1"}),"Details"]}),e.jsxs(i,{onClick:()=>r(s.purchase_id),variant:"outline",className:"h-8 text-xs",size:"sm",children:[e.jsx(T,{className:"h-3 w-3 mr-1"}),"History"]})]})]}):e.jsxs("div",{className:"grid grid-cols-2 gap-1.5",children:[e.jsxs(i,{onClick:()=>l(s.purchase_id),variant:"outline",className:"w-full h-8 text-xs",size:"sm",children:[e.jsx(P,{className:"h-3 w-3 mr-1"}),"View Details"]}),e.jsxs(i,{onClick:()=>r(s.purchase_id),variant:"outline",className:"w-full h-8 text-xs",size:"sm",children:[e.jsx(T,{className:"h-3 w-3 mr-1"}),"View History"]})]})})]})]})})},ue=({isOpen:a,onClose:t,purchaseId:l,mode:r,onSuccess:c})=>{const[x,m]=s.useState(""),[o,h]=s.useState(""),[p,j]=s.useState(!1),u=()=>{m(""),h(""),t()};return e.jsx(te,{open:a,onOpenChange:u,children:e.jsxs(le,{className:"sm:max-w-[500px]",children:[e.jsxs(re,{children:[e.jsxs(ce,{className:"flex items-center gap-2",children:[e.jsx(R,{className:"h-5 w-5 "+("approve"===r?"text-green-600":"text-red-600")}),"approve"===r?"Approve":"Reject"," Purchase #",l]}),e.jsx(ie,{children:"approve"===r?"This purchase will be sent to Accounts for payment processing.":"This purchase will be sent back to Estimation for revision."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs(me,{className:"approve"===r?"border-green-200":"border-red-200",children:[e.jsx(E,{className:"h-4 w-4"}),e.jsx(oe,{children:"approve"===r?e.jsxs("span",{children:[e.jsx("strong",{children:"Approving"})," will forward this purchase to the Accounts team for final processing."]}):e.jsxs("span",{children:[e.jsx("strong",{children:"Rejecting"})," will send this purchase back to Estimation with your feedback."]})})]}),"reject"===r&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs(xe,{htmlFor:"rejection-reason",className:"text-sm font-medium",children:["Rejection Reason ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(de,{id:"rejection-reason",placeholder:"Please provide a detailed reason for rejection (minimum 10 characters)...",value:o,onChange:e=>h(e.target.value),className:"min-h-[100px]",required:!0}),e.jsx("p",{className:"text-xs text-gray-500",children:"This will help the Estimation team understand what needs to be revised."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(xe,{htmlFor:"comments",className:"text-sm font-medium",children:["Additional Comments ","reject"===r?"":"(Optional)"]}),e.jsx(de,{id:"comments",placeholder:"approve"===r?"Add any notes for the Accounts team (optional)...":"Add any additional guidance or suggestions...",value:x,onChange:e=>m(e.target.value),className:"min-h-[80px]"})]}),"reject"===r&&e.jsx("div",{className:"flex justify-end",children:e.jsxs("span",{className:"text-xs "+(o.length<10?"text-red-500":"text-gray-500"),children:[o.length," / 10 minimum characters"]})})]}),e.jsxs(ne,{children:[e.jsx(i,{variant:"outline",onClick:u,disabled:p,children:"Cancel"}),e.jsx(i,{onClick:async()=>{if(l){if("reject"===r){if(!o.trim())return void d.error("Please provide a rejection reason");if(o.trim().length<10)return void d.error("Rejection reason must be at least 10 characters")}j(!0);try{let e;"approve"===r?(e=await he.submitApproval(l,x),d.success("Purchase approved and sent to Accounts")):(e=await he.submitRejection(l,o,x),d.success("Purchase rejected and sent back to Estimation")),e.email_warning&&d.warning(e.email_warning),c&&c(),u()}catch(e){const s=e.response?.data?.detail||"Failed to submit decision";d.error(s)}finally{j(!1)}}},disabled:p||"reject"===r&&o.trim().length<10,className:"approve"===r?"bg-green-600 hover:bg-green-700":"bg-red-600 hover:bg-red-700",children:p?e.jsxs(e.Fragment,{children:[e.jsx(n,{variant:"pulse-wave",size:"lg"}),"Processing..."]}):e.jsxs(e.Fragment,{children:["approve"===r?e.jsx(z,{className:"h-4 w-4 mr-2"}):e.jsx(D,{className:"h-4 w-4 mr-2"}),"approve"===r?"Approve":"Reject"," Purchase"]})})]})]})})},ge=({isOpen:m,onClose:h,purchaseId:p,showHistoryOnly:j=!1})=>{const[u,g]=s.useState(!1),[N,v]=s.useState(null),[y,f]=s.useState("details"),[b,w]=s.useState(null);s.useEffect(()=>{m&&p&&(L(),f(j?"history":"details"))},[m,p,j]);const L=async()=>{if(p)try{g(!0),w(null);const e=j?await he.getPurchaseHistory(p):await he.getPurchaseDetails(p);if(e&&!1===e.success)w(e.message||"Failed to load purchase details"),v(null);else if(j&&e.purchase){const s=e.purchase.approvals||{};v({purchase:e.purchase,materials:e.purchase.materials||[],history:s,latest_status:e.latest_status})}else!j&&e.purchase?v({purchase:e.purchase,materials:e.purchase.materials||[],history:e.purchase.approvals||{},latest_status:e.latest_status}):v(e)}catch(e){w("Failed to load purchase details. Please try again."),v(null),d.error("Failed to load purchase details")}finally{g(!1)}},P=e=>null==e||isNaN(e)?"AED 0":`AED ${e.toLocaleString()}`,T=s=>{const a=s?.toLowerCase();switch(a){case"approved":return e.jsxs(c,{className:"bg-green-100 text-green-700 border-green-300 px-3 py-1",children:[e.jsx(z,{className:"h-3 w-3 mr-1"}),"APPROVED"]});case"completed":case"complete":return e.jsxs(c,{className:"bg-blue-100 text-blue-700 border-blue-300 px-3 py-1",children:[e.jsx(z,{className:"h-3 w-3 mr-1"}),"COMPLETED"]});case"rejected":return e.jsxs(c,{className:"bg-red-100 text-red-700 border-red-300 px-3 py-1",children:[e.jsx(D,{className:"h-3 w-3 mr-1"}),"REJECTED"]});case"pending":return e.jsxs(c,{className:"bg-yellow-100 text-yellow-700 border-yellow-300 px-3 py-1",children:[e.jsx(Q,{className:"h-3 w-3 mr-1"}),"PENDING"]});default:return e.jsx(c,{className:"bg-gray-100 text-gray-700 border-gray-300 px-3 py-1 uppercase",children:s})}},R=e=>e?pe(e):"N/A";if(!m)return null;const E=N?.purchase||N||{},Y=N?.materials||E?.materials||[],K=N?.history||N?.purchase?.approvals||(E?.approvals?E.approvals:[]),X=N?.latest_status,ee=E.total_cost||Y.reduce((e,s)=>e+(s.cost||0)*(s.quantity||1),0)||0;return e.jsx(te,{open:m,onOpenChange:h,children:e.jsxs(le,{className:"max-w-5xl max-h-[95vh] p-0 overflow-hidden",children:[e.jsx("div",{className:"bg-[#243d8a] text-white px-6 py-4",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(V,{className:"h-6 w-6"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold",children:j?"Purchase Request History":"Purchase Request Details"}),e.jsxs("div",{className:"flex items-center gap-3 mt-1",children:[e.jsxs("span",{className:"text-blue-100 text-sm",children:["# PR-",p]}),(()=>{const e=E?.approvals?.action?.some(e=>"accounts"===e.role&&("completed"===e.status||"complete"===e.status||"approved"===e.status)),s="completed"===X?.status||"complete"===X?.status||!0===E?.accounts_acknowledgement||"completed"===E?.accounts_status?.toLowerCase()||"approved"===E?.accounts_status?.toLowerCase()||e;return T(s?"completed":E?.technical_director_status?E.technical_director_status:"pending")})()]})]})]})})}),u?e.jsxs("div",{className:"flex flex-col items-center justify-center py-16",children:[e.jsx(n,{variant:"pulse-wave",size:"lg"}),e.jsx("p",{className:"text-gray-600",children:"Loading purchase details..."})]}):b?e.jsxs("div",{className:"flex flex-col items-center justify-center py-16",children:[e.jsx(I,{className:"h-12 w-12 text-red-500 mb-4"}),e.jsx("p",{className:"text-lg font-medium text-gray-900",children:"Unable to Load Details"}),e.jsx("p",{className:"text-sm text-gray-600 mt-2",children:b}),e.jsxs(i,{onClick:L,className:"mt-4 bg-[#243d8a] hover:bg-[#243d8a]/90",children:[e.jsx(q,{className:"h-4 w-4 mr-2"}),"Retry"]})]}):N?e.jsxs("div",{className:"flex-1 overflow-hidden",children:[!j&&e.jsxs("div",{className:"grid grid-cols-3 gap-3 p-4",children:[e.jsx(o,{className:"bg-blue-50 border-blue-200 p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-blue-600 font-medium",children:"Total Amount"}),e.jsx("p",{className:"text-lg font-bold text-blue-900 mt-0.5",children:P(ee)})]}),e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(S,{className:"h-5 w-5 text-blue-600"})})]})}),e.jsx(o,{className:"bg-purple-50 border-purple-200 p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-purple-600 font-medium",children:"Materials"}),e.jsxs("p",{className:"text-lg font-bold text-purple-900 mt-0.5",children:[Y.length," Items"]})]}),e.jsx("div",{className:"p-2 bg-purple-100 rounded-lg",children:e.jsx(k,{className:"h-5 w-5 text-purple-600"})})]})}),e.jsx(o,{className:"bg-green-50 border-green-200 p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-green-600 font-medium",children:"Email Status"}),e.jsx("div",{className:"flex items-center gap-2 mt-0.5",children:E.email_sent?e.jsx(e.Fragment,{children:e.jsxs(c,{className:"bg-green-100 text-green-700 border-green-300 text-xs",children:[e.jsx(z,{className:"h-3 w-3 mr-1"}),"Sent"]})}):e.jsx(c,{className:"bg-gray-100 text-gray-700 border-gray-300 text-xs",children:"Not Sent"})})]}),e.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:e.jsx(F,{className:"h-5 w-5 text-green-600"})})]})})]}),e.jsxs(a,{value:y,onValueChange:f,className:"flex-1",children:[e.jsx(t,{className:"mx-4 bg-gray-100",children:j?e.jsxs(l,{value:"history",className:"flex items-center gap-2",children:[e.jsx(Q,{className:"h-4 w-4"}),"Approval History"]}):e.jsxs(e.Fragment,{children:[e.jsxs(l,{value:"details",className:"flex items-center gap-2",children:[e.jsx(O,{className:"h-4 w-4"}),"Details"]}),e.jsxs(l,{value:"materials",className:"flex items-center gap-2",children:[e.jsx(k,{className:"h-4 w-4"}),"Materials"]}),e.jsxs(l,{value:"status",className:"flex items-center gap-2",children:[e.jsx(H,{className:"h-4 w-4"}),"Latest Status"]})]})}),e.jsxs("div",{className:"p-4 overflow-y-auto max-h-[calc(95vh-250px)]",children:[!j&&e.jsxs(r,{value:"details",className:"mt-0 space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(O,{className:"h-5 w-5 text-blue-600"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Basic Information"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx($,{className:"h-5 w-5 text-gray-400 mt-1"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 uppercase tracking-wider",children:"PROJECT ID"}),e.jsx("p",{className:"font-semibold text-gray-900 mt-1",children:E.project_id||"N/A"})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(A,{className:"h-5 w-5 text-gray-400 mt-1"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 uppercase tracking-wider",children:"REQUEST DATE"}),e.jsx("p",{className:"font-semibold text-gray-900 mt-1",children:R(E.date||E.created_at)})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(C,{className:"h-5 w-5 text-gray-400 mt-1"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 uppercase tracking-wider",children:"REQUESTED BY"}),e.jsx("p",{className:"font-semibold text-gray-900 mt-1",children:E.requested_by||"N/A"})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(U,{className:"h-5 w-5 text-gray-400 mt-1"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 uppercase tracking-wider",children:"CREATED BY"}),e.jsx("p",{className:"font-semibold text-gray-900 mt-1",children:E.created_by||E.requested_by||"N/A"})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(_,{className:"h-5 w-5 text-gray-400 mt-1"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 uppercase tracking-wider",children:"SITE LOCATION"}),e.jsx("p",{className:"font-semibold text-gray-900 mt-1",children:E.site_location||"N/A"})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(F,{className:"h-5 w-5 text-gray-400 mt-1"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 uppercase tracking-wider",children:"EMAIL STATUS"}),E.email_sent?e.jsxs(c,{className:"bg-blue-100 text-blue-700 mt-1",children:[e.jsx(z,{className:"h-3 w-3 mr-1"}),"Sent âœ“"]}):e.jsx(c,{className:"bg-gray-100 text-gray-700 mt-1",children:"Not Sent"})]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("div",{className:"p-2 bg-orange-100 rounded-lg",children:e.jsx(M,{className:"h-5 w-5 text-orange-600"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Purpose"})]}),e.jsx("p",{className:"text-gray-700 leading-relaxed",children:E.purpose||"No purpose specified"})]}),E?.file_path&&e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:e.jsx(B,{className:"h-5 w-5 text-green-600"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Attachments"})]}),e.jsxs("div",{className:"flex items-center justify-between bg-gray-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(V,{className:"h-5 w-5 text-gray-500"}),e.jsx("span",{className:"text-gray-900 font-medium",children:E.file_path})]}),e.jsxs(i,{onClick:async()=>{try{const e=await fetch(`${x}/download_files?key=siteSupervisor&id=${p}`,{headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`,"Content-Type":"application/json"}});if(e.ok){const s=await e.json();if(s.purchase_files&&s.purchase_files.length>0){const e=s.purchase_files[0];if(e.public_url){const s=document.createElement("a");s.href=e.public_url,s.download=e.filename||E.file_path||"download",s.style.display="none",document.body.appendChild(s),s.click(),document.body.removeChild(s),d.success("Download started")}}}}catch(e){d.error("Error downloading file")}},size:"sm",className:"bg-[#243d8a] hover:bg-[#243d8a]/90",children:[e.jsx(Z,{className:"h-4 w-4 mr-2"}),"Download"]})]})]})]}),!j&&e.jsx(r,{value:"materials",className:"mt-0 space-y-4",children:Y.length>0?Y.map((s,a)=>e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(k,{className:"h-5 w-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:s.description||"No description"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:s.specification||"No specification"})]})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-4 mt-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Category"}),e.jsx("p",{className:"font-medium text-gray-900",children:s.category||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Quantity"}),e.jsxs("p",{className:"font-medium text-gray-900",children:[s.quantity||0," ",s.unit||""]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Unit Cost"}),e.jsx("p",{className:"font-medium text-green-600",children:P(s.unit_cost||s.cost||0)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Priority"}),e.jsx(c,{className:"high"===s.priority?.toLowerCase()?"bg-red-100 text-red-700":"low"===s.priority?.toLowerCase()?"bg-green-100 text-green-700":"bg-yellow-100 text-yellow-700",children:s.priority||"Normal"})]})]})]}),e.jsxs("div",{className:"text-right ml-6",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Total Cost"}),e.jsx("p",{className:"text-xl font-bold text-green-600",children:P((s.quantity||0)*(s.cost||s.unit_cost||0))})]})]})},a)):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(k,{className:"h-16 w-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"No Materials Found"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"No materials have been added to this purchase request."})]})}),!j&&e.jsx(r,{value:"status",className:"mt-0",children:X?e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(H,{className:"h-5 w-5 text-blue-600"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Latest Status Information"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 uppercase tracking-wider mb-2",children:"Status"}),T(X.status)]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 uppercase tracking-wider mb-2",children:"Role"}),e.jsx("p",{className:"font-semibold text-gray-900 capitalize",children:X.role})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 uppercase tracking-wider mb-2",children:"Decision By"}),e.jsx("p",{className:"font-semibold text-gray-900",children:X.created_by||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 uppercase tracking-wider mb-2",children:"Decision Date"}),e.jsx("p",{className:"font-semibold text-gray-900",children:R(X.decision_date)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 uppercase tracking-wider mb-2",children:"Workflow"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium capitalize",children:X.sender}),e.jsx(G,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:"font-medium capitalize",children:X.receiver})]})]})]}),X.comments&&e.jsxs("div",{className:"mt-6",children:[e.jsx("p",{className:"text-sm text-gray-500 uppercase tracking-wider mb-2",children:"Comments"}),e.jsx("div",{className:"bg-blue-50 rounded-lg p-4 border border-blue-200",children:e.jsx("p",{className:"text-gray-700",children:X.comments})})]}),X.rejection_reason&&e.jsxs("div",{className:"mt-6",children:[e.jsx("p",{className:"text-sm text-gray-500 uppercase tracking-wider mb-2",children:"Rejection Reason"}),e.jsx("div",{className:"bg-red-50 rounded-lg p-4 border border-red-200",children:e.jsx("p",{className:"text-red-700",children:X.rejection_reason})})]})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(H,{className:"h-16 w-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"No Status Information"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Latest status information is not available."})]})}),j&&e.jsxs(r,{value:"history",className:"mt-0 space-y-6",children:[e.jsx("div",{className:"bg-gray-50 rounded-lg p-8 mb-8",children:e.jsxs("div",{className:"grid grid-cols-3 gap-8",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(k,{className:"h-5 w-5 text-blue-600"}),e.jsx("h3",{className:"font-semibold text-gray-900",children:"Purchase Details"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Purpose: "}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:E.purpose||"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Location: "}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:E.site_location||"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Project: "}),e.jsxs("span",{className:"text-sm font-medium text-gray-900",children:["#",E.project_id||"N/A"]})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(C,{className:"h-5 w-5 text-green-600"}),e.jsx("h3",{className:"font-semibold text-gray-900",children:"Request Info"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Requested by: "}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:E.requested_by||E.created_by||"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Date: "}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:E.date||E.created_at?pe(E.date||E.created_at):"N/A"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"TD Status: "}),e.jsx(c,{className:`text-xs ${(()=>{const e=E?.approvals?.action?.some(e=>"accounts"===e.role&&("completed"===e.status||"complete"===e.status||"approved"===e.status));return"completed"===X?.status||"complete"===X?.status||!0===E?.accounts_acknowledgement||"completed"===E?.accounts_status?.toLowerCase()||"approved"===E?.accounts_status?.toLowerCase()||e?"bg-blue-100 text-blue-700 border-blue-300":"approved"===E.technical_director_status?.toLowerCase()?"bg-green-100 text-green-700 border-green-300":"rejected"===E.technical_director_status?.toLowerCase()?"bg-red-100 text-red-700 border-red-300":"bg-yellow-100 text-yellow-700 border-yellow-300"})()}`,children:(()=>{const e=E?.approvals?.action?.some(e=>"accounts"===e.role&&("completed"===e.status||"complete"===e.status||"approved"===e.status));return"completed"===X?.status||"complete"===X?.status||!0===E?.accounts_acknowledgement||"completed"===E?.accounts_status?.toLowerCase()||"approved"===E?.accounts_status?.toLowerCase()||e?"Completed":E.technical_director_status?E.technical_director_status:"Pending"})()})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(H,{className:"h-5 w-5 text-purple-600"}),e.jsx("h3",{className:"font-semibold text-gray-900",children:"Timeline Stats"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Total Steps: "}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:(K?.action||(Array.isArray(K)?K:[])).length||0})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Approvals: "}),e.jsx("span",{className:"text-sm font-medium text-green-600",children:(K?.action||(Array.isArray(K)?K:[])).filter(e=>"approved"===e.status).length||0})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Rejections: "}),e.jsx("span",{className:"text-sm font-medium text-red-600",children:(K?.action||(Array.isArray(K)?K:[])).filter(e=>"rejected"===e.status).length||0})]})]})]})]})}),(()=>{const s=K?.action||(Array.isArray(K)?K:[]);return s&&s.length>0?e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute left-8 top-8 bottom-8 w-0.5 bg-gray-200"}),e.jsx("div",{className:"space-y-6",children:s.map((s,a)=>e.jsxs("div",{className:"relative flex items-start gap-4",children:[e.jsx("div",{className:"relative z-10 p-3 rounded-full "+("approved"===s.status?"bg-green-100":"rejected"===s.status?"bg-red-100":"completed"===s.status||"complete"===s.status?"bg-blue-100":"bg-yellow-100"),children:"approved"===s.status?e.jsx(z,{className:"h-5 w-5 text-green-600"}):"rejected"===s.status?e.jsx(D,{className:"h-5 w-5 text-red-600"}):"completed"===s.status||"complete"===s.status?e.jsx(z,{className:"h-5 w-5 text-blue-600"}):e.jsx(Q,{className:"h-5 w-5 text-yellow-600"})}),e.jsxs("div",{className:"flex-1 bg-white rounded-lg border border-gray-200 p-5",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"font-semibold text-gray-900",children:s.role?s.role.replace(/([A-Z])/g," $1").trim().replace(/^./,e=>e.toUpperCase()).replace("project Manager","Project Manager").replace("technical Director","Technical Director"):"Unknown Role"}),T(s.status)]}),e.jsx("span",{className:"text-sm text-gray-500",children:R(s.timestamp)})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-3",children:[s.decided_by&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wider",children:"Decided By"}),e.jsx("p",{className:"text-sm font-medium text-gray-900 mt-1",children:s.decided_by})]}),(s.sender||s.receiver)&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wider",children:"Workflow"}),e.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[e.jsx("span",{className:"text-sm font-medium capitalize",children:s.sender?.replace(/([A-Z])/g," $1").trim()||""}),s.sender&&s.receiver&&e.jsxs(e.Fragment,{children:[e.jsx(J,{className:"h-3 w-3 text-gray-400"}),e.jsx("span",{className:"text-sm font-medium capitalize",children:s.receiver?.replace(/([A-Z])/g," $1").trim()||""})]})]})]})]}),s.comments&&e.jsx("div",{className:"bg-blue-50 rounded-lg p-3 border border-blue-100",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(W,{className:"h-4 w-4 text-blue-600 mt-0.5"}),e.jsx("p",{className:"text-sm text-blue-900 flex-1",children:s.comments})]})}),s.rejection_reason&&e.jsx("div",{className:"mt-3 bg-red-50 rounded-lg p-3 border border-red-100",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(I,{className:"h-4 w-4 text-red-600 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-red-900",children:"Rejection Reason"}),e.jsx("p",{className:"text-sm text-red-700 mt-1",children:s.rejection_reason}),s.reject_category&&e.jsx(c,{className:"bg-red-100 text-red-700 mt-2",children:s.reject_category})]})]})})]})]},a))})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Q,{className:"h-16 w-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"No History Available"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"No approval history has been recorded."})]})})()]})]})]})]}):null]})})},Ne=()=>{const[x,f]=s.useState("pending"),[C,A]=s.useState([]),[k,L]=s.useState([]),[D,P]=s.useState(!0),[T,z]=s.useState(""),[I,q]=s.useState(!1),[F,O]=s.useState("all"),[H,U]=s.useState("all"),[M,B]=s.useState("all"),[Z,G]=s.useState("all"),[J,W]=s.useState(!1),[te,le]=s.useState(!1),[re,ce]=s.useState(!1),[ie,ne]=s.useState(null),[de,xe]=s.useState(null),[me,oe]=s.useState("approve"),[pe,Ne]=s.useState({pendingCount:0,approvedCount:0,rejectedCount:0,completedCount:0,totalValue:0,avgProcessingTime:0,totalQuantity:0}),ve=async()=>{try{P(!0);const e=await he.getTechnicalDirectorPurchases();if(e&&e.purchases){const s=e.purchases;A(s);let a=[],t=[],l=[],r=[];s.forEach(e=>{if("completed"===e.latest_status?.status||"complete"===e.latest_status?.status||!0===e.accounts_acknowledgement)r.push(e);else{const s=e.technical_director_status?.toLowerCase();"pending"!==s&&s?"approved"===s?t.push(e):"rejected"===s&&l.push(e):"approved"===e.estimation_status&&a.push(e)}});const c=a.reduce((e,s)=>e+(s.total_cost||0),0),i=a.reduce((e,s)=>e+(s.total_quantity||0),0);Ne({pendingCount:a.length,approvedCount:t.length,rejectedCount:l.length,completedCount:r.length,totalValue:c,avgProcessingTime:0,totalQuantity:i})}else A([]),Ne({pendingCount:0,approvedCount:0,rejectedCount:0,totalValue:0,avgProcessingTime:0,totalQuantity:0})}catch(e){A([]),Ne({pendingCount:0,approvedCount:0,rejectedCount:0,completedCount:0,totalValue:0,avgProcessingTime:0,totalQuantity:0})}finally{P(!1)}};s.useEffect(()=>{ve()},[]),s.useEffect(()=>{let e=[...C];switch(x){case"pending":e=C.filter(e=>{if("completed"===e.latest_status?.status||"complete"===e.latest_status?.status||!0===e.accounts_acknowledgement)return!1;const s=e.technical_director_status?.toLowerCase(),a=e.estimation_status?.toLowerCase();return(!s||"pending"===s)&&"approved"===a});break;case"approved":e=C.filter(e=>{if("completed"===e.latest_status?.status||"complete"===e.latest_status?.status||!0===e.accounts_acknowledgement)return!1;const s=e.technical_director_status?.toLowerCase();return"approved"===s});break;case"rejected":e=C.filter(e=>{if("completed"===e.latest_status?.status||"complete"===e.latest_status?.status||!0===e.accounts_acknowledgement)return!1;const s=e.technical_director_status?.toLowerCase();return"rejected"===s});break;case"completed":e=C.filter(e=>"completed"===e.latest_status?.status||"complete"===e.latest_status?.status||!0===e.accounts_acknowledgement)}if(T&&(e=e.filter(e=>e.purchase_id.toString().includes(T)||e.site_location.toLowerCase().includes(T.toLowerCase())||e.purpose.toLowerCase().includes(T.toLowerCase())||e.project_id?.toString().includes(T))),"all"!==F&&(e=e.filter(e=>(e.technical_director_status?.toLowerCase()||"pending")===F)),"all"!==H&&(e=e.filter(e=>e.project_id===H)),"all"!==M&&(e=e.filter(e=>e.site_location===M)),"all"!==Z){const s=new Date,a=e=>{const a=new Date(e);switch(Z){case"today":return a.toDateString()===s.toDateString();case"week":return a>=new Date(s.getTime()-6048e5);case"month":return a>=new Date(s.getTime()-2592e6);case"quarter":return a>=new Date(s.getTime()-7776e6);default:return!0}};e=e.filter(e=>a(e.date||e.created_at))}e.sort((e,s)=>{const a=e=>e.latest_status?.date?new Date(e.latest_status.date).getTime():e.last_modified_at?new Date(e.last_modified_at).getTime():e.created_at?new Date(e.created_at).getTime():new Date(e.date).getTime(),t=a(e);return a(s)-t}),L(e)},[C,x,T,F,H,M,Z]);const ye=e=>{ne(e),oe("approve"),W(!0)},fe=e=>{ne(e),oe("reject"),W(!0)},be=e=>{const s=C.find(s=>s.purchase_id===e);s&&(xe(s),ne(e),le(!0))},we=e=>{const s=C.find(s=>s.purchase_id===e);s&&(xe(s),ne(e),ce(!0))},_e=()=>"all"!==F||"all"!==H||"all"!==M||"all"!==Z;return D&&0===C.length?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx(n,{variant:"pulse-wave",size:"lg"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Loading purchases..."})]})}):e.jsxs("div",{className:"w-full px-4 sm:px-6 lg:px-8 py-6",children:[e.jsx("div",{className:"mb-4",children:e.jsx(b.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"bg-gradient-to-r from-[#243d8a]/5 to-[#243d8a]/10 rounded-xl shadow-xl p-6 border border-[#243d8a]/20",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 bg-[#243d8a] rounded-lg shadow-lg",children:e.jsx(R,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-[#243d8a]",children:"Technical Director Hub"}),e.jsx("p",{className:"text-[#243d8a]/80 mt-1",children:"Review and approve technical specifications"})]})]})})}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-3 sm:gap-4 mb-6",children:[e.jsxs(o,{className:"hover:shadow-md transition-shadow",children:[e.jsx(h,{className:"pb-1 px-3",children:e.jsxs(p,{className:"text-xs font-medium text-gray-600 flex items-center gap-1",children:[e.jsx(Q,{className:"h-3 w-3 text-indigo-500 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:"Pending Review"})]})}),e.jsxs(j,{className:"px-3 pb-3",children:[e.jsx("p",{className:"text-lg font-bold text-indigo-600",children:pe.pendingCount}),e.jsx("p",{className:"text-xs text-gray-500 truncate",children:"Awaiting approval"})]})]}),e.jsxs(o,{className:"hover:shadow-md transition-shadow",children:[e.jsx(h,{className:"pb-1 px-3",children:e.jsxs(p,{className:"text-xs font-medium text-gray-600 flex items-center gap-1",children:[e.jsx(Y,{className:"h-3 w-3 text-green-500 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:"Approved"})]})}),e.jsxs(j,{className:"px-3 pb-3",children:[e.jsx("p",{className:"text-lg font-bold text-green-600",children:pe.approvedCount}),e.jsx("p",{className:"text-xs text-gray-500 truncate",children:"Sent to Accounts"})]})]}),e.jsxs(o,{className:"hover:shadow-md transition-shadow",children:[e.jsx(h,{className:"pb-1 px-3",children:e.jsxs(p,{className:"text-xs font-medium text-gray-600 flex items-center gap-1",children:[e.jsx(K,{className:"h-3 w-3 text-red-500 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:"Rejected"})]})}),e.jsxs(j,{className:"px-3 pb-3",children:[e.jsx("p",{className:"text-lg font-bold text-red-600",children:pe.rejectedCount}),e.jsx("p",{className:"text-xs text-gray-500 truncate",children:"Sent back"})]})]}),e.jsxs(o,{className:"hover:shadow-md transition-shadow",children:[e.jsx(h,{className:"pb-1 px-3",children:e.jsxs(p,{className:"text-xs font-medium text-gray-600 flex items-center gap-1",children:[e.jsx(S,{className:"h-3 w-3 text-green-500 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:"Total Value"})]})}),e.jsxs(j,{className:"px-3 pb-3",children:[e.jsx("p",{className:"text-sm font-bold text-green-600 truncate",children:(Ce=pe.totalValue,`AED ${Ce.toLocaleString()}`)}),e.jsx("p",{className:"text-xs text-gray-500 truncate",children:"Pending value"})]})]}),e.jsxs(o,{className:"hover:shadow-md transition-shadow",children:[e.jsx(h,{className:"pb-1 px-3",children:e.jsxs(p,{className:"text-xs font-medium text-gray-600 flex items-center gap-1",children:[e.jsx(X,{className:"h-3 w-3 text-purple-500 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:"Total Quantity"})]})}),e.jsxs(j,{className:"px-3 pb-3",children:[e.jsx("p",{className:"text-lg font-bold text-purple-600",children:pe.totalQuantity}),e.jsx("p",{className:"text-xs text-gray-500 truncate",children:"Pending items"})]})]})]}),e.jsxs("div",{className:"mb-4 sm:mb-6 space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1 lg:max-w-2xl",children:[e.jsx(ee,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-3.5 w-3.5 sm:h-4 sm:w-4"}),e.jsx(m,{placeholder:"Search purchases...",value:T,onChange:e=>z(e.target.value),className:"pl-8 sm:pl-10 h-9 sm:h-10 text-sm sm:text-base bg-white border-gray-200 focus:border-indigo-500 focus:ring-indigo-500"})]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(i,{onClick:()=>q(!I),variant:"outline",size:"sm",className:"flex items-center gap-2 "+(I?"bg-indigo-50 border-indigo-300 text-indigo-700":""),children:[e.jsx(se,{className:"h-4 w-4"}),"Filters",_e()&&e.jsx(c,{variant:"secondary",className:"bg-indigo-100 text-indigo-800 text-xs px-1.5 py-0.5 ml-1",children:[F,H,M,Z].filter(e=>"all"!==e).length})]})})]}),e.jsx(w,{children:I&&e.jsx(b.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.2},className:"overflow-hidden",children:e.jsxs(o,{className:"p-4",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"Status"}),e.jsxs(u,{value:F,onValueChange:O,children:[e.jsx(g,{children:e.jsx(N,{placeholder:"All Status"})}),e.jsxs(v,{children:[e.jsx(y,{value:"all",children:"All Status"}),e.jsx(y,{value:"pending",children:"Pending"}),e.jsx(y,{value:"approved",children:"Approved"}),e.jsx(y,{value:"rejected",children:"Rejected"}),e.jsx(y,{value:"under_review",children:"Under Review"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"Project"}),e.jsxs(u,{value:H,onValueChange:U,children:[e.jsx(g,{children:e.jsx(N,{placeholder:"All Projects"})}),e.jsxs(v,{children:[e.jsx(y,{value:"all",children:"All Projects"}),C.map(e=>e.project_id).filter((e,s,a)=>e&&a.indexOf(e)===s).map(s=>e.jsx(y,{value:s,children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx($,{className:"h-3 w-3"}),"Project ",s]})},s))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"Location"}),e.jsxs(u,{value:M,onValueChange:B,children:[e.jsx(g,{children:e.jsx(N,{placeholder:"All Locations"})}),e.jsxs(v,{children:[e.jsx(y,{value:"all",children:"All Locations"}),C.map(e=>e.site_location).filter((e,s,a)=>e&&a.indexOf(e)===s).map(s=>e.jsx(y,{value:s,children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(_,{className:"h-3 w-3"}),s]})},s))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"Date Range"}),e.jsxs(u,{value:Z,onValueChange:G,children:[e.jsx(g,{children:e.jsx(N,{placeholder:"All Time"})}),e.jsxs(v,{children:[e.jsx(y,{value:"all",children:"All Time"}),e.jsx(y,{value:"today",children:"Today"}),e.jsx(y,{value:"week",children:"Last 7 Days"}),e.jsx(y,{value:"month",children:"Last 30 Days"}),e.jsx(y,{value:"quarter",children:"Last 90 Days"})]})]})]})]}),_e()&&e.jsx("div",{className:"mt-4 flex justify-end",children:e.jsxs(i,{onClick:()=>{O("all"),U("all"),B("all"),G("all")},variant:"outline",size:"sm",className:"text-red-600 hover:text-red-700",children:[e.jsx(ae,{className:"h-4 w-4 mr-2"}),"Clear All Filters"]})})]})})})]}),e.jsxs(a,{value:x,onValueChange:f,className:"space-y-4 sm:space-y-6",children:[e.jsx("div",{className:"overflow-x-auto -mx-4 px-4 sm:mx-0 sm:px-0",children:e.jsxs(t,{className:"grid w-full min-w-[360px] max-w-none lg:max-w-3xl grid-cols-4 bg-gray-100 h-auto",children:[e.jsxs(l,{value:"pending",className:"flex items-center justify-center gap-1 sm:gap-2 data-[state=active]:bg-white data-[state=active]:text-indigo-600 text-xs sm:text-sm py-2 sm:py-2.5 whitespace-nowrap",children:[e.jsx(Q,{className:"h-3 w-3 sm:h-4 sm:w-4 flex-shrink-0"}),e.jsx("span",{className:"hidden xs:inline",children:"Pending"}),e.jsxs("span",{className:"text-[10px] xs:text-xs sm:text-sm",children:["(",pe.pendingCount,")"]})]}),e.jsxs(l,{value:"approved",className:"flex items-center justify-center gap-1 sm:gap-2 data-[state=active]:bg-white data-[state=active]:text-green-600 text-xs sm:text-sm py-2 sm:py-2.5 whitespace-nowrap",children:[e.jsx(Y,{className:"h-3 w-3 sm:h-4 sm:w-4 flex-shrink-0"}),e.jsx("span",{className:"hidden xs:inline",children:"Approved"}),e.jsxs("span",{className:"text-[10px] xs:text-xs sm:text-sm",children:["(",pe.approvedCount,")"]})]}),e.jsxs(l,{value:"rejected",className:"flex items-center justify-center gap-1 sm:gap-2 data-[state=active]:bg-white data-[state=active]:text-red-600 text-xs sm:text-sm py-2 sm:py-2.5 whitespace-nowrap",children:[e.jsx(K,{className:"h-3 w-3 sm:h-4 sm:w-4 flex-shrink-0"}),e.jsx("span",{className:"hidden xs:inline",children:"Rejected"}),e.jsxs("span",{className:"text-[10px] xs:text-xs sm:text-sm",children:["(",pe.rejectedCount,")"]})]}),e.jsxs(l,{value:"completed",className:"flex items-center justify-center gap-1 sm:gap-2 data-[state=active]:bg-white data-[state=active]:text-blue-600 text-xs sm:text-sm py-2 sm:py-2.5 whitespace-nowrap",children:[e.jsx(V,{className:"h-3 w-3 sm:h-4 sm:w-4 flex-shrink-0"}),e.jsx("span",{className:"hidden xs:inline",children:"Completed"}),e.jsxs("span",{className:"text-[10px] xs:text-xs sm:text-sm",children:["(",pe.completedCount,")"]})]})]})}),e.jsx(r,{value:"pending",className:"space-y-4",children:D?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx(n,{variant:"pulse-wave",size:"lg"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Loading purchases..."})]})}):0===k.length?e.jsx(o,{children:e.jsxs(j,{className:"flex flex-col items-center justify-center py-8 sm:py-12",children:[e.jsx(E,{className:"h-10 w-10 sm:h-12 sm:w-12 text-gray-400 mb-3 sm:mb-4"}),e.jsx("p",{className:"text-base sm:text-lg font-medium text-gray-900",children:"No purchases found"}),e.jsx("p",{className:"text-xs sm:text-sm text-gray-500 mt-1 text-center px-4",children:T?"Try adjusting your search criteria":"No purchases require technical review at this time"})]})}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-3",children:e.jsx(w,{mode:"popLayout",children:k.map(s=>e.jsx(je,{purchase:s,onApprove:ye,onReject:fe,onViewDetails:be,onViewHistory:we,isLoading:D},s.purchase_id))})})}),e.jsx(r,{value:"approved",className:"space-y-4",children:D?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx(n,{variant:"pulse-wave",size:"lg"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Loading purchases..."})]})}):0===k.length?e.jsx(o,{children:e.jsxs(j,{className:"flex flex-col items-center justify-center py-8 sm:py-12",children:[e.jsx(Y,{className:"h-10 w-10 sm:h-12 sm:w-12 text-green-500 mb-3 sm:mb-4"}),e.jsx("p",{className:"text-base sm:text-lg font-medium text-gray-900",children:"No approved purchases"}),e.jsx("p",{className:"text-xs sm:text-sm text-gray-500 mt-1 text-center px-4",children:"Approved purchases will appear here"})]})}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-3",children:e.jsx(w,{mode:"popLayout",children:k.map(s=>e.jsx(je,{purchase:s,onApprove:ye,onReject:fe,onViewDetails:be,onViewHistory:we,isLoading:D},s.purchase_id))})})}),e.jsx(r,{value:"rejected",className:"space-y-4",children:D?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx(n,{variant:"pulse-wave",size:"lg"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Loading purchases..."})]})}):0===k.length?e.jsx(o,{children:e.jsxs(j,{className:"flex flex-col items-center justify-center py-8 sm:py-12",children:[e.jsx(K,{className:"h-10 w-10 sm:h-12 sm:w-12 text-red-500 mb-3 sm:mb-4"}),e.jsx("p",{className:"text-base sm:text-lg font-medium text-gray-900",children:"No rejected purchases"}),e.jsx("p",{className:"text-xs sm:text-sm text-gray-500 mt-1 text-center px-4",children:"Rejected purchases will appear here"})]})}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-3",children:e.jsx(w,{mode:"popLayout",children:k.map(s=>e.jsx(je,{purchase:s,onApprove:ye,onReject:fe,onViewDetails:be,onViewHistory:we,isLoading:D},s.purchase_id))})})}),e.jsx(r,{value:"completed",className:"space-y-4",children:D?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx(n,{variant:"pulse-wave",size:"lg"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Loading purchases..."})]})}):0===k.length?e.jsx(o,{children:e.jsxs(j,{className:"flex flex-col items-center justify-center py-8 sm:py-12",children:[e.jsx(V,{className:"h-10 w-10 sm:h-12 sm:w-12 text-blue-500 mb-3 sm:mb-4"}),e.jsx("p",{className:"text-base sm:text-lg font-medium text-gray-900",children:"No completed purchases"}),e.jsx("p",{className:"text-xs sm:text-sm text-gray-500 mt-1 text-center px-4",children:"Completed purchases will appear here"})]})}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-3",children:e.jsx(w,{mode:"popLayout",children:k.map(s=>e.jsx(je,{purchase:s,onApprove:ye,onReject:fe,onViewDetails:be,onViewHistory:we,isLoading:D},s.purchase_id))})})})]}),e.jsx(ue,{isOpen:J,onClose:()=>W(!1),purchaseId:ie,mode:me,onSuccess:async()=>{P(!0),await new Promise(e=>setTimeout(e,1500)),await ve(),"approve"===me?(f("approved"),d.success("Purchase approved successfully")):"reject"===me&&(f("rejected"),d.success("Purchase rejected successfully"))}}),e.jsx(ge,{isOpen:te,onClose:()=>{le(!1),xe(null)},purchaseId:ie}),e.jsx(ge,{isOpen:re,onClose:()=>{ce(!1),xe(null)},purchaseId:ie,showHistoryOnly:!0})]});var Ce};export{Ne as default};
