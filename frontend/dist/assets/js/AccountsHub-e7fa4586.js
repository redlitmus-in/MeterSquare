import{j as e,P as s,C as a,R as t,T as n}from"./radix-ui-34961435.js";import{r,R as c}from"./react-vendor-3707ac94.js";import{d as l,b as i,c as o,a as d,B as m,t as x,M as p}from"./index-12cad093.js";import{T as h,a as u,b as g,c as j}from"./tabs-8d248749.js";import{I as f}from"./input-dbd0a11e.js";import{C as y,b as N,c as v,a as w}from"./card-e62b6216.js";import{S as b,a as _,b as C,c as S,d as P}from"./select-767f455e.js";import{L as k}from"./label-d100d551.js";import{S as A}from"./separator-a0f6b9f9.js";import{a as D,Q as T,U as F,u as E,g as L,ag as O,aG as $,E as z,aH as R,aA as I,v as V,aw as q,am as M,aF as U,an as B,X as G,F as H,z as Y,aI as W,ao as J,w as K,aJ as Q,aj as X,i as Z,aK as ee,aL as se,q as ae,a3 as te,M as ne,e as re,N as ce,af as le,ae as ie,ad as oe}from"./icons-2fde7931.js";import{D as de,a as me,b as xe,c as pe,e as he,d as ue}from"./dialog-d443819a.js";import{T as ge}from"./textarea-ff7bd289.js";import{P as je}from"./progress-c4fdb9d3.js";import{A as fe,m as ye}from"./ui-vendor-42d562f2.js";import{a as Ne}from"./dateFormatter-3b370b4b.js";import{_ as ve}from"./auth-f9290e45.js";import"./utils-8e4480a0.js";import"./forms-337f692b.js";const we=t,be=n,_e=r.forwardRef(({className:t,align:n="center",sideOffset:r=4,...c},i)=>e.jsx(s,{children:e.jsx(a,{ref:i,align:n,sideOffset:r,className:l("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...c})}));_e.displayName=a.displayName;const Ce=new class{async processPaymentTransaction(e){try{return(await i.post(o.ACCOUNTS.PROCESS_PAYMENT,e)).data}catch(s){throw s}}async approvePaymentTransaction(e){try{return(await i.post(o.ACCOUNTS.APPROVE_PAYMENT,e)).data}catch(s){throw s}}async createAcknowledgement(e){try{return(await i.post(o.ACCOUNTS.CREATE_ACKNOWLEDGEMENT,e)).data}catch(s){throw s}}async getPaymentTransactions(e){try{return(await i.get(o.ACCOUNTS.GET_PAYMENTS,{params:e})).data}catch(s){throw s}}async getAcknowledgements(e){try{return(await i.get(o.ACCOUNTS.GET_ACKNOWLEDGEMENTS,{params:e})).data}catch(s){throw s}}async getFinancialSummary(e){try{return(await i.get(o.ACCOUNTS.FINANCIAL_SUMMARY,{params:e})).data}catch(s){throw s}}async getPendingApprovals(){try{return(await i.get(o.ACCOUNTS.PENDING_APPROVALS)).data}catch(e){throw e}}async getAccountsDashboard(e){try{return(await i.get(o.ACCOUNTS.DASHBOARD,{params:e})).data}catch(s){if(404===s.response?.status||500===s.response?.status)return{accounts_as_sender:{total_sent:0,approved:0,rejected:0,pending:0,approval_rate:0},accounts_as_receiver:{total_received:0,approved:0,rejected:0,pending:0,approval_rate:0}};throw s}}async getAccountsPurchases(e){try{const s=e?{sort:e}:void 0;return(await i.get(o.ACCOUNTS.GET_PURCHASES,{params:s})).data}catch(s){if(404===s.response?.status||500===s.response?.status)return{success:!0,message:"No purchases found",purchase_details:[]};throw s}}async getPurchaseDetails(e){try{return(await i.get(`/purchase/${e}`)).data}catch(s){try{const s=await this.getAccountsPurchases(),a=s.purchase_details?.find(s=>s.purchase_id===e);if(a){const e=a.material_details||a.materials||[],s=e.reduce((e,s)=>e+(s.cost||s.unit_cost||0)*(s.quantity||1),0);return{success:!0,purchase:{...a,materials:e,total_cost:s,payment_transaction:a.payment_transaction},materials:e,latest_status:a.latest_status,payment_transaction:a.payment_transaction,history:[]}}}catch(a){}if(404===s.response?.status)return{success:!1,message:"Purchase details not found",purchase:null,materials:[],history:[]};if(403===s.response?.status)return{success:!1,message:"You do not have permission to view this purchase",purchase:null,materials:[],history:[]};throw s}}async getPaymentDetails(e){try{return(await i.get(`/purchase_payment/${e}`)).data}catch(s){if(404===s.response?.status)return{success:!1,message:"Payment details not found",payment:null};throw s}}async getPurchaseHistory(e){try{return(await i.get(`/purchase_history/${e}`)).data}catch(s){if(404===s.response?.status)return{success:!1,message:"Purchase history not found",purchase:null,history:[]};if(403===s.response?.status)return{success:!1,message:"You do not have permission to view purchase history",purchase:null,history:[]};throw s}}getAccountsStatus(e){if(e.accounts_status)return e.accounts_status;if(e.latest_status){const s="accounts"===e.latest_status.sender,a="accounts"===e.latest_status.receiver;if(s)return e.latest_status.status||"pending";if(a&&"pending"===e.latest_status.status)return"pending"}return"pending"}needsAccountsProcessing(e){const s=e.accounts_status;if("payment_processed"===s||"payment_rejected"===s)return!1;return"approved"===e.technical_director_status&&(!s||"pending"===s)}hasPaymentPendingApproval(e){return"payment_processing"===e.accounts_status}formatCurrency(e){return`AED ${e.toLocaleString()}`}getPaymentMethodDisplayName(e){return{bank_transfer:"Bank Transfer",check:"Check",cash:"Cash",credit_card:"Credit Card",online_payment:"Online Payment"}[e]||e}getTransactionStatusColor(e){switch(e?.toLowerCase()){case"processed":return"bg-green-100 text-green-800 border-green-200";case"failed":return"bg-red-100 text-red-800 border-red-200";default:return"bg-yellow-100 text-yellow-800 border-yellow-200"}}async getPaymentTransactionDetails(e){try{return(await i.get(`/purchase_payment/${e}`)).data}catch(s){if(404===s.response?.status)return{success:!1,message:"Transaction details not found",transaction:null};throw s}}async uploadFile(e,s){try{const a=new FormData;s.forEach(e=>{a.append("file",e)});return(await i.post(`/upload_file?key=accounts&id=${e}`,a,{headers:{"Content-Type":"multipart/form-data"}})).data}catch(a){throw a}}async getUploadedFiles(e){try{return(await i.get(`/download_files?key=accounts&id=${e}`)).data}catch(s){throw s}}async deleteUploadedFile(e,s){try{return(await i.delete(`/delete_file?key=accounts&id=${e}`,{data:{filename:s}})).data}catch(a){throw a}}},Se=({purchase:s,onProcessPayment:a,onApprovePayment:t,onRejectPayment:n,onViewDetails:r,onViewPayment:c,onViewTransactionDetails:l,onSendAcknowledgement:i,isLoading:o=!1})=>{const x=s.latest_status;let p="pending",h="pending",u=!1,g=!1,j=!1;const f=s.acknowledgement||s.acknowledgement_sent;if(x){const e=x.sender,s=x.receiver,a=x.status?.toLowerCase();"technicalDirector"===e&&"accounts"===s&&"approved"===a?(h="approved",p="pending",u=!0):"accounts"===e&&("pending"===a?(p="payment_processing",g=!0):"approved"===a||"payment_processed"===a||"completed"===a||"transferred"===a||"payment_processing"===a?(p="payment_processed",h="approved",j=!0):"rejected"===a&&(p="payment_rejected")),"accounts"!==e||"completed"!==a&&"payment_processing"!==a||(h="approved")}else p=s.accounts_status?.toLowerCase()||"pending",h=s.technical_director_status?.toLowerCase()||"pending",u="approved"===h&&(!p||"pending"===p),g="payment_processing"===p,j="payment_processed"===p||"approved"===p||"transferred"===p||"completed"===p;const b=s.materials?.[0]?.priority||"medium";return e.jsx("div",{className:"h-full",children:e.jsxs(y,{className:"h-full hover:shadow-lg transition-shadow max-w-sm mx-auto",children:[e.jsx(N,{className:"pb-2 px-4 pt-4",children:e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs(v,{className:"text-base font-semibold truncate",children:["PR #",s.purchase_id]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-0.5 truncate",children:["Project: ",s.project_id]})]}),e.jsxs("div",{className:"flex flex-col gap-1 items-end flex-shrink-0",children:[e.jsx(d,{className:`${(()=>{switch(p){case"payment_processed":return"bg-green-100 text-green-800 border-green-200";case"payment_rejected":return"bg-red-100 text-red-800 border-red-200";case"payment_processing":return"bg-blue-100 text-blue-800 border-blue-200";default:return"bg-yellow-100 text-yellow-800 border-yellow-200"}})()} text-xs`,variant:"outline",children:j?"Completed":"pending"===p?"Pending":"payment_processing"===p?"Processing":"payment_processed"===p?"Completed":"payment_rejected"===p?"Rejected":"Pending"}),f&&j&&e.jsxs(d,{className:"bg-blue-100 text-blue-800 border-blue-200 text-xs",variant:"outline",children:[e.jsx(D,{className:"h-2.5 w-2.5 mr-0.5"}),"Ack'd"]}),e.jsxs(d,{className:`${(()=>{switch(b?.toLowerCase()){case"high":return"bg-red-100 text-red-800 border-red-200";case"medium":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"low":return"bg-green-100 text-green-800 border-green-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}})()} text-xs`,variant:"outline",children:[b?.charAt(0).toUpperCase()+b?.slice(1)," priority"]})]})]})}),e.jsxs(w,{className:"space-y-3 px-4 pb-4",children:[e.jsxs("div",{className:"space-y-1.5 text-xs",children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-gray-600",children:[e.jsx(T,{className:"h-3 w-3 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:s.site_location})]}),e.jsxs("div",{className:"flex items-center gap-1.5 text-gray-600",children:[e.jsx(F,{className:"h-3 w-3 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:s.requested_by})]}),e.jsxs("div",{className:"flex items-center gap-1.5 text-gray-600",children:[e.jsx(E,{className:"h-3 w-3 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:new Date(s.date).toLocaleDateString()})]})]}),e.jsx(A,{}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-gray-600",children:[e.jsx(L,{className:"h-3 w-3"}),e.jsxs("span",{children:[s.material_count||0," items"]})]}),e.jsxs("span",{className:"text-gray-600",children:["Qty: ",s.total_quantity||0]})]}),e.jsxs("div",{className:"flex items-center justify-between bg-green-50 rounded-md px-2 py-1.5",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(O,{className:"h-3 w-3 text-green-600"}),e.jsx("span",{className:"text-xs font-medium text-green-900",children:"Total"})]}),e.jsx("span",{className:"text-xs font-bold text-green-600 truncate",children:Ce.formatCurrency(s.total_cost||0)})]})]}),e.jsx("div",{className:"bg-gray-50 rounded-md px-2 py-1.5 text-xs",children:e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("span",{className:"text-gray-600 truncate",children:"Technical Director:"}),e.jsx(d,{className:("approved"===h||j?"bg-green-100 text-green-700":"bg-yellow-100 text-yellow-700")+" text-xs",variant:"outline",children:j?"approved":h})]})}),g&&s.payment_details&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-md px-2 py-1.5",children:[e.jsxs("div",{className:"flex items-center gap-1 mb-0.5",children:[e.jsx($,{className:"h-2.5 w-2.5 text-blue-600"}),e.jsx("span",{className:"text-xs font-medium text-blue-700",children:"Payment"})]}),e.jsx("p",{className:"text-xs text-blue-600 truncate",children:s.payment_details.payment_method||"Bank Transfer"}),s.payment_details.vendor_name&&e.jsx("p",{className:"text-xs text-blue-600 truncate",children:s.payment_details.vendor_name})]}),"payment_rejected"===p&&s.accounts_rejection_reason&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-md px-2 py-1.5",children:e.jsxs("p",{className:"text-xs text-red-700 line-clamp-2",children:[e.jsx("span",{className:"font-medium",children:"Reason:"})," ",s.accounts_rejection_reason]})}),e.jsx(A,{}),e.jsx("div",{className:"space-y-1.5",children:j?e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-1.5",children:[e.jsxs(m,{onClick:()=>r(s.purchase_id),variant:"outline",className:"w-full h-8 text-xs",size:"sm",children:[e.jsx(z,{className:"h-3 w-3 mr-1"}),"Details"]}),l&&e.jsxs(m,{onClick:()=>l(s.purchase_id),variant:"outline",className:"w-full border-blue-200 text-blue-600 hover:bg-blue-50 h-8 text-xs",size:"sm",children:[e.jsx(R,{className:"h-3 w-3 mr-1"}),"Transaction"]})]}),i&&e.jsx(m,{onClick:()=>i(s.purchase_id),className:"w-full h-8 text-xs "+(f?"bg-gray-300 cursor-not-allowed text-gray-500":"bg-green-600 hover:bg-green-700 text-white"),size:"sm",disabled:f,children:f?e.jsxs(e.Fragment,{children:[e.jsx(D,{className:"h-3 w-3 mr-1"}),"Ack Sent"]}):e.jsxs(e.Fragment,{children:[e.jsx(I,{className:"h-3 w-3 mr-1"}),"Send Ack"]})})]}):u?e.jsxs(e.Fragment,{children:[e.jsxs(m,{onClick:()=>a(s.purchase_id),disabled:o,className:"w-full bg-green-600 hover:bg-green-700 text-white h-8 text-xs",size:"sm",children:[e.jsx($,{className:"h-3 w-3 mr-1"}),"Process Payment"]}),e.jsxs(m,{onClick:()=>r(s.purchase_id),variant:"outline",size:"sm",className:"w-full h-8 text-xs",children:[e.jsx(z,{className:"h-3 w-3 mr-1"}),"View Details"]})]}):g?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 gap-1.5",children:[e.jsxs(m,{onClick:()=>t(s.purchase_id),disabled:o,className:"bg-green-600 hover:bg-green-700 text-white h-8 text-xs",size:"sm",children:[e.jsx(D,{className:"h-3 w-3 mr-1"}),"Approve"]}),e.jsxs(m,{onClick:()=>n(s.purchase_id),disabled:o,variant:"outline",className:"border-red-200 text-red-600 hover:bg-red-50 h-8 text-xs",size:"sm",children:[e.jsx(V,{className:"h-3 w-3 mr-1"}),"Reject"]})]}),e.jsxs(m,{onClick:()=>r(s.purchase_id),variant:"outline",size:"sm",className:"w-full h-8 text-xs",children:[e.jsx(z,{className:"h-3 w-3 mr-1"}),"View Details"]})]}):e.jsxs(m,{onClick:()=>r(s.purchase_id),variant:"outline",className:"w-full h-8 text-xs",size:"sm",children:[e.jsx(z,{className:"h-3 w-3 mr-1"}),"View Details"]})})]})]})})},Pe=({isOpen:s,onClose:a,purchaseId:t,onSuccess:n})=>{const[c,l]=r.useState(!1),[o,d]=r.useState([]),[h,u]=r.useState({}),[g,j]=r.useState(!1),y=r.useRef(null),[N,v]=r.useState({amount:"",payment_method:"bank_transfer",payment_reference:"",vendor_name:"",vendor_account_details:"",notes:"",supporting_documents:[]});r.useEffect(()=>{s&&t&&(v({amount:"",payment_method:"bank_transfer",payment_reference:"",vendor_name:"",vendor_account_details:"",notes:"",supporting_documents:[]}),d([]),u({}))},[s,t]);const w=r.useCallback(e=>{e.preventDefault(),j(!0)},[]),D=r.useCallback(e=>{e.preventDefault(),j(!1)},[]),T=r.useCallback(e=>{e.preventDefault(),j(!1);const s=Array.from(e.dataTransfer.files);F(s)},[]),F=e=>{const s=e.filter(e=>["image/jpeg","image/png","image/jpg","application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"].includes(e.type)?!(e.size>10485760)||(x.error(`File too large: ${e.name}. Maximum size is 10MB.`),!1):(x.error(`Invalid file type: ${e.name}. Only images, PDFs, and documents are allowed.`),!1));s.length>0&&(d(e=>[...e,...s]),x.info(`${s.length} file(s) selected. They will be uploaded when you create the payment transaction.`))},E=async e=>{if(e.preventDefault(),t&&N.amount)try{l(!0);await Ce.processPaymentTransaction({purchase_id:t,amount:parseFloat(N.amount),payment_method:N.payment_method,payment_reference:N.payment_reference,vendor_name:N.vendor_name,vendor_account_details:N.vendor_account_details,notes:N.notes,supporting_documents:[]});if(x.success("Payment transaction created successfully"),o.length>0){x.info("Uploading supporting documents...");const e=await(async e=>{if(0===o.length)return!0;let s=!0;for(const t of o){const n=new FormData;n.append("file",t);try{u(e=>({...e,[t.name]:0}));const s=setInterval(()=>{u(e=>{const s=e[t.name]||0;return s<90?{...e,[t.name]:s+10}:e})},200),a=await i.post(`/upload_file?key=accounts&id=${e}`,n,{headers:{"Content-Type":"multipart/form-data"}});if(clearInterval(s),!a.data.message)throw new Error("Upload failed");u(e=>({...e,[t.name]:100})),x.success(`File uploaded successfully: ${t.name}`)}catch(a){x.error(`Failed to upload ${t.name}: ${a.response?.data?.error||a.message}`),s=!1,u(e=>{const s={...e};return delete s[t.name],s})}}return s})(t);e?x.success("All files uploaded successfully"):x.warning("Some files failed to upload, but payment transaction was created")}n(),a()}catch(s){x.error(s.message||"Failed to process payment transaction")}finally{l(!1)}else x.error("Please fill in required fields")},L=(e,s)=>{v(a=>({...a,[e]:s}))};return e.jsx(de,{open:s,onOpenChange:a,children:e.jsxs(me,{className:"sm:max-w-[600px] max-h-[90vh] overflow-y-auto",children:[e.jsx(xe,{children:e.jsxs(pe,{className:"flex items-center gap-2",children:[e.jsx($,{className:"h-5 w-5 text-green-600"}),"Process Payment Transaction"]})}),e.jsxs("form",{onSubmit:E,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium text-gray-700",children:[e.jsx(O,{className:"h-4 w-4 text-green-600"}),"Payment Details"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{htmlFor:"amount",children:"Payment Amount (AED) *"}),e.jsx(f,{id:"amount",type:"number",step:"0.01",placeholder:"Enter amount",value:N.amount,onChange:e=>L("amount",e.target.value),className:"focus:border-green-500 focus:ring-green-500",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{htmlFor:"payment_method",children:"Payment Method"}),e.jsxs(b,{value:N.payment_method,onValueChange:e=>L("payment_method",e),children:[e.jsx(_,{className:"focus:border-green-500 focus:ring-green-500",children:e.jsx(C,{})}),e.jsxs(S,{children:[e.jsx(P,{value:"bank_transfer",children:"Bank Transfer"}),e.jsx(P,{value:"check",children:"Check"}),e.jsx(P,{value:"cash",children:"Cash"}),e.jsx(P,{value:"credit_card",children:"Credit Card"}),e.jsx(P,{value:"online_payment",children:"Online Payment"})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{htmlFor:"payment_reference",children:"Payment Reference"}),e.jsx(f,{id:"payment_reference",placeholder:"Transaction reference or check number",value:N.payment_reference,onChange:e=>L("payment_reference",e.target.value),className:"focus:border-green-500 focus:ring-green-500"})]})]}),e.jsx(A,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium text-gray-700",children:[e.jsx(q,{className:"h-4 w-4 text-blue-600"}),"Vendor Information"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{htmlFor:"vendor_name",children:"Vendor Name"}),e.jsx(f,{id:"vendor_name",placeholder:"Enter vendor or supplier name",value:N.vendor_name,onChange:e=>L("vendor_name",e.target.value),className:"focus:border-blue-500 focus:ring-blue-500"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{htmlFor:"vendor_account_details",children:"Vendor Account Details"}),e.jsx(ge,{id:"vendor_account_details",placeholder:"Bank account details, address, or payment instructions",value:N.vendor_account_details,onChange:e=>L("vendor_account_details",e.target.value),className:"focus:border-blue-500 focus:ring-blue-500 min-h-[80px]"})]})]})]}),e.jsx(A,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium text-gray-700",children:[e.jsx(M,{className:"h-4 w-4 text-purple-600"}),"Supporting Documents"]}),e.jsxs("div",{onDragOver:w,onDragLeave:D,onDrop:T,onClick:()=>y.current?.click(),className:`\n                relative border-2 border-dashed rounded-lg p-6 transition-all duration-200 cursor-pointer\n                ${g?"border-purple-500 bg-purple-50":"border-gray-300 hover:border-purple-400 hover:bg-purple-50/50 bg-gray-50/50"}\n              `,children:[e.jsx("input",{ref:y,type:"file",multiple:!0,accept:"image/*,.pdf,.doc,.docx",onChange:e=>{if(e.target.files){const s=Array.from(e.target.files);F(s)}},className:"hidden","aria-label":"Upload payment proof documents"}),e.jsxs("div",{className:"text-center pointer-events-none",children:[e.jsx(U,{className:"mx-auto h-12 w-12 "+(g?"text-purple-500":"text-gray-400")}),e.jsxs("p",{className:"mt-2 text-sm text-gray-600",children:[e.jsx("span",{className:"text-purple-600 font-medium",children:"Click to upload"})," ","or drag and drop"]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"PDF, DOC, DOCX, JPG, PNG up to 10MB"})]})]}),o.length>0&&e.jsx("div",{className:"space-y-2",children:e.jsx(fe,{children:o.map((s,a)=>{const t=h[s.name],n=void 0!==t&&t<100;return e.jsxs(ye.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,x:-10},className:"flex items-center gap-3 p-3 bg-white border border-gray-200 rounded-lg",children:[e.jsx("div",{className:"flex-shrink-0",children:n?e.jsx(p,{variant:"pulse-wave",size:"lg"}):100===t?e.jsx(B,{className:"h-4 w-4 text-green-600"}):(c=s.type,c.startsWith("image/")?e.jsx(W,{className:"h-4 w-4"}):"application/pdf"===c?e.jsx(H,{className:"h-4 w-4"}):e.jsx(J,{className:"h-4 w-4"}))}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:s.name}),e.jsxs("p",{className:"text-xs text-gray-500",children:[(r=s.size,r<1024?r+" B":r<1048576?(r/1024).toFixed(1)+" KB":(r/1048576).toFixed(1)+" MB"),void 0===t&&" • Ready to upload"]}),n&&e.jsx(je,{value:t,className:"h-1 mt-1"})]}),e.jsx(m,{type:"button",variant:"ghost",size:"sm",onClick:()=>(e=>{const s=o[e]?.name;d(s=>s.filter((s,a)=>a!==e)),s&&u(e=>{const a={...e};return delete a[s],a})})(a),disabled:n,className:"flex-shrink-0 p-1 h-auto",children:e.jsx(G,{className:"h-4 w-4 text-gray-500 hover:text-red-500"})})]},`${s.name}-${a}`);var r,c})})})]}),e.jsx(A,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium text-gray-700",children:[e.jsx(H,{className:"h-4 w-4 text-gray-600"}),"Additional Information"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{htmlFor:"notes",children:"Notes"}),e.jsx(ge,{id:"notes",placeholder:"Additional notes or comments",value:N.notes,onChange:e=>L("notes",e.target.value),className:"focus:border-gray-500 focus:ring-gray-500 min-h-[60px]"})]})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Y,{className:"h-5 w-5 text-blue-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"text-sm text-blue-800",children:[e.jsx("p",{className:"font-medium mb-1",children:"Payment Processing Information"}),e.jsx("p",{className:"text-xs text-blue-700",children:"This will create a payment transaction that requires internal approval before processing. You can approve or reject the transaction in the pending approvals section."})]})]})})]}),e.jsxs(he,{children:[e.jsx(m,{type:"button",variant:"outline",onClick:a,disabled:c,children:"Cancel"}),e.jsx(m,{onClick:E,disabled:c||!N.amount,className:"bg-green-600 hover:bg-green-700",children:c?e.jsxs(e.Fragment,{children:[e.jsx(p,{variant:"pulse-wave",size:"lg"}),"Processing..."]}):e.jsxs(e.Fragment,{children:[e.jsx($,{className:"h-4 w-4 mr-2"}),"Create Payment Transaction"]})})]})]})})},ke=({isOpen:s,onClose:a,transactionId:t,mode:n,onSuccess:c})=>{const[l,i]=r.useState(!1),[o,d]=r.useState("");r.useEffect(()=>{s&&d("")},[s]);const h=async e=>{if(e.preventDefault(),t)if("reject"!==n||o.trim())try{i(!0),await Ce.approvePaymentTransaction({transaction_id:t,approval_status:"approve"===n?"approved":"rejected",comments:o.trim()});const e="approve"===n?"approved":"rejected";x.success(`Payment transaction ${e} successfully`),c(),a()}catch(s){x.error(s.message||`Failed to ${n} payment transaction`)}finally{i(!1)}else x.error("Please provide a reason for rejection");else x.error("No transaction selected")},u="approve"===n;return e.jsx(de,{open:s,onOpenChange:a,children:e.jsxs(me,{className:"sm:max-w-[500px]",children:[e.jsx(xe,{children:e.jsxs(pe,{className:"flex items-center gap-2",children:[u?e.jsx(D,{className:"h-5 w-5 text-green-600"}):e.jsx(V,{className:"h-5 w-5 text-red-600"}),u?"Approve Payment":"Reject Payment"]})}),e.jsxs("form",{onSubmit:h,className:"space-y-6",children:[e.jsx("div",{className:"border rounded-lg p-4 "+(u?"bg-green-50 border-green-200":"bg-red-50 border-red-200"),children:e.jsxs("div",{className:"flex items-start gap-3",children:[u?e.jsx(D,{className:"h-5 w-5 text-green-600 mt-0.5 flex-shrink-0"}):e.jsx(K,{className:"h-5 w-5 text-red-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"font-medium "+(u?"text-green-800":"text-red-800"),children:u?"Confirm Payment Approval":"Confirm Payment Rejection"}),e.jsx("p",{className:"text-xs mt-1 "+(u?"text-green-700":"text-red-700"),children:u?"This will process the payment and mark the transaction as completed. The purchase will move to the final completion stage.":"This will reject the payment transaction and send it back to the Technical Director for review."})]})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{htmlFor:"comments",children:u?"Comments (Optional)":"Rejection Reason *"}),e.jsx(ge,{id:"comments",placeholder:u?"Add any additional comments...":"Please specify the reason for rejection...",value:o,onChange:e=>d(e.target.value),className:"min-h-[100px] "+(u?"focus:border-green-500 focus:ring-green-500":"focus:border-red-500 focus:ring-red-500"),required:!u}),!u&&e.jsx("p",{className:"text-xs text-gray-500",children:"This reason will be shared with the Technical Director and requesting department."})]}),t&&e.jsx("div",{className:"bg-gray-50 rounded-lg p-3",children:e.jsxs("p",{className:"text-xs text-gray-600",children:["Transaction ID: ",e.jsxs("span",{className:"font-mono font-medium",children:["#",t]})]})})]}),e.jsxs(he,{children:[e.jsx(m,{type:"button",variant:"outline",onClick:a,disabled:l,children:"Cancel"}),e.jsx(m,{onClick:h,disabled:l||!u&&!o.trim(),className:u?"bg-green-600 hover:bg-green-700":"bg-red-600 hover:bg-red-700",children:l?e.jsxs(e.Fragment,{children:[e.jsx(p,{variant:"pulse-wave",size:"lg"}),"Processing..."]}):e.jsxs(e.Fragment,{children:[u?e.jsx(D,{className:"h-4 w-4 mr-2"}):e.jsx(V,{className:"h-4 w-4 mr-2"}),u?"Approve Payment":"Reject Payment"]})})]})]})})},Ae=({isOpen:s,onClose:a,purchaseId:t})=>{const[n,c]=r.useState(!1),[l,i]=r.useState(null);r.useEffect(()=>{s&&t&&o()},[s,t]);const o=async()=>{try{c(!0);const e=await Ce.getPurchaseDetails(t);if(e&&e.purchase){const s=e.purchase.material_details||e.purchase.materials||[],a=s.reduce((e,s)=>e+(s.cost||s.unit_cost||0)*(s.quantity||1),0);e.purchase.total_cost=e.purchase.total_cost||a,e.purchase.materials=s}i(e)}catch(e){i(null)}finally{c(!1)}},x=e=>`AED ${e.toLocaleString()}`;return s?e.jsx(de,{open:s,onOpenChange:a,children:e.jsxs(me,{className:"max-w-4xl max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsx(xe,{className:"flex-shrink-0",children:e.jsxs(pe,{className:"flex items-center gap-2",children:[e.jsx(H,{className:"h-5 w-5 text-blue-600"}),"Purchase Details",t&&` - PR #${t}`]})}),e.jsx("div",{className:"flex-1 min-h-0 overflow-y-auto scrollbar-hide [&::-webkit-scrollbar]:hidden [-ms-overflow-style:none] [scrollbar-width:none] p-6",children:n?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(p,{variant:"pulse-wave",size:"lg"})}):l?e.jsx("div",{className:"w-full space-y-4",children:l?.purchase&&e.jsxs(ye.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"space-y-4",children:[e.jsxs(y,{children:[e.jsx(N,{children:e.jsxs(v,{className:"text-lg flex items-center gap-2",children:[e.jsx(L,{className:"h-5 w-5 text-blue-600"}),"Purchase Information"]})}),e.jsxs(w,{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(T,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"text-sm text-gray-600",children:"Location:"}),e.jsx("span",{className:"text-sm font-medium",children:l.purchase.site_location})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(F,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"text-sm text-gray-600",children:"Requested by:"}),e.jsx("span",{className:"text-sm font-medium",children:l.purchase.requested_by})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(E,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"text-sm text-gray-600",children:"Date:"}),e.jsx("span",{className:"text-sm font-medium",children:Ne(l.purchase.date)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(O,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"text-sm text-gray-600",children:"Total Cost:"}),e.jsx("span",{className:"text-sm font-bold text-green-600",children:x(l.purchase.total_cost||0)})]})]}),e.jsx(A,{}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Purpose:"}),e.jsx("p",{className:"text-sm mt-1 bg-gray-50 p-2 rounded",children:l.purchase.purpose})]})]})]}),l?.purchase?.materials&&l.purchase.materials.length>0&&e.jsxs(y,{children:[e.jsx(N,{children:e.jsxs(v,{className:"text-lg flex items-center gap-2",children:[e.jsx(L,{className:"h-5 w-5 text-green-600"}),"Materials (",l.purchase.materials.length,")"]})}),e.jsx(w,{children:e.jsx("div",{className:"space-y-3",children:l.purchase.materials.map((s,a)=>e.jsxs("div",{className:"border rounded-lg p-3",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("h4",{className:"font-medium text-sm",children:s.description||s.material_name}),e.jsxs(d,{variant:"outline",className:"text-xs",children:[s.priority||"Medium"," Priority"]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-xs text-gray-600",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Quantity:"})," ",s.quantity," ",s.unit||""]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Unit Cost:"})," ",x(s.cost||s.unit_cost||0)]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Total:"})," ",x((s.quantity||0)*(s.cost||s.unit_cost||0))]})]}),(s.specification||s.specifications)&&e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:[e.jsx("span",{className:"font-medium",children:"Specs:"})," ",s.specification||s.specifications]})]},a))})})]})]})}):e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Y,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Failed to load purchase details"})]})})}),e.jsx("div",{className:"flex justify-end pt-4 border-t border-gray-200 flex-shrink-0",children:e.jsx(m,{variant:"outline",onClick:a,children:"Close"})})]})}):null},De=({isOpen:s,onClose:a,purchaseId:t})=>{const[n,c]=r.useState(!1),[l,i]=r.useState(null);r.useRef(null),r.useEffect(()=>{s&&t&&o()},[s,t]);const o=async()=>{if(t){c(!0);try{const e=await Ce.getPaymentTransactionDetails(t);i(e)}catch(e){x.error("Failed to load transaction details - API endpoints not available"),i(null)}finally{c(!1)}}},h=e=>{switch(e?.toLowerCase()){case"completed":case"success":return"bg-green-100 text-green-800 border-green-200";case"pending":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"processing":return"bg-blue-100 text-blue-800 border-blue-200";case"failed":case"rejected":return"bg-red-100 text-red-800 border-red-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},u=s=>{switch(s?.toLowerCase()){case"bank transfer":return e.jsx(q,{className:"h-4 w-4"});case"credit card":return e.jsx($,{className:"h-4 w-4"});case"cash":return e.jsx(ae,{className:"h-4 w-4"});case"check":case"cheque":return e.jsx(Q,{className:"h-4 w-4"});case"digital wallet":return e.jsx(se,{className:"h-4 w-4"});default:return e.jsx(O,{className:"h-4 w-4"})}},g=e=>{try{return JSON.parse(e)}catch{return e}};return s?e.jsx(de,{open:s,onOpenChange:a,children:e.jsxs(me,{className:"max-w-4xl max-h-[90vh] p-0",children:[e.jsx(xe,{className:"px-6 py-4 border-b",children:e.jsxs(pe,{className:"flex items-center gap-2",children:[e.jsx(R,{className:"h-5 w-5 text-blue-600"}),"Payment Transaction Details"]})}),n?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(p,{variant:"pulse-wave",size:"lg"})}):l?e.jsx("div",{className:"max-h-[calc(90vh-80px)] overflow-y-auto",children:e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx(y,{children:e.jsx(N,{className:"pb-3",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsxs(v,{className:"text-lg flex items-center gap-2",children:[e.jsx(Q,{className:"h-4 w-4"}),"Purchase ID: ",l.purchase_id]}),l.purchase_reference&&e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Reference: ",l.purchase_reference]})]}),l.vendor&&e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:l.vendor.name}),e.jsx("p",{className:"text-xs text-gray-500",children:"Vendor"})]})]})})}),l.transactions&&l.transactions.map((s,a)=>e.jsxs(y,{children:[e.jsx(N,{className:"pb-3",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsxs(v,{className:"text-lg flex items-center gap-2",children:[e.jsx(X,{className:"h-4 w-4"}),"Transaction ID: ",s.transaction_id]}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Type: ",s.transaction_type||"Payment"]})]}),e.jsx(d,{className:h(s.status),variant:"outline",children:s.status})]})}),e.jsxs(w,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[u(s.payment_method),e.jsx("span",{className:"text-gray-500",children:"Method:"}),e.jsx("span",{className:"font-medium capitalize",children:s.payment_method})]}),s.vendor_name&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(q,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:"text-gray-500",children:"Vendor:"}),e.jsx("span",{className:"font-medium",children:s.vendor_name})]}),s.created_by&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(F,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:"text-gray-500",children:"Created by:"}),e.jsx("span",{className:"font-medium",children:s.created_by})]}),s.approval_required&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(Y,{className:"h-4 w-4 text-orange-500"}),e.jsx("span",{className:"text-gray-500",children:"Status:"}),e.jsx("span",{className:"font-medium text-orange-600",children:"Approval Required"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(O,{className:"h-4 w-4 text-green-600"}),e.jsx("span",{className:"text-gray-500",children:"Amount:"}),e.jsxs("span",{className:"font-bold text-green-600",children:[s.currency||"AED"," ",(s.amount||0).toLocaleString()]})]}),s.created_at&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(E,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:"text-gray-500",children:"Created:"}),e.jsx("span",{className:"font-medium",children:new Date(s.created_at).toLocaleString()})]}),s.processed_at&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(Z,{className:"h-4 w-4 text-green-500"}),e.jsx("span",{className:"text-gray-500",children:"Processed:"}),e.jsx("span",{className:"font-medium",children:new Date(s.processed_at).toLocaleString()})]})]})]}),s.payment_reference&&e.jsx("div",{className:"bg-gray-50 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Q,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"text-sm text-gray-600",children:"Payment Reference:"}),e.jsx("span",{className:"font-mono font-medium text-sm",children:s.payment_reference})]})}),s.vendor_account_details&&(()=>{const a=g(s.vendor_account_details);return"object"==typeof a&&null!==a?e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-start gap-2 mb-3",children:[e.jsx(q,{className:"h-4 w-4 text-blue-500 mt-0.5"}),e.jsx("span",{className:"text-sm text-blue-700 font-medium",children:"Vendor Account Details:"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:Object.entries(a).map(([s,a])=>{const t=s.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase()).replace("Account Number","Account").replace("Swift Code","SWIFT").replace("Iban","IBAN");let n=null;return n=s.includes("account")?e.jsx($,{className:"h-3 w-3"}):s.includes("bank")?e.jsx(q,{className:"h-3 w-3"}):s.includes("phone")?e.jsx(te,{className:"h-3 w-3"}):s.includes("email")?e.jsx(ne,{className:"h-3 w-3"}):s.includes("address")?e.jsx(T,{className:"h-3 w-3"}):e.jsx(H,{className:"h-3 w-3"}),e.jsxs("div",{className:"bg-white rounded-md p-2.5 border border-blue-100",children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-gray-500 mb-1",children:[n,e.jsxs("span",{children:[t,":"]})]}),e.jsx("div",{className:"text-sm font-medium text-gray-900",children:String(a)||"-"})]},s)})})]}):e.jsx("div",{className:"bg-blue-50 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(q,{className:"h-4 w-4 text-blue-500 mt-0.5"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-blue-700 font-medium",children:"Vendor Account Details:"}),e.jsx("p",{className:"text-sm text-blue-600 mt-1",children:String(a)})]})]})})})(),s.notes&&e.jsx("div",{className:"bg-amber-50 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(H,{className:"h-4 w-4 text-amber-500 mt-0.5"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-amber-700 font-medium",children:"Notes:"}),e.jsx("p",{className:"text-sm text-amber-600 mt-1",children:s.notes})]})]})}),s.supporting_documents&&(()=>{const a=s.supporting_documents;if("{}"===a||"[]"===a||"object"==typeof a&&0===Object.keys(a).length)return e.jsx("div",{className:"bg-green-50 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{className:"h-4 w-4 text-green-500"}),e.jsx("span",{className:"text-sm text-green-700 font-medium",children:"Supporting Documents:"}),e.jsx("span",{className:"text-sm text-green-600 italic",children:"No documents attached"})]})});let t=a;if("string"==typeof a)try{t=JSON.parse(a)}catch{t=a}return Array.isArray(t)&&t.length>0?e.jsx("div",{className:"bg-green-50 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(H,{className:"h-4 w-4 text-green-500 mt-0.5"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-green-700 font-medium",children:"Supporting Documents:"}),e.jsx("ul",{className:"mt-2 space-y-1",children:t.map((s,a)=>e.jsxs("li",{className:"text-sm text-green-600 flex items-center gap-1",children:[e.jsx("span",{children:"•"}),e.jsx("span",{children:"string"==typeof s?s:s.name||`Document ${a+1}`})]},a))})]})]})}):"object"==typeof t&&null!==t&&Object.keys(t).length>0?e.jsx("div",{className:"bg-green-50 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(H,{className:"h-4 w-4 text-green-500 mt-0.5"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-green-700 font-medium",children:"Supporting Documents:"}),e.jsx("div",{className:"mt-2 space-y-1",children:Object.entries(t).map(([s,a])=>e.jsxs("div",{className:"text-sm text-green-600",children:[e.jsxs("span",{className:"font-medium",children:[s,":"]})," ",String(a)]},s))})]})]})}):"string"==typeof t&&""!==t.trim()?e.jsx("div",{className:"bg-green-50 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{className:"h-4 w-4 text-green-500"}),e.jsx("span",{className:"text-sm text-green-700 font-medium",children:"Supporting Documents:"}),e.jsx("span",{className:"text-sm text-green-600",children:t})]})}):e.jsx("div",{className:"bg-green-50 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{className:"h-4 w-4 text-green-500"}),e.jsx("span",{className:"text-sm text-green-700 font-medium",children:"Supporting Documents:"}),e.jsx("span",{className:"text-sm text-green-600 italic",children:"No documents attached"})]})})})(),s.failure_reason&&e.jsx("div",{className:"bg-red-50 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(Y,{className:"h-4 w-4 text-red-500 mt-0.5"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-red-700 font-medium",children:"Failure Reason:"}),e.jsx("p",{className:"text-sm text-red-600 mt-1",children:s.failure_reason})]})]})})]})]},s.transaction_id||a)),e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsxs(m,{variant:"outline",onClick:async()=>{if(!l)return;const{default:e}=await ve(()=>import("./export-utils-ef0ca69a.js").then(e=>e.j),["assets/js/export-utils-ef0ca69a.js","assets/js/auth-f9290e45.js","assets/js/react-vendor-3707ac94.js","assets/js/utils-8e4480a0.js"]),s=new e("p","mm","a4"),a=s.internal.pageSize.getWidth(),t=s.internal.pageSize.getHeight();let n=20;s.setFontSize(18),s.setTextColor(30,64,175),s.text("Payment Transaction Details",a/2,n,{align:"center"}),n+=15,s.setFontSize(14),s.setTextColor(0,0,0),s.text(`Purchase ID: ${l.purchase_id}`,20,n),n+=8,l.purchase_reference&&(s.setFontSize(11),s.text(`Reference: ${l.purchase_reference}`,20,n),n+=8),l.vendor&&(s.text(`Vendor: ${l.vendor.name}`,20,n),n+=10),l.transactions.forEach((e,r)=>{if(n>t-40&&(s.addPage(),n=20),s.setFillColor(240,240,240),s.rect(15,n-5,a-30,10,"F"),s.setFontSize(12),s.setTextColor(0,0,0),s.text(`Transaction ID: ${e.transaction_id}`,20,n),n+=10,s.setFontSize(10),s.text(`Status: ${e.status}`,20,n),n+=6,s.setTextColor(0,128,0),s.text(`Amount: ${e.currency||"AED"} ${(e.amount||0).toLocaleString()}`,20,n),s.setTextColor(0,0,0),n+=6,s.text(`Payment Method: ${e.payment_method}`,20,n),n+=6,e.payment_reference&&(s.text(`Payment Reference: ${e.payment_reference}`,20,n),n+=6),e.vendor_account_details){const a=g(e.vendor_account_details);s.setFontSize(11),s.setTextColor(30,64,175),s.text("Vendor Account Details:",20,n),n+=6,s.setFontSize(10),s.setTextColor(0,0,0),"object"==typeof a?Object.entries(a).forEach(([e,a])=>{n>t-20&&(s.addPage(),n=20);const r=e.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase());s.text(`${r}: ${a}`,25,n),n+=5}):(s.text(String(a),25,n),n+=6)}if(e.notes){s.setTextColor(184,134,11),s.text("Notes:",20,n),s.setTextColor(0,0,0),n+=6;s.splitTextToSize(e.notes,a-45).forEach(e=>{n>t-20&&(s.addPage(),n=20),s.text(e,25,n),n+=5})}e.created_at&&(s.setFontSize(9),s.setTextColor(100,100,100),s.text(`Created: ${new Date(e.created_at).toLocaleString()}`,20,n),n+=5),n+=10}),s.setFontSize(8),s.setTextColor(150,150,150),s.text(`Generated on ${(new Date).toLocaleString()}`,a/2,t-10,{align:"center"}),s.save(`payment_transaction_${l.purchase_id}_${(new Date).getTime()}.pdf`),x.success("PDF exported successfully")},className:"bg-red-50 hover:bg-red-100 text-red-700 border-red-200",children:[e.jsx(ee,{className:"h-4 w-4 mr-2"}),"Export as PDF"]}),e.jsx(m,{onClick:a,children:"Close"})]})]})}):e.jsxs("div",{className:"p-12 text-center",children:[e.jsx(Y,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No transaction details available"})]})]})}):null},Te=({isOpen:s,onClose:a,purchase:t,onSuccess:n})=>{const[l,i]=r.useState(""),[o,d]=r.useState([]),[h,u]=r.useState([]),[g,j]=r.useState([]);r.useState(!1);const[f,y]=r.useState(!1),[N,v]=r.useState(!1),[w,b]=r.useState("message");c.useEffect(()=>{if(s&&t){const e=`Payment of AED ${(t.payment_transaction?.amount||t.payment_details?.amount||t.total_cost||0).toLocaleString()} has been successfully processed and settled for Purchase Request #${t.purchase_id}. The transaction has been verified and recorded in our financial system. All materials have been delivered as per specifications and quality standards have been met. Invoice and supporting documents have been archived for audit purposes.`;i(e),d([]),u([]),b("message"),_()}},[s,t]);const _=async()=>{j([]),v(!1)};return t?(g.length,h.length,o.length,e.jsx(de,{open:s,onOpenChange:a,children:e.jsxs(me,{className:"max-w-3xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(xe,{children:[e.jsxs(pe,{className:"flex items-center gap-2",children:[e.jsx(I,{className:"h-5 w-5 text-green-600"}),"Send Payment Acknowledgement"]}),e.jsxs(ue,{children:["Confirm payment settlement for Purchase Request #",t.purchase_id]})]}),e.jsxs("div",{className:"mt-6",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 mb-6",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 mb-2",children:"Purchase Summary"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Purchase ID:"}),e.jsxs("span",{className:"font-medium",children:["#",t.purchase_id]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Project:"}),e.jsx("span",{className:"font-medium",children:t.project_id})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Payment Amount:"}),e.jsxs("span",{className:"font-bold text-green-600",children:["AED ",(t.payment_transaction?.amount||t.total_cost||0).toLocaleString()]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{htmlFor:"message",children:"Acknowledgement Message"}),e.jsx(ge,{id:"message",value:l,onChange:e=>i(e.target.value),placeholder:"Enter acknowledgement message...",className:"min-h-[200px]"}),e.jsx("p",{className:"text-xs text-gray-500",children:"This message will be sent to confirm the payment settlement"})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-6 mt-6 border-t",children:[e.jsx(m,{variant:"outline",onClick:a,disabled:f,children:"Cancel"}),e.jsx(m,{onClick:async()=>{if(t){y(!0);try{let e;t.payment_transaction&&"object"==typeof t.payment_transaction?e=t.payment_transaction.transaction_id:t.payment_details&&"object"==typeof t.payment_details?e=t.payment_details.transaction_id:"transaction_id"in t&&(e=t.transaction_id);const s={purchase_id:t.purchase_id,transaction_id:e,acknowledgement_type:"payment_settled",acknowledgement_message:l,supporting_documents:void 0},r=await Ce.createAcknowledgement(s);r&&r.message&&(x.success("Acknowledgement sent successfully"),i(""),d([]),u([]),j([]),n&&n(),a())}catch(e){x.error(e.response?.data?.error||"Failed to send acknowledgement")}finally{y(!1)}}},disabled:f||!l.trim(),className:"bg-green-600 hover:bg-green-700",children:f?e.jsxs(e.Fragment,{children:[e.jsx(p,{variant:"pulse-wave",size:"lg"}),"Sending..."]}):e.jsxs(e.Fragment,{children:[e.jsx(I,{className:"h-4 w-4 mr-2"}),"Send Acknowledgement"]})})]})]})]})})):null},Fe=()=>{const[s,a]=r.useState("processing"),[t,n]=r.useState([]),[c,l]=r.useState([]),[i,o]=r.useState(!0),[d,A]=r.useState(""),[D,T]=r.useState("date"),[F,E]=r.useState("desc"),[L,z]=r.useState(!1),[R,I]=r.useState({min:"",max:""}),[V,q]=r.useState(""),[M,U]=r.useState(""),[B,H]=r.useState({start:"",end:""}),[W,J]=r.useState(!1),[K,X]=r.useState(!1),[Z,ee]=r.useState(!1),[se,te]=r.useState(!1),[ne,de]=r.useState(!1),[me,xe]=r.useState(null),[pe,he]=r.useState(null),[ue,ge]=r.useState(null),[je,fe]=r.useState("approve"),[Ne,ve]=r.useState({pendingPaymentCount:0,processingCount:0,processedCount:0,rejectedCount:0,totalValue:0,avgProcessingTime:0,totalTransactions:0}),Fe=async()=>{try{o(!0);const e=await Ce.getAccountsPurchases();if(e&&e.purchase_details){const s=e.purchase_details.map(e=>{const s=e.material_details||e.materials||[];return{...e,materials:s,total_cost:s.reduce((e,s)=>e+(s.cost||0)*(s.quantity||1),0)||0,total_quantity:s.reduce((e,s)=>e+(s.quantity||0),0)||0,material_count:s.length||0}});n(s);let a=[],t=[];s.forEach(e=>{const s=e.latest_status;if(s){const n=s.sender,r=s.receiver,c=s.status?.toLowerCase();"technicalDirector"===n&&"accounts"===r&&"approved"===c||"accounts"===n&&"pending"===c?a.push(e):"accounts"!==n||"approved"!==c&&"payment_processed"!==c&&"completed"!==c&&"transferred"!==c&&"payment_processing"!==c||t.push(e)}const n=e.accounts_status?.toLowerCase(),r=e.technical_director_status?.toLowerCase();e.latest_status||(("approved"!==r||n&&"pending"!==n)&&"payment_processing"!==n?"payment_processed"!==n&&"approved"!==n&&"transferred"!==n&&"completed"!==n||t.push(e):a.push(e))});const r=a.reduce((e,s)=>e+(s.total_cost||0),0),c=a.length+t.length;ve({pendingPaymentCount:0,processingCount:a.length,processedCount:t.length,rejectedCount:0,totalValue:r,avgProcessingTime:0,totalTransactions:c})}else n([]),ve({pendingPaymentCount:0,processingCount:0,processedCount:0,rejectedCount:0,totalValue:0,avgProcessingTime:0,totalTransactions:0})}catch(e){n([]),ve({pendingPaymentCount:0,processingCount:0,processedCount:0,rejectedCount:0,totalValue:0,avgProcessingTime:0,totalTransactions:0})}finally{o(!1)}};r.useEffect(()=>{Fe()},[]),r.useEffect(()=>{let e=[...t];switch(s){case"processing":e=t.filter(e=>{const s=e.latest_status;if(s){const e=s.sender,a=s.receiver,t=s.status?.toLowerCase();return"technicalDirector"===e&&"accounts"===a&&"approved"===t||"accounts"===e&&"pending"===t}const a=e.accounts_status?.toLowerCase(),t=e.technical_director_status?.toLowerCase();return"approved"===t&&(!a||"pending"===a)||"payment_processing"===a});break;case"processed":e=t.filter(e=>{const s=e.latest_status;if(s){const e=s.sender,a=s.status?.toLowerCase();return"accounts"===e&&("approved"===a||"payment_processed"===a||"completed"===a||"transferred"===a||"payment_processing"===a)}const a=e.accounts_status?.toLowerCase();return"payment_processed"===a||"approved"===a||"transferred"===a||"completed"===a})}d&&(e=e.filter(e=>e.purchase_id.toString().includes(d)||e.site_location.toLowerCase().includes(d.toLowerCase())||e.purpose.toLowerCase().includes(d.toLowerCase())||e.project_id?.toString().includes(d))),(R.min||R.max)&&(e=e.filter(e=>{const s=e.total_cost||0,a=R.min?parseFloat(R.min):0,t=R.max?parseFloat(R.max):1/0;return s>=a&&s<=t})),V&&"all"!==V&&(e=e.filter(e=>e.site_location.toLowerCase().includes(V.toLowerCase()))),M&&"all"!==M&&(e=e.filter(e=>e.project_id?.toString().includes(M))),(B.start||B.end)&&(e=e.filter(e=>{const s=new Date(e.created_at||e.date),a=B.start?new Date(B.start):new Date("1900-01-01"),t=B.end?new Date(B.end):new Date;return s>=a&&s<=t})),e.sort((e,s)=>{let a,t;switch(D){case"amount":a=e.total_cost||0,t=s.total_cost||0;break;case"project":a=e.project_id?.toString()||"",t=s.project_id?.toString()||"";break;case"location":a=e.site_location||"",t=s.site_location||"";break;default:a=new Date(e.created_at||e.date).getTime(),t=new Date(s.created_at||s.date).getTime()}return"amount"===D||"date"===D?"desc"===F?t-a:a-t:"desc"===F?t.localeCompare(a):a.localeCompare(t)}),l(e)},[t,s,d,D,F,R,V,M,B]);const Ee=e=>{xe(e),J(!0)},Le=e=>{const s=t.find(s=>s.purchase_id===e);if(s){xe(e);const a=s.payment_transaction?.transaction_id||s.payment_details?.transaction_id||e;he(a),fe("approve"),X(!0)}},Oe=e=>{const s=t.find(s=>s.purchase_id===e);if(s){xe(e);const a=s.payment_transaction?.transaction_id||s.payment_details?.transaction_id||e;he(a),fe("reject"),X(!0)}},$e=e=>{const s=t.find(s=>s.purchase_id===e);s&&(ge(s),xe(e),ee(!0))},ze=e=>{const s=t.find(s=>s.purchase_id===e);s?(ge(s),de(!0)):x.error("Purchase not found")},Re=e=>{xe(e),te(!0)},Ie=async()=>{o(!0),await new Promise(e=>setTimeout(e,1500)),await Fe(),"approve"===je?(a("processed"),x.success("Payment approved and processed successfully")):"reject"===je&&(a("rejected"),x.success("Payment rejected successfully"))},Ve=()=>{A(""),I({min:"",max:""}),q(""),U(""),H({start:"",end:""}),T("date"),E("desc")},qe=()=>d||R.min||R.max||V&&"all"!==V||M&&"all"!==M||B.start||B.end;return e.jsxs("div",{className:"w-full px-4 sm:px-6 lg:px-8 py-6",children:[e.jsx(ye.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"bg-gradient-to-r from-green-100 via-green-50 to-emerald-50 p-6 rounded-xl mb-4 shadow-lg border border-green-200",children:e.jsx("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h1",{className:"text-2xl sm:text-3xl font-bold text-green-800 flex items-center gap-3",children:[e.jsx($,{className:"h-7 w-7 sm:h-8 sm:w-8 text-green-700 drop-shadow-md"}),e.jsx("span",{children:"Accounts Hub"})]}),e.jsx("p",{className:"text-green-700 text-sm sm:text-base opacity-90",children:"Process payments and manage financial transactions"})]})})}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4 mb-6",children:[e.jsxs(y,{className:"hover:shadow-md transition-shadow",children:[e.jsx(N,{className:"pb-2 sm:pb-3 px-3 sm:px-6",children:e.jsxs(v,{className:"text-xs sm:text-sm font-medium text-gray-600 flex items-center gap-1.5 sm:gap-2",children:[e.jsx(Q,{className:"h-3.5 w-3.5 sm:h-4 sm:w-4 text-blue-500 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:"Processing"})]})}),e.jsxs(w,{className:"px-3 sm:px-6",children:[e.jsx("p",{className:"text-xl sm:text-2xl font-bold text-blue-600",children:Ne.processingCount}),e.jsx("p",{className:"text-xs text-gray-500 mt-0.5 sm:mt-1 truncate",children:"Awaiting payment"})]})]}),e.jsxs(y,{className:"hover:shadow-md transition-shadow",children:[e.jsx(N,{className:"pb-2 sm:pb-3 px-3 sm:px-6",children:e.jsxs(v,{className:"text-xs sm:text-sm font-medium text-gray-600 flex items-center gap-1.5 sm:gap-2",children:[e.jsx(re,{className:"h-3.5 w-3.5 sm:h-4 sm:w-4 text-green-500 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:"Processed"})]})}),e.jsxs(w,{className:"px-3 sm:px-6",children:[e.jsx("p",{className:"text-xl sm:text-2xl font-bold text-green-600",children:Ne.processedCount}),e.jsx("p",{className:"text-xs text-gray-500 mt-0.5 sm:mt-1 truncate",children:"Payments complete"})]})]}),e.jsxs(y,{className:"hover:shadow-md transition-shadow",children:[e.jsx(N,{className:"pb-2 sm:pb-3 px-3 sm:px-6",children:e.jsxs(v,{className:"text-xs sm:text-sm font-medium text-gray-600 flex items-center gap-1.5 sm:gap-2",children:[e.jsx(O,{className:"h-3.5 w-3.5 sm:h-4 sm:w-4 text-purple-500 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:"Total Value"})]})}),e.jsxs(w,{className:"px-3 sm:px-6",children:[e.jsx("p",{className:"text-sm sm:text-lg lg:text-xl font-bold text-green-600 truncate",children:(Me=Ne.totalValue,`AED ${Me.toLocaleString()}`)}),e.jsx("p",{className:"text-xs text-gray-500 mt-0.5 sm:mt-1 truncate",children:"Processing value"})]})]}),e.jsxs(y,{className:"hover:shadow-md transition-shadow",children:[e.jsx(N,{className:"pb-2 sm:pb-3 px-3 sm:px-6",children:e.jsxs(v,{className:"text-xs sm:text-sm font-medium text-gray-600 flex items-center gap-1.5 sm:gap-2",children:[e.jsx(ae,{className:"h-3.5 w-3.5 sm:h-4 sm:w-4 text-indigo-500 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:"Transactions"})]})}),e.jsxs(w,{className:"px-3 sm:px-6",children:[e.jsx("p",{className:"text-xl sm:text-2xl font-bold text-indigo-600",children:Ne.totalTransactions}),e.jsx("p",{className:"text-xs text-gray-500 mt-0.5 sm:mt-1 truncate",children:"Total handled"})]})]})]}),e.jsxs("div",{className:"mb-4 sm:mb-6 space-y-3",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs("div",{className:"relative flex-1 lg:max-w-2xl",children:[e.jsx(ce,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-3.5 w-3.5 sm:h-4 sm:w-4"}),e.jsx(f,{placeholder:"Search by ID, location, purpose, or project...",value:d,onChange:e=>A(e.target.value),className:"pl-8 sm:pl-10 h-9 sm:h-10 text-sm sm:text-base bg-white border-gray-200 focus:border-green-500 focus:ring-green-500"})]}),e.jsxs(we,{open:L,onOpenChange:z,children:[e.jsx(be,{asChild:!0,children:e.jsxs(m,{variant:qe()?"default":"outline",className:"flex items-center gap-2 min-w-[100px] "+(qe()?"bg-green-600 hover:bg-green-700 text-white":""),children:[e.jsx(le,{className:"h-4 w-4"}),"Filters",qe()&&e.jsx("span",{className:"bg-white text-green-600 rounded-full px-1.5 py-0.5 text-xs font-medium",children:[d,R.min,R.max,V,M,B.start,B.end].filter(Boolean).length})]})}),e.jsxs(_e,{className:"w-80 p-4 space-y-4",align:"end",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Filters"}),qe()&&e.jsxs(m,{variant:"ghost",size:"sm",onClick:Ve,className:"text-red-600 hover:text-red-700 hover:bg-red-50",children:[e.jsx(G,{className:"h-4 w-4 mr-1"}),"Clear All"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{className:"text-sm font-medium",children:"Amount Range (AED)"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(f,{placeholder:"Min",type:"number",value:R.min,onChange:e=>I({...R,min:e.target.value}),className:"h-8 text-sm"}),e.jsx(f,{placeholder:"Max",type:"number",value:R.max,onChange:e=>I({...R,max:e.target.value}),className:"h-8 text-sm"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{className:"text-sm font-medium",children:"Location"}),e.jsxs(b,{value:V,onValueChange:q,children:[e.jsx(_,{className:"h-8 text-sm",children:e.jsx(C,{placeholder:"Select location"})}),e.jsxs(S,{children:[e.jsx(P,{value:"all",children:"All Locations"}),(()=>{const e=t.map(e=>e.site_location).filter(Boolean);return[...new Set(e)].sort()})().map(s=>e.jsx(P,{value:s,children:s},s))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{className:"text-sm font-medium",children:"Project ID"}),e.jsxs(b,{value:M,onValueChange:U,children:[e.jsx(_,{className:"h-8 text-sm",children:e.jsx(C,{placeholder:"Select project"})}),e.jsxs(S,{children:[e.jsx(P,{value:"all",children:"All Projects"}),(()=>{const e=t.map(e=>e.project_id?.toString()).filter(Boolean);return[...new Set(e)].sort()})().map(s=>e.jsxs(P,{value:s,children:["Project ",s]},s))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{className:"text-sm font-medium",children:"Date Range"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(f,{type:"date",value:B.start,onChange:e=>H({...B,start:e.target.value}),className:"h-8 text-sm",max:B.end||void 0}),e.jsx(f,{type:"date",value:B.end,onChange:e=>H({...B,end:e.target.value}),className:"h-8 text-sm",min:B.start||void 0})]})]})]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(k,{className:"text-sm font-medium whitespace-nowrap",children:"Sort by:"}),e.jsxs(b,{value:D,onValueChange:e=>T(e),children:[e.jsx(_,{className:"w-[140px] h-8 text-sm",children:e.jsx(C,{})}),e.jsxs(S,{children:[e.jsx(P,{value:"date",children:"Date"}),e.jsx(P,{value:"amount",children:"Amount"}),e.jsx(P,{value:"project",children:"Project"}),e.jsx(P,{value:"location",children:"Location"})]})]})]}),e.jsx(m,{variant:"outline",size:"sm",onClick:()=>E("desc"===F?"asc":"desc"),className:"flex items-center gap-2 min-w-[120px] h-8",children:"desc"===F?e.jsxs(e.Fragment,{children:[e.jsx(ie,{className:"h-3.5 w-3.5"}),"Descending"]}):e.jsxs(e.Fragment,{children:[e.jsx(oe,{className:"h-3.5 w-3.5"}),"Ascending"]})})]}),qe()&&e.jsxs("div",{className:"flex flex-wrap items-center gap-2 p-3 bg-gray-50 rounded-lg border",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Active filters:"}),d&&e.jsxs("div",{className:"flex items-center gap-1 bg-green-100 text-green-800 px-2 py-1 rounded-full text-xs",children:[e.jsxs("span",{children:['Search: "',d,'"']}),e.jsx("button",{onClick:()=>A(""),className:"hover:bg-green-200 rounded-full p-0.5","aria-label":"Clear search filter",children:e.jsx(G,{className:"h-3 w-3"})})]}),(R.min||R.max)&&e.jsxs("div",{className:"flex items-center gap-1 bg-blue-100 text-blue-800 px-2 py-1 rounded-full text-xs",children:[e.jsxs("span",{children:["Amount: ",R.min||"0"," - ",R.max||"∞"," AED"]}),e.jsx("button",{onClick:()=>I({min:"",max:""}),className:"hover:bg-blue-200 rounded-full p-0.5","aria-label":"Clear amount filter",children:e.jsx(G,{className:"h-3 w-3"})})]}),V&&"all"!==V&&e.jsxs("div",{className:"flex items-center gap-1 bg-purple-100 text-purple-800 px-2 py-1 rounded-full text-xs",children:[e.jsxs("span",{children:["Location: ",V]}),e.jsx("button",{onClick:()=>q(""),className:"hover:bg-purple-200 rounded-full p-0.5","aria-label":"Clear location filter",children:e.jsx(G,{className:"h-3 w-3"})})]}),M&&"all"!==M&&e.jsxs("div",{className:"flex items-center gap-1 bg-orange-100 text-orange-800 px-2 py-1 rounded-full text-xs",children:[e.jsxs("span",{children:["Project: ",M]}),e.jsx("button",{onClick:()=>U(""),className:"hover:bg-orange-200 rounded-full p-0.5","aria-label":"Clear project filter",children:e.jsx(G,{className:"h-3 w-3"})})]}),(B.start||B.end)&&e.jsxs("div",{className:"flex items-center gap-1 bg-indigo-100 text-indigo-800 px-2 py-1 rounded-full text-xs",children:[e.jsxs("span",{children:["Date: ",B.start||"Start"," to ",B.end||"End"]}),e.jsx("button",{onClick:()=>H({start:"",end:""}),className:"hover:bg-indigo-200 rounded-full p-0.5","aria-label":"Clear date range filter",children:e.jsx(G,{className:"h-3 w-3"})})]}),e.jsx(m,{variant:"ghost",size:"sm",onClick:Ve,className:"text-red-600 hover:text-red-700 hover:bg-red-50 ml-2",children:"Clear All"})]})]}),e.jsxs(h,{value:s,onValueChange:a,className:"space-y-4 sm:space-y-6",children:[e.jsx("div",{className:"overflow-x-auto -mx-4 px-4 sm:mx-0 sm:px-0",children:e.jsxs(u,{className:"grid w-full min-w-[280px] max-w-none lg:max-w-2xl grid-cols-2 bg-gray-100 h-auto",children:[e.jsxs(g,{value:"processing",className:"flex items-center justify-center gap-1 sm:gap-2 data-[state=active]:bg-white data-[state=active]:text-blue-600 text-xs sm:text-sm py-2 sm:py-2.5 whitespace-nowrap",children:[e.jsx(Q,{className:"h-3 w-3 sm:h-4 sm:w-4 flex-shrink-0"}),e.jsx("span",{className:"hidden xs:inline",children:"Processing"}),e.jsxs("span",{className:"text-[10px] xs:text-xs sm:text-sm",children:["(",Ne.processingCount,")"]})]}),e.jsxs(g,{value:"processed",className:"flex items-center justify-center gap-1 sm:gap-2 data-[state=active]:bg-white data-[state=active]:text-green-600 text-xs sm:text-sm py-2 sm:py-2.5 whitespace-nowrap",children:[e.jsx(re,{className:"h-3 w-3 sm:h-4 sm:w-4 flex-shrink-0"}),e.jsx("span",{className:"hidden xs:inline",children:"Processed"}),e.jsxs("span",{className:"text-[10px] xs:text-xs sm:text-sm",children:["(",Ne.processedCount,")"]})]})]})}),["processing","processed"].map(s=>e.jsx(j,{value:s,className:"space-y-4",children:i?e.jsx("div",{className:"flex justify-center items-center py-12",children:e.jsx(p,{variant:"pulse-wave",className:"text-green-600"})}):0===c.length?e.jsx(y,{children:e.jsxs(w,{className:"flex flex-col items-center justify-center py-8 sm:py-12",children:[e.jsx(Y,{className:"h-10 w-10 sm:h-12 sm:w-12 text-gray-400 mb-3 sm:mb-4"}),e.jsx("p",{className:"text-base sm:text-lg font-medium text-gray-900",children:"No purchases found"}),e.jsx("p",{className:"text-xs sm:text-sm text-gray-500 mt-1 text-center px-4",children:d?"Try adjusting your search criteria":`No purchases in ${s} status at this time`})]})}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-3",children:c.map(s=>e.jsx(Se,{purchase:s,onProcessPayment:Ee,onApprovePayment:Le,onRejectPayment:Oe,onViewDetails:$e,onViewTransactionDetails:Re,onSendAcknowledgement:ze,isLoading:i},s.purchase_id))})},s))]}),e.jsx(Pe,{isOpen:W,onClose:()=>J(!1),purchaseId:me,onSuccess:Ie}),e.jsx(ke,{isOpen:K,onClose:()=>X(!1),transactionId:pe,mode:je,onSuccess:Ie}),e.jsx(Ae,{isOpen:Z,onClose:()=>{ee(!1),ge(null)},purchaseId:me}),e.jsx(De,{isOpen:se,onClose:()=>{te(!1)},purchaseId:me}),e.jsx(Te,{isOpen:ne,onClose:()=>{de(!1),ge(null)},purchase:ue,onSuccess:()=>{de(!1),ge(null),Fe()}})]});var Me};export{Fe as default};
