import{j as e}from"./radix-ui-34961435.js";import{r as s}from"./react-vendor-3707ac94.js";import{D as t,a,b as r,c as l}from"./dialog-d443819a.js";import{T as c,a as i,b as d,c as n}from"./tabs-8d248749.js";import{t as o,a as m,M as p,B as x,A as u,c as h}from"./index-12cad093.js";import{C as g,a as j}from"./card-e62b6216.js";import{p as _}from"./projectManagerService-fd1f363b.js";import{a as N}from"./dateFormatter-3b370b4b.js";import{F as b,aj as y,X as f,ah as v,I as w,g as D,b as P,ag as C,M as E,o as S,ak as A,Q as k,al as R,U as $,c as M,am as T,a8 as q,A as L,az as I,w as O,k as z,z as F,v as B,i as U}from"./icons-2fde7931.js";import{m as G}from"./ui-vendor-42d562f2.js";const Z=({isOpen:Z,onClose:V,purchaseId:J,mode:W="details"})=>{const[H,Q]=s.useState(null),[K,X]=s.useState(!1),[Y,ee]=s.useState("history"===W?"history":"details"),[se,te]=s.useState(!1);s.useEffect(()=>{Z&&J?(Q(null),X(!0),ae(),ee("history"===W?"history":"details")):(Q(null),X(!1))},[Z,J,W]);const ae=async()=>{if(J)try{if(X(!0),"history"===W){const{purchase:e}=await _.getPurchaseHistory(J),s=e.approvals?.action||[],t={purchase_id:e.purchase_id,purchase_details:{site_location:e.site_location||"Not specified",purpose:e.purpose||"Not specified",date:e.date,email_sent:e.email_sent||!1,created_at:e.created_at,requested_by:e.requested_by,project_id:e.project_id,file_path:e.file_path||null,materials_summary:{total_materials:e.materials?.length||0,total_quantity:e.materials?.reduce((e,s)=>e+(s.quantity||0),0)||0,total_cost:e.materials?.reduce((e,s)=>e+(s.quantity||0)*(s.cost||0),0)||0,categories:[...new Set(e.materials?.map(e=>e.category).filter(Boolean)||[])],materials:e.materials||[]}},procurement_statuses:s,project_manager_statuses:[],latest_pm_proc_status:e.latest_status||e.approvals?.action?.[e.approvals?.action?.length-1]||{status:e.status||"pending",role:null,date:null,decision_by:null,comments:null,status_id:null,is_active:!1,created_at:null,last_modified_at:null},summary:{total_procurement_statuses:s.filter(e=>"procurement"===e.role).length||0,total_pm_statuses:s.filter(e=>"projectManager"===e.role).length||0,pm_approved_count:s.filter(e=>"projectManager"===e.role&&"approved"===e.status).length||0,pm_rejected_count:s.filter(e=>"projectManager"===e.role&&"rejected"===e.status).length||0,pm_pending_count:0,procurement_approved_count:s.filter(e=>"procurement"===e.role&&"approved"===e.status).length||0,procurement_rejected_count:s.filter(e=>"procurement"===e.role&&"rejected"===e.status).length||0,procurement_pending_count:0}};Q(t)}else{const e=await _.getPurchaseDetails(J),s=e.purchase,t=e.latest_status,a={purchase_id:s.purchase_id,purchase_details:{site_location:s.site_location||"Not specified",purpose:s.purpose||"Not specified",date:s.date,email_sent:s.email_sent||!1,created_at:s.created_at,requested_by:s.requested_by,project_id:s.project_id,file_path:s.file_path||null,materials_summary:{total_materials:s.materials?.length||0,total_quantity:s.materials?.reduce((e,s)=>e+(s.quantity||0),0)||0,total_cost:s.materials?.reduce((e,s)=>e+(s.quantity||0)*(s.cost||0),0)||0,categories:[...new Set(s.materials?.map(e=>e.category).filter(Boolean)||[])],materials:s.materials||[]}},procurement_statuses:[],project_manager_statuses:[],latest_pm_proc_status:t&&Object.keys(t).length>0?{status:t.status||s.status||"pending",sender:t.sender||null,receiver:t.receiver||null,role:t.role||null,date:t.decision_date||t.created_at||null,decision_date:t.decision_date||null,decision_by:t.created_by||t.decision_by||null,created_by:t.created_by||null,comments:t.comments||null,rejection_reason:t.rejection_reason||null,reject_category:t.reject_category||null,status_id:t.status_id||null,is_active:void 0!==t.is_active&&t.is_active,created_at:t.created_at||s.created_at||null,last_modified_at:t.last_modified_at||t.created_at||null,decision_by_user_id:t.decision_by_user_id||null}:{status:s.status||"pending",sender:null,receiver:null,role:null,date:s.created_at||null,decision_date:null,decision_by:s.created_by||null,created_by:s.created_by||null,comments:null,rejection_reason:null,reject_category:null,status_id:null,is_active:!1,created_at:s.created_at||null,last_modified_at:s.last_modified_at||s.created_at||null,decision_by_user_id:null},summary:{total_procurement_statuses:0,total_pm_statuses:0,pm_approved_count:0,pm_rejected_count:0,pm_pending_count:0,procurement_approved_count:0,procurement_rejected_count:0,procurement_pending_count:0}};Q(a)}}catch(e){e.message?.includes("not found")?o.error(`Purchase request PR-${J} not found`,{description:"This purchase may have been deleted or the ID is incorrect."}):o.error(e.message||"Failed to fetch purchase details"),404===e.response?.status&&setTimeout(()=>{V()},2e3)}finally{X(!1)}},re=e=>{switch(e?.toLowerCase()){case"approved":case"complete":case"completed":return"bg-green-100 text-green-800 border-green-200";case"rejected":return"bg-red-100 text-red-800 border-red-200";case"pending":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"under_review":case"in_progress":return"bg-blue-100 text-blue-800 border-blue-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},le=s=>{switch(s?.toLowerCase()){case"approved":case"complete":case"completed":return e.jsx(U,{className:"w-4 h-4 text-green-600"});case"rejected":return e.jsx(B,{className:"w-4 h-4 text-red-600"});case"pending":return e.jsx(z,{className:"w-4 h-4 text-yellow-600"});case"under_review":case"in_progress":return e.jsx(F,{className:"w-4 h-4 text-blue-600"});default:return e.jsx(z,{className:"w-4 h-4 text-gray-600"})}},ce=e=>e?N(e):"N/A",ie=e=>`AED ${e.toLocaleString()}`,de=e=>({approved:"APPROVED",complete:"COMPLETED",completed:"COMPLETED",rejected:"REJECTED",pending:"PENDING",under_review:"UNDER REVIEW",in_progress:"IN PROGRESS"}[e?.toLowerCase()]||e?.toUpperCase()||"PENDING"),ne=H?(()=>{const e=H?.latest_pm_proc_status;if(!e)return{status:"pending",text:"PENDING",description:"Awaiting initial review"};const s=e.status?.toLowerCase(),t=e.sender,a=e.receiver,r=e.comments?.toLowerCase(),l=e=>{if(!e)return"";return{procurement:"Procurement",projectManager:"Project Manager",projectmanager:"Project Manager",estimation:"Estimation",technicalDirector:"Technical Director",technicaldirector:"Technical Director",accounts:"Accounts",siteSupervisor:"Site Supervisor",sitesupervisor:"Site Supervisor",mepSupervisor:"MEP Supervisor",mepsupervisor:"MEP Supervisor",design:"Design"}[e.toLowerCase()]||e.replace(/([A-Z])/g," $1").trim()};if("completed"===s||"complete"===s){let e="Purchase request has been fully processed and completed";return r?.includes("acknowledgement")&&(e="Purchase order acknowledged and completed by Accounts"),{status:"completed",text:"COMPLETED",description:e}}if("approved"===s){if("accounts"===t&&r?.includes("acknowledgement"))return{status:"completed",text:"COMPLETED",description:"Purchase order acknowledged and completed by Accounts"};const e=t?l(t):"";return{status:"approved",text:"APPROVED",description:e?`Approved by ${e}`:"Approved"}}if(a){const e=l(a);if("rejected"===s&&t){return{status:"rejected",text:"REJECTED",description:`Rejected by ${l(t)}, returned to ${e}`}}return{status:"pending",text:"PENDING",description:`Currently pending review at ${e}`}}if("rejected"===s&&t){return{status:"rejected",text:"REJECTED",description:`Rejected by ${l(t)}`}}return{status:s||"pending",text:de(s||"pending"),description:"Processing in workflow"}})():{status:"pending",text:"PENDING",description:"Loading..."},oe=e=>{switch(e?.toLowerCase()){case"high":case"urgent":return"bg-red-100 text-red-800";case"medium":return"bg-yellow-100 text-yellow-800";case"low":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}};return e.jsx(t,{open:Z,onOpenChange:V,children:e.jsxs(a,{className:"max-w-4xl h-[85vh] w-[90vw] sm:w-full flex flex-col p-0 bg-gray-50 m-auto",children:[e.jsx(r,{className:"px-6 py-4 bg-gradient-to-r from-[#243d8a] to-[#1e3470] flex-shrink-0 shadow-lg",children:e.jsx(l,{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-white/10 rounded-lg backdrop-blur",children:e.jsx(b,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-white text-lg font-semibold",children:"Purchase Request Details"}),H&&e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsxs(m,{className:"bg-white/20 text-white border-white/30 hover:bg-white/30",children:[e.jsx(y,{className:"w-3 h-3 mr-1"}),"PR-",H.purchase_id]}),e.jsxs(m,{className:`${re(ne.status)} border`,children:[le(ne.status),e.jsx("span",{className:"ml-1",children:ne.text})]})]})]})]})})}),e.jsx("button",{onClick:V,className:"absolute top-2 right-2 z-50 p-1 bg-white/20 hover:bg-white/30 rounded-full backdrop-blur transition-all duration-200 group","aria-label":"Close modal",children:e.jsx(f,{className:"w-3.5 h-3.5 text-white group-hover:text-white/80"})}),K?e.jsx("div",{className:"flex items-center justify-center flex-1 bg-white",children:e.jsxs("div",{className:"text-center",children:[e.jsx(p,{variant:"pulse-wave",size:"lg"}),e.jsx("p",{className:"text-sm text-gray-600 mt-2",children:"Loading purchase details..."})]})}):H?e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsxs(c,{value:Y,onValueChange:ee,className:"h-full",children:[e.jsx("div",{className:"bg-white border-b px-6 pt-4",children:e.jsx(i,{className:`grid w-full ${"history"===W?"grid-cols-1":"grid-cols-3"} max-w-2xl mx-auto bg-gray-100`,children:"history"===W?e.jsxs(d,{value:"history",className:"data-[state=active]:bg-white data-[state=active]:shadow-sm",children:[e.jsx(v,{className:"w-4 h-4 mr-2"}),"History"]}):e.jsxs(e.Fragment,{children:[e.jsxs(d,{value:"details",className:"data-[state=active]:bg-white data-[state=active]:shadow-sm",children:[e.jsx(w,{className:"w-4 h-4 mr-2"}),"Details"]}),e.jsxs(d,{value:"materials",className:"data-[state=active]:bg-white data-[state=active]:shadow-sm",children:[e.jsx(D,{className:"w-4 h-4 mr-2"}),"Materials"]}),e.jsxs(d,{value:"status",className:"data-[state=active]:bg-white data-[state=active]:shadow-sm",children:[e.jsx(P,{className:"w-4 h-4 mr-2"}),"Latest Status"]})]})})}),"history"!==W&&e.jsx(n,{value:"details",className:"mt-0 bg-white",children:e.jsx("div",{className:"p-6",children:e.jsxs(G.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsx(g,{className:"border-0 shadow-sm bg-gradient-to-br from-blue-50 to-blue-100",children:e.jsx(j,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-blue-600 font-medium",children:"Total Amount"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-900 mt-1",children:["AED ",(H.purchase_details?.materials_summary?.total_cost||0).toLocaleString()]})]}),e.jsx("div",{className:"p-3 bg-blue-200/30 rounded-lg",children:e.jsx(C,{className:"w-6 h-6 text-blue-700"})})]})})}),e.jsx(g,{className:"border-0 shadow-sm bg-gradient-to-br from-purple-50 to-purple-100",children:e.jsx(j,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-purple-600 font-medium",children:"Materials"}),e.jsxs("p",{className:"text-2xl font-bold text-purple-900 mt-1",children:[H.purchase_details?.materials_summary?.total_materials||0," Items"]})]}),e.jsx("div",{className:"p-3 bg-purple-200/30 rounded-lg",children:e.jsx(D,{className:"w-6 h-6 text-purple-700"})})]})})}),e.jsx(g,{className:"border-0 shadow-sm bg-gradient-to-br from-green-50 to-green-100",children:e.jsx(j,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-green-600 font-medium",children:"Email Status"}),e.jsx("p",{className:"text-lg font-bold text-green-900 mt-1",children:H.purchase_details?.email_sent?"Sent ✓":"Pending"})]}),e.jsx("div",{className:"p-3 bg-green-200/30 rounded-lg",children:e.jsx(E,{className:"w-6 h-6 text-green-700"})})]})})})]}),e.jsx(g,{className:"border-0 shadow-sm",children:e.jsxs(j,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(w,{className:"w-5 h-5 text-blue-600"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Basic Information"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors",children:[e.jsx(S,{className:"w-5 h-5 text-gray-500 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-xs text-gray-500 font-medium uppercase tracking-wider",children:"Project ID"}),e.jsx("p",{className:"text-sm font-semibold text-gray-900 mt-0.5",children:H.purchase_details?.project_id||"N/A"})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors",children:[e.jsx(A,{className:"w-5 h-5 text-gray-500 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-xs text-gray-500 font-medium uppercase tracking-wider",children:"Requested By"}),e.jsx("p",{className:"text-sm font-semibold text-gray-900 mt-0.5",children:H.purchase_details?.requested_by||"N/A"})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors",children:[e.jsx(k,{className:"w-5 h-5 text-gray-500 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-xs text-gray-500 font-medium uppercase tracking-wider",children:"Site Location"}),e.jsx("p",{className:"text-sm font-semibold text-gray-900 mt-0.5",children:H.purchase_details?.site_location||"N/A"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors",children:[e.jsx(R,{className:"w-5 h-5 text-gray-500 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-xs text-gray-500 font-medium uppercase tracking-wider",children:"Request Date"}),e.jsx("p",{className:"text-sm font-semibold text-gray-900 mt-0.5",children:ce(H.purchase_details?.created_at||H.purchase_details?.date||null)})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors",children:[e.jsx($,{className:"w-5 h-5 text-gray-500 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-xs text-gray-500 font-medium uppercase tracking-wider",children:"Created By"}),e.jsx("p",{className:"text-sm font-semibold text-gray-900 mt-0.5",children:H.purchase_details?.requested_by||"System"})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors",children:[e.jsx(E,{className:"w-5 h-5 text-gray-500 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-xs text-gray-500 font-medium uppercase tracking-wider",children:"Email Status"}),e.jsx(m,{variant:H.purchase_details?.email_sent?"default":"outline",className:"mt-1",children:H.purchase_details?.email_sent?"Sent ✓":"Not Sent"})]})]})]})]})]})}),e.jsx(g,{className:"border-0 shadow-sm",children:e.jsxs(j,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("div",{className:"p-2 bg-amber-100 rounded-lg",children:e.jsx(M,{className:"w-5 h-5 text-amber-600"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Purpose"})]}),e.jsx("div",{className:"bg-gradient-to-r from-amber-50 to-orange-50 p-4 rounded-lg border border-amber-200",children:e.jsx("p",{className:"text-sm text-gray-800 leading-relaxed",children:H.purchase_details?.purpose||"No purpose specified"})})]})}),H.purchase_details?.file_path&&e.jsx(g,{className:"border-0 shadow-sm",children:e.jsxs(j,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("div",{className:"p-2 bg-red-100 rounded-lg",children:e.jsx(T,{className:"w-5 h-5 text-red-600"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Attachment"})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-red-100 rounded-lg",children:e.jsx(b,{className:"w-5 h-5 text-red-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:H.purchase_details.file_path.split("/").pop()||"Purchase Document"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Click to download the attached document"})]})]}),e.jsx(x,{onClick:async()=>{if(H?.purchase_id){te(!0);try{o.info("Fetching attachment...");const e=await fetch(`${u}${h.DOWNLOAD_FILES("projectManager",H.purchase_id)}`,{headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`}}),s=await e.json();if(s.success&&s.purchase_files&&s.purchase_files.length>0){const e=s.purchase_files[0],t=e.public_url||`${u}/download_file/${e.file_path}`,a=document.createElement("a");a.href=t,a.download=e.file_path?.split("/").pop()||"attachment",a.style.display="none",document.body.appendChild(a),a.click(),document.body.removeChild(a),o.success("Downloading attachment...")}else s.accounts_files&&s.accounts_files.length>0?o.info("This purchase has accounts-related files. Please check with the Accounts department."):o.warning("No attachments found for this purchase.")}catch(e){if(H.purchase_details?.file_path){try{const e=await fetch(`${u}/api/get_file_url/${H.purchase_id}`,{headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`}});if(e.ok){const s=await e.json();if(s.public_url){const e=document.createElement("a");return e.href=s.public_url,e.download=H.purchase_details.file_path?.split("/").pop()||"attachment",e.style.display="none",document.body.appendChild(e),e.click(),document.body.removeChild(e),void o.info("Downloading attachment...")}}}catch(s){}const e=`${u}/uploads/${H.purchase_details.file_path}`,t=H.purchase_details.file_path.split("/").pop()||"attachment",a=document.createElement("a");a.href=e,a.download=t,a.style.display="none",document.body.appendChild(a),a.click(),document.body.removeChild(a),o.info("Downloading attachment...")}else o.error("Failed to download attachment. Please try again later.")}finally{te(!1)}}},variant:"outline",size:"sm",disabled:se,className:"border-red-200 text-red-600 hover:bg-red-50 hover:border-red-300 disabled:opacity-50 disabled:cursor-not-allowed",children:se?e.jsxs(e.Fragment,{children:[e.jsx(p,{variant:"pulse-wave",size:"sm"}),"Downloading..."]}):e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"w-4 h-4 mr-2"}),"Download"]})})]})]})})]})})}),"history"!==W&&e.jsx(n,{value:"status",className:"mt-0 bg-white",children:e.jsx("div",{className:"p-6",children:e.jsx(G.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"space-y-6",children:e.jsx(g,{className:"border-0 shadow-sm",children:e.jsxs(j,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(P,{className:"w-5 h-5 text-blue-600"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Current Status Information"})]}),H.latest_pm_proc_status&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"p-4 bg-gradient-to-r from-gray-50 to-gray-100 rounded-xl",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wider font-medium",children:"Current Status"}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsxs(m,{className:`${re(ne.status)} border text-sm py-1 px-3`,children:[le(ne.status),e.jsx("span",{className:"ml-1",children:ne.text})]}),H.latest_pm_proc_status.is_active&&e.jsxs(m,{className:"bg-green-100 text-green-700 border-green-200",children:[e.jsx(P,{className:"w-3 h-3 mr-1"}),"Active"]})]}),e.jsx("p",{className:"text-sm text-gray-600 mt-2 italic",children:ne.description})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Status ID"}),e.jsxs("p",{className:"font-mono text-sm font-semibold text-gray-700",children:["#",H.latest_pm_proc_status.status_id]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(g,{className:"border-0 bg-blue-50",children:e.jsxs(j,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(A,{className:"w-4 h-4 text-blue-600"}),e.jsx("h4",{className:"font-medium text-blue-900",children:"Decision Information"})]}),e.jsxs("div",{className:"space-y-2",children:[H.latest_pm_proc_status.role&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-blue-600",children:"Current Role"}),e.jsx("p",{className:"font-semibold text-blue-900 capitalize",children:"accounts"===H.latest_pm_proc_status.role?"Accounts":"procurement"===H.latest_pm_proc_status.role?"Procurement":"projectManager"===H.latest_pm_proc_status.role?"Project Manager":"technicalDirector"===H.latest_pm_proc_status.role?"Technical Director":"estimation"===H.latest_pm_proc_status.role?"Estimation":"siteSupervisor"===H.latest_pm_proc_status.role?"Site Supervisor":H.latest_pm_proc_status.role?.replace(/([A-Z])/g," $1").trim().replace("_"," ")})]}),(H.latest_pm_proc_status.decision_by||H.latest_pm_proc_status.created_by)&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-blue-600",children:"Decision By"}),e.jsx("p",{className:"font-semibold text-blue-900",children:"string"==typeof H.latest_pm_proc_status.decision_by?H.latest_pm_proc_status.decision_by:H.latest_pm_proc_status.decision_by?.full_name||H.latest_pm_proc_status.created_by})]}),(H.latest_pm_proc_status.date||H.latest_pm_proc_status.decision_date||H.latest_pm_proc_status.created_at)&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-blue-600",children:"Decision Date"}),e.jsx("p",{className:"font-semibold text-blue-900",children:ce(H.latest_pm_proc_status.date||H.latest_pm_proc_status.decision_date||H.latest_pm_proc_status.created_at||null)})]})]})]})}),e.jsx(g,{className:"border-0 bg-purple-50",children:e.jsxs(j,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(L,{className:"w-4 h-4 text-purple-600"}),e.jsx("h4",{className:"font-medium text-purple-900",children:"Workflow Path"})]}),e.jsxs("div",{className:"space-y-2",children:[H.latest_pm_proc_status.sender&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-purple-600",children:"From (Sender)"}),e.jsx("p",{className:"font-semibold text-purple-900 capitalize",children:H.latest_pm_proc_status.sender?.replace(/([A-Z])/g," $1").trim().replace("_"," ")})]}),H.latest_pm_proc_status.receiver&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-purple-600",children:"To (Receiver)"}),e.jsx("p",{className:"font-semibold text-purple-900 capitalize",children:H.latest_pm_proc_status.receiver?.replace(/([A-Z])/g," $1").trim().replace("_"," ")})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-purple-600",children:"Purchase ID"}),e.jsxs("p",{className:"font-semibold text-purple-900",children:["PR-",H.purchase_id]})]})]})]})})]}),H.latest_pm_proc_status.comments&&e.jsx(g,{className:"border-0 bg-amber-50",children:e.jsxs(j,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(I,{className:"w-4 h-4 text-amber-600"}),e.jsx("h4",{className:"font-medium text-amber-900",children:"Comments"})]}),e.jsxs("p",{className:"text-sm text-amber-800 italic",children:['"',H.latest_pm_proc_status.comments,'"']})]})}),H.latest_pm_proc_status.rejection_reason&&e.jsx(g,{className:"border-0 bg-red-50",children:e.jsxs(j,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(O,{className:"w-4 h-4 text-red-600"}),e.jsx("h4",{className:"font-medium text-red-900",children:"Rejection Reason"})]}),e.jsx("p",{className:"text-sm text-red-800",children:H.latest_pm_proc_status.rejection_reason})]})}),e.jsx(g,{className:"border-0 shadow-sm",children:e.jsxs(j,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(z,{className:"w-4 h-4 text-gray-600"}),e.jsx("h4",{className:"font-medium text-gray-900",children:"Timeline"})]}),e.jsxs("div",{className:"space-y-2 border-l-2 border-gray-200 pl-4 ml-2",children:[H.purchase_details?.created_at&&e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute -left-6 w-3 h-3 bg-gray-400 rounded-full"}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Created At"}),e.jsx("span",{className:"text-sm font-medium",children:ce(H.purchase_details.created_at)})]})]}),H.latest_pm_proc_status?.last_modified_at&&e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute -left-6 w-3 h-3 bg-blue-600 rounded-full"}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Last Modified"}),e.jsx("span",{className:"text-sm font-medium",children:ce(H.latest_pm_proc_status.last_modified_at)})]})]})]})]})})]})]})})})})}),"history"!==W&&e.jsx(n,{value:"materials",className:"mt-0",children:e.jsx("div",{className:"p-6",children:H.purchase_details?.materials_summary?.materials&&H.purchase_details?.materials_summary?.materials.length>0?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"grid gap-3",children:H.purchase_details?.materials_summary?.materials?.map((s,t)=>e.jsxs("div",{className:"bg-white border rounded-lg p-4 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-gray-900 text-lg",children:s.description||`Material ${t+1}`}),s.specification&&e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:s.specification})]}),e.jsxs("div",{className:"flex gap-2 ml-4",children:[s.category&&e.jsx(m,{variant:"outline",className:"bg-blue-50",children:s.category}),s.priority&&e.jsx(m,{className:oe(s.priority),children:s.priority.toUpperCase()})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 pt-3 border-t",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Quantity"}),e.jsxs("p",{className:"font-semibold text-gray-900 mt-1",children:[s.quantity||0," ",s.unit||"units"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Unit Cost"}),e.jsx("p",{className:"font-semibold text-gray-900 mt-1",children:ie(s.cost||0)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Total Cost"}),e.jsx("p",{className:"font-semibold text-green-600 mt-1",children:ie((s.quantity||0)*(s.cost||0))})]}),s.design_reference&&e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Design Ref"}),e.jsx("p",{className:"font-medium text-gray-900 mt-1",children:s.design_reference})]})]})]},s.material_id||t))}),e.jsx("div",{className:"bg-gradient-to-r from-green-50 to-green-100 border border-green-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-green-700",children:"Total Purchase Amount"}),e.jsx("p",{className:"text-3xl font-bold text-green-900",children:ie(H.purchase_details?.materials_summary?.total_cost||0)})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-sm text-green-700",children:[H.purchase_details?.materials_summary?.total_materials||0," Materials"]}),e.jsxs("p",{className:"text-sm text-green-700",children:[H.purchase_details?.materials_summary?.total_quantity||0," Total Units"]})]})]})})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(D,{className:"w-16 h-16 mx-auto mb-4 text-gray-300"}),e.jsx("p",{className:"text-gray-500 font-medium",children:"No materials found"}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Materials will appear here once added"})]})})}),"history"===W&&e.jsx(n,{value:"history",className:"mt-0",children:e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"bg-gray-50 rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"grid grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(D,{className:"w-5 h-5 text-blue-600"}),e.jsx("h3",{className:"font-semibold text-gray-900",children:"Purchase Details"})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("span",{className:"text-gray-500",children:"Purpose:"}),e.jsx("span",{className:"text-gray-900",children:H?.purchase_details?.purpose||"N/A"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("span",{className:"text-gray-500",children:"Location:"}),e.jsx("span",{className:"text-gray-900",children:H?.purchase_details?.site_location||"N/A"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("span",{className:"text-gray-500",children:"Project:"}),e.jsxs("span",{className:"text-gray-900",children:["#",H?.purchase_details?.project_id||"N/A"]})]})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx($,{className:"w-5 h-5 text-green-600"}),e.jsx("h3",{className:"font-semibold text-gray-900",children:"Request Info"})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("span",{className:"text-gray-500",children:"Requested by:"}),e.jsx("span",{className:"text-gray-900",children:H?.purchase_details?.requested_by||"N/A"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("span",{className:"text-gray-500",children:"Date:"}),e.jsx("span",{className:"text-gray-900",children:H?.purchase_details?.date?N(H.purchase_details.date):"N/A"})]})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(P,{className:"w-5 h-5 text-purple-600"}),e.jsx("h3",{className:"font-semibold text-gray-900",children:"Timeline Stats"})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("span",{className:"text-gray-500",children:"Total Steps:"}),e.jsx("span",{className:"text-gray-900",children:H?.procurement_statuses?.length||0})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("span",{className:"text-gray-500",children:"Approvals:"}),e.jsx("span",{className:"text-green-600 font-medium",children:(H?.procurement_statuses||[]).filter(e=>"approved"===e.status||"completed"===e.status).length})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("span",{className:"text-gray-500",children:"Rejections:"}),e.jsx("span",{className:"text-red-600 font-medium",children:(H?.procurement_statuses||[]).filter(e=>"rejected"===e.status).length})]})]})]})]})}),(H.procurement_statuses?.length||0)>0?e.jsx("div",{className:"space-y-4",children:(H.procurement_statuses||[]).sort((e,s)=>new Date(e.timestamp||e.date).getTime()-new Date(s.timestamp||s.date).getTime()).map((s,t)=>{const a=t===(H.procurement_statuses||[]).length-1;return e.jsxs("div",{className:"relative",children:[!a&&e.jsx("div",{className:"absolute left-5 top-10 bottom-0 w-0.5 bg-gray-200"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center "+("approved"===s.status||"complete"===s.status||"completed"===s.status?"bg-green-100":"rejected"===s.status?"bg-red-100":"bg-yellow-100"),children:le(s.status)})}),e.jsxs("div",{className:"flex-1 bg-white border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900",children:(r=s.role,{projectManager:"Project Manager",procurement:"Procurement",estimation:"Estimation",technicalDirector:"Technical Director",accounts:"Accounts",siteSupervisor:"Site Supervisor",design:"Design"}[r]||r.replace(/([A-Z])/g," $1").replace(/_/g," ").trim().split(" ").map(e=>e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()).join(" "))}),(s.decided_by||s.decision_by)&&e.jsx("p",{className:"text-sm text-gray-500",children:s.decided_by||("object"==typeof s.decision_by?s.decision_by.full_name:s.decision_by)})]}),e.jsx(m,{className:`${re(s.status)} border`,children:de(s.status)})]}),s.comments&&e.jsxs("div",{className:"bg-blue-50 border-l-4 border-blue-400 p-3 rounded mt-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium text-blue-900 mb-1",children:[e.jsx(I,{className:"h-4 w-4"}),"Comments"]}),e.jsx("p",{className:"text-sm text-blue-800 pl-6",children:s.comments})]}),s.rejection_reason&&e.jsxs("div",{className:"bg-red-50 border-l-4 border-red-400 p-3 rounded mt-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium text-red-900 mb-1",children:[e.jsx(O,{className:"h-4 w-4"}),"Rejection Reason"]}),e.jsx("p",{className:"text-sm text-red-800 pl-6",children:s.rejection_reason})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:ce(s.timestamp||s.date)})]})]})]},t);var r})}):e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(v,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{children:"No approval history available"}),e.jsx("p",{className:"text-sm mt-1",children:"Approval history will appear here once processing begins"})]})]})})]})}):e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(F,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{children:"No purchase data available"})]})]})})};export{Z as P};
