import{j as e}from"./radix-ui-34961435.js";import{u as s,r as t}from"./react-vendor-3707ac94.js";import{S as a}from"./SimpleHorizontalCards-d0b7ddee.js";import{C as r,a as l,b as i,c as n}from"./card-e62b6216.js";import{M as c,B as d,a as o,b as m,c as x}from"./index-12cad093.js";import{P as h}from"./progress-c4fdb9d3.js";import{w as u,R as p,g,T as j,as as y,aX as f,n as b,l as N,H as v,G as w,A as _,Q as k,h as S,aD as C,k as T,aY as z,p as B}from"./icons-2fde7931.js";import{m as P}from"./ui-vendor-42d562f2.js";import{R as W,l as D,C as E,X as R,Y as $,T as q,d as F,f as A,a as M,P as L,b as O,c as H,A as K}from"./charts-4816d993.js";import"./auth-f9290e45.js";import"./utils-8e4480a0.js";import"./forms-337f692b.js";const U=()=>{const U=s(),[G,V]=t.useState("week");t.useState("all");const[I,X]=t.useState(!1),[Y,Q]=t.useState(null),[J,Z]=t.useState(null);t.useEffect(()=>{(async()=>{X(!0),Z(null);try{const e=await m.get(x.DASHBOARDS.SITE_SUPERVISOR);e.data.success&&e.data.dashboard_data?Q(e.data.dashboard_data):Q(e.data)}catch(e){Z(e.response?.data?.error||"Failed to load dashboard data")}finally{X(!1)}})()},[]);const ee=()=>{switch(G){case"day":return"Today";case"week":default:return"This Week";case"month":return"This Month"}},se=(()=>{if(Y?.recent_purchase_requests&&Y.recent_purchase_requests.length>0){return Y.recent_purchase_requests.slice(0,6).map((e,s)=>({week:`W${s+1}`,planned:20+15*s,actual:"approved"===e.status?20+15*s+2:20+15*s-2,materials:e.materials_summary?.total_materials||20+15*s}))}return[{week:"W1",planned:20,actual:18,materials:22},{week:"W2",planned:35,actual:32,materials:38},{week:"W3",planned:50,actual:48,materials:52},{week:"W4",planned:65,actual:67,materials:70},{week:"W5",planned:80,actual:82,materials:85},{week:"W6",planned:95,actual:92,materials:98}]})(),te=(()=>{if(Y?.purchase_analytics?.material_details?.category_breakdown){const e=Y.purchase_analytics.material_details.category_breakdown,s=Object.keys(e).slice(0,4);return["Mon","Tue","Wed","Thu","Fri","Sat"].map((t,a)=>{const r={day:t};return s.forEach(s=>{const t=e[s]?.cost||0;r[s.toLowerCase().replace(/\s+/g,"_")]=Math.round(t*(.8+.4*Math.random())/6)}),r})}return[{day:"Mon",cement:120,steel:80,timber:45,aggregate:200},{day:"Tue",cement:150,steel:95,timber:60,aggregate:180},{day:"Wed",cement:180,steel:110,timber:40,aggregate:220},{day:"Thu",cement:140,steel:85,timber:55,aggregate:190},{day:"Fri",cement:160,steel:100,timber:50,aggregate:210},{day:"Sat",cement:100,steel:60,timber:30,aggregate:150}]})(),ae=(()=>{if(Y?.purchase_analytics?.material_details?.category_breakdown){const e=Y.purchase_analytics.material_details.category_breakdown,s=["#EF4444","#3B82F6","#10B981","#F59E0B","#8B5CF6","#EC4899","#06B6D4","#84CC16"];return Object.entries(e).slice(0,6).map(([e,t],a)=>({name:e||"Uncategorized",value:t.count||0,color:s[a%s.length]}))}return[]})(),re=Y?.safety_metrics||[{category:"PPE Compliance",score:95,target:100,color:"#10B981"},{category:"Site Hazards",score:88,target:90,color:"#3B82F6"},{category:"Tool Safety",score:92,target:95,color:"#F59E0B"},{category:"Training",score:85,target:90,color:"#8B5CF6"}],le=(()=>{if(Y?.purchase_analytics){const e=Y.purchase_analytics,s=Y.recent_purchase_requests||[];return s.filter(e=>"pending"===e.status).length,s.filter(e=>"approved"===e.status).length,[{title:"Total Purchases",value:e.total_purchases||0,change:0,trend:"stable",icon:g,color:"text-red-600",subtitle:`${s.length} recent`},{title:"Total Materials",value:e.material_details?.total_materials||0,change:0,trend:"stable",icon:z,color:"text-blue-600",subtitle:`${e.material_details?.total_quantity||0} units`},{title:"Total Cost",value:`AED ${(e.material_details?.total_cost||0).toLocaleString()}`,change:0,trend:"stable",icon:j,color:"text-green-600",subtitle:"All purchases"},{title:"Email Status",value:e.procurement_email_send||0,change:(e.procurement_email_send/(e.total_purchases||1)*100).toFixed(1),trend:"up",icon:B,color:"text-purple-600",subtitle:`${e.procurement_unemail_send||0} pending`}]}return[{title:"Total Purchases",value:0,change:0,trend:"stable",icon:g,color:"text-red-600",subtitle:"No data"},{title:"Total Materials",value:0,change:0,trend:"stable",icon:z,color:"text-blue-600",subtitle:"No data"},{title:"Total Cost",value:"AED 0",change:0,trend:"stable",icon:j,color:"text-green-600",subtitle:"No data"},{title:"Email Status",value:0,change:0,trend:"stable",icon:B,color:"text-purple-600",subtitle:"No data"}]})(),ie=Y?.recent_purchase_requests&&Y.recent_purchase_requests.length>0?Y.recent_purchase_requests.slice(0,3).map(e=>({id:e.purchase_id,name:e.purpose||`Request #${e.purchase_id}`,location:e.site_location||"Not specified",status:"approved"===e.status?"active":"rejected"===e.status?"paused":"under_review"===e.status?"active":"planning",progress:"approved"===e.status?100:"rejected"===e.status?0:"under_review"===e.status?60:30,workers:e.materials_summary?.total_materials||0,safety:e.materials_summary?.total_quantity||0,phase:e.status||"pending",supervisor:e.status_by_role||"Site Supervisor"})):[],ne=(()=>{if(Y?.purchase_analytics?.material_details?.category_breakdown){return Object.entries(Y.purchase_analytics.material_details.category_breakdown).slice(0,5).map(([e,s],t)=>({id:String(t+1),material:e||"Uncategorized",quantity:`${s.quantity} ${Y.purchase_analytics?.material_details?.units?.[0]||"units"}`,time:(new Date).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}),status:s.count>10?"delivered":s.count>5?"in-transit":"pending",supplier:"Various suppliers",priority:s.cost>1e4?"high":s.cost>5e3?"medium":"low"}))}return[]})(),ce=e=>{switch(e){case"active":return"bg-green-100 text-green-800";case"completed":return"bg-blue-100 text-blue-800";case"paused":return"bg-yellow-100 text-yellow-800";case"planning":return"bg-purple-100 text-purple-800";default:return"bg-gray-100 text-gray-600"}},de=e=>{switch(e){case"delivered":return"bg-green-100 text-green-800";case"in-transit":return"bg-blue-100 text-blue-800";case"pending":return"bg-yellow-100 text-yellow-800";case"delayed":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-600"}};return I?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx(c,{variant:"pulse-wave",size:"lg"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Loading dashboard..."})]})}):J?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(r,{className:"max-w-md w-full",children:e.jsxs(l,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 text-red-600 mb-2",children:[e.jsx(u,{className:"w-5 h-5"}),e.jsx("h3",{className:"font-semibold",children:"Error Loading Dashboard"})]}),e.jsx("p",{className:"text-sm text-gray-600",children:J}),e.jsxs(d,{onClick:()=>window.location.reload(),className:"mt-4 w-full",variant:"outline",children:[e.jsx(p,{className:"w-4 h-4 mr-2"}),"Retry"]})]})})}):e.jsxs("div",{className:"p-2 sm:p-3 md:p-4 space-y-3 md:space-y-4 bg-gray-50 min-h-screen w-full overflow-x-hidden [&_*:focus]:outline-none [&_*:focus]:ring-0",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h1",{className:"text-lg sm:text-xl font-bold text-gray-900 truncate",children:"Site Operations Dashboard"}),e.jsx("p",{className:"text-xs text-gray-600 mt-0.5",children:"Real-time monitoring of construction sites and operations"})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 justify-start lg:justify-end",children:[e.jsxs(d,{onClick:e=>{e.preventDefault(),U("../procurement",{replace:!1})},className:"h-8 px-4 flex items-center gap-2 text-sm font-medium bg-red-600 hover:bg-red-700 text-white rounded-md transition-all duration-200 shadow-sm hover:shadow-md",children:[e.jsx(g,{className:"w-4 h-4"}),e.jsx("span",{children:"Procurement Hub"})]}),e.jsxs("select",{"aria-label":"Select Period",value:G,onChange:e=>V(e.target.value),className:"h-8 px-3 mr-12 text-sm border border-gray-300 rounded-md bg-white hover:border-gray-400 focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-transparent cursor-pointer transition-colors",children:[e.jsx("option",{value:"day",children:"Today"}),e.jsx("option",{value:"week",children:"This Week"}),e.jsx("option",{value:"month",children:"This Month"})]})]})]}),e.jsx(a,{cards:le.map((s,t)=>({id:`metric-${t}`,title:s.title,value:s.value,subtitle:s.subtitle,icon:e.jsx(s.icon,{className:`w-4 h-4 ${s.color}`}),bgColor:"bg-red-100",trend:0!==s.change?{value:Math.abs(s.change),isUp:"up"===s.trend}:void 0}))}),e.jsx("div",{className:"hidden grid grid-cols-2 lg:grid-cols-4 gap-3",children:le.map((s,t)=>e.jsx(P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.05*t},children:e.jsx(r,{className:"hover:shadow-md transition-all duration-200 border-l-4 border-l-red-500",children:e.jsx(l,{className:"p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-xs font-medium text-gray-600",children:s.title}),e.jsx("p",{className:"text-lg font-bold text-gray-900 mt-1",children:s.value}),e.jsxs("div",{className:"flex items-center mt-1",children:["up"===s.trend?e.jsx(j,{className:"w-3 h-3 text-green-500 mr-1"}):"down"===s.trend?e.jsx(y,{className:"w-3 h-3 text-red-500 mr-1"}):e.jsx(f,{className:"w-3 h-3 text-gray-500 mr-1"}),e.jsx("span",{className:"text-xs font-medium "+("up"===s.trend?"text-green-600":"down"===s.trend?"text-red-600":"text-gray-600"),children:"stable"===s.trend?"Stable":`${s.change>0?"+":""}${s.change}%`})]}),e.jsx("p",{className:"text-xs text-gray-500",children:s.subtitle})]}),e.jsx("div",{className:"p-2 rounded-lg bg-gradient-to-br from-red-50 to-red-100",children:e.jsx(s.icon,{className:`w-4 h-4 ${s.color}`})})]})})})},s.title))}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3 md:gap-4",children:[e.jsxs(r,{className:"lg:col-span-2",children:[e.jsx(i,{className:"pb-2",children:e.jsxs(n,{className:"flex items-center gap-2 text-sm",children:[e.jsx(j,{className:"w-4 h-4 text-red-600"}),"Site Progress Tracking - ",ee()]})}),e.jsx(l,{className:"pt-0",children:e.jsx("div",{className:"h-48",children:e.jsx(W,{width:"100%",height:"100%",children:e.jsxs(D,{data:se,margin:{top:5,right:10,left:10,bottom:5},children:[e.jsx(E,{strokeDasharray:"3 3",stroke:"#f0f0f0"}),e.jsx(R,{dataKey:"week",tick:{fontSize:10},axisLine:{stroke:"#e0e0e0"}}),e.jsx($,{tick:{fontSize:10},axisLine:{stroke:"#e0e0e0"},label:{value:"Progress %",angle:-90,position:"insideLeft",style:{fontSize:10}}}),e.jsx(q,{contentStyle:{backgroundColor:"#ffffff",border:"1px solid #e5e7eb",borderRadius:"6px",fontSize:"12px"}}),e.jsx(F,{wrapperStyle:{fontSize:"11px"}}),e.jsx(A,{type:"monotone",dataKey:"materials",fill:"url(#materialGradient)",stroke:"#F59E0B",strokeWidth:1,name:"Materials Ready"}),e.jsx(M,{type:"monotone",dataKey:"planned",stroke:"#3B82F6",strokeWidth:2,strokeDasharray:"5 5",dot:{fill:"#3B82F6",strokeWidth:1,r:3},name:"Planned"}),e.jsx(M,{type:"monotone",dataKey:"actual",stroke:"#10B981",strokeWidth:2,dot:{fill:"#10B981",strokeWidth:1,r:3},name:"Actual"}),e.jsx("defs",{children:e.jsxs("linearGradient",{id:"materialGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#F59E0B",stopOpacity:.3}),e.jsx("stop",{offset:"95%",stopColor:"#F59E0B",stopOpacity:.1})]})})]})})})})]}),e.jsxs(r,{children:[e.jsx(i,{className:"pb-2",children:e.jsxs(n,{className:"flex items-center gap-2 text-sm",children:[e.jsx(b,{className:"w-4 h-4 text-blue-600"}),"Worker Distribution"]})}),e.jsx(l,{className:"pt-0",children:e.jsx("div",{className:"h-48",children:e.jsx(W,{width:"100%",height:"100%",children:e.jsxs(L,{children:[e.jsx(O,{data:ae,cx:"50%",cy:"50%",innerRadius:25,outerRadius:60,paddingAngle:2,dataKey:"value",children:ae.map((s,t)=>e.jsx(H,{fill:s.color},`cell-${t}`))}),e.jsx(q,{contentStyle:{fontSize:"12px"}}),e.jsx(F,{wrapperStyle:{fontSize:"10px"}})]})})})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 md:gap-4",children:[e.jsxs(r,{children:[e.jsx(i,{className:"pb-2",children:e.jsxs(n,{className:"flex items-center gap-2 text-sm",children:[e.jsx(g,{className:"w-4 h-4 text-purple-600"}),"Material Consumption Trends"]})}),e.jsx(l,{className:"pt-0",children:e.jsx("div",{className:"h-40",children:e.jsx(W,{width:"100%",height:"100%",children:e.jsxs(K,{data:te,margin:{top:5,right:10,left:10,bottom:5},children:[e.jsx(E,{strokeDasharray:"3 3",stroke:"#f0f0f0"}),e.jsx(R,{dataKey:"day",tick:{fontSize:10},axisLine:{stroke:"#e0e0e0"}}),e.jsx($,{tick:{fontSize:10},axisLine:{stroke:"#e0e0e0"}}),e.jsx(q,{contentStyle:{fontSize:"12px"}}),e.jsx(F,{wrapperStyle:{fontSize:"11px"}}),te.length>0&&Object.keys(te[0]).filter(e=>"day"!==e).slice(0,4).map((s,t)=>{const a=["#8884d8","#82ca9d","#ffc658","#ff7c7c"];return e.jsx(A,{type:"monotone",dataKey:s,stackId:"1",stroke:a[t%a.length],fill:a[t%a.length],name:s.replace(/_/g," ").charAt(0).toUpperCase()+s.replace(/_/g," ").slice(1)},s)})]})})})})]}),e.jsxs(r,{children:[e.jsx(i,{className:"pb-2",children:e.jsxs(n,{className:"flex items-center gap-2 text-sm",children:[e.jsx(N,{className:"w-4 h-4 text-green-600"}),"Safety Compliance Metrics"]})}),e.jsx(l,{className:"pt-0",children:e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-2 gap-2",children:re.map((s,t)=>e.jsxs(P.div,{className:"text-center p-2 bg-gradient-to-br from-gray-50 to-gray-100 rounded-lg",initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{delay:.1*t},children:[e.jsx("div",{className:"text-xs text-gray-600",children:s.category}),e.jsxs("div",{className:"text-lg font-bold text-gray-900",children:[s.score,"%"]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-1 mt-1",children:e.jsx(P.div,{className:"h-1 rounded-full",style:{backgroundColor:s.color},initial:{width:0},animate:{width:`${s.score}%`},transition:{duration:1,delay:.1*t}})}),e.jsxs("div",{className:"text-xs text-gray-500 mt-0.5",children:["Target: ",s.target,"%"]})]},s.category))})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 md:gap-4",children:[e.jsxs(r,{children:[e.jsx(i,{className:"pb-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(n,{className:"flex items-center gap-2 text-sm",children:[e.jsx(v,{className:"w-4 h-4 text-red-600"}),"Recent Purchase Requests"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(d,{variant:"default",size:"sm",onClick:e=>{e.preventDefault(),U("../procurement",{replace:!1})},className:"text-xs h-6 px-2 bg-red-600 hover:bg-red-700",title:"Create New Purchase Request",children:[e.jsx(w,{className:"w-3 h-3 mr-1"}),"Create PR"]}),e.jsxs(d,{variant:"ghost",size:"sm",onClick:e=>{e.preventDefault(),U("../procurement",{replace:!1})},className:"text-xs h-6 px-2",title:"View All Purchase Requests",children:["View All",e.jsx(_,{className:"w-3 h-3 ml-1"})]})]})]})}),e.jsx(l,{className:"pt-0 space-y-2",children:ie.map((s,t)=>e.jsxs(P.div,{className:"p-3 border rounded-lg hover:bg-red-50 transition-all cursor-pointer",initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.1*t},whileHover:{scale:1.01},children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-900",children:s.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-0.5",children:[e.jsx(k,{className:"w-3 h-3 text-gray-400"}),e.jsx("p",{className:"text-xs text-gray-600",children:s.location})]})]}),e.jsx(o,{className:`${ce(s.status)} text-xs`,children:s.status})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"text-gray-600",children:"Progress"}),e.jsxs("span",{className:"font-medium",children:[s.progress,"%"]})]}),e.jsx(h,{value:s.progress,className:"h-1"})]}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-2 mt-2 text-xs",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Phase"}),e.jsx("p",{className:"font-semibold text-gray-900",children:s.phase})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Workers"}),e.jsx("p",{className:"font-semibold text-blue-600",children:s.workers})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Safety"}),e.jsxs("p",{className:"font-semibold text-green-600",children:[s.safety,"%"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Lead"}),e.jsx("p",{className:"font-semibold text-gray-900 truncate",children:s.supervisor.split(" ")[0]})]})]})]},s.id))})]}),e.jsxs(r,{children:[e.jsx(i,{className:"pb-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(n,{className:"flex items-center gap-2 text-sm",children:[e.jsx(S,{className:"w-4 h-4 text-blue-600"}),"day"===G?"Today's":ee()," Delivery Schedule"]}),e.jsxs(d,{variant:"ghost",size:"sm",onClick:()=>U("/workflows/material-dispatch-site"),className:"text-xs h-6 px-2",children:["Track All",e.jsx(C,{className:"w-3 h-3 ml-1"})]})]})}),e.jsx(l,{className:"pt-0 space-y-2",children:ne.map((s,t)=>e.jsxs(P.div,{className:"flex items-start gap-3 p-3 border rounded-lg hover:bg-blue-50 transition-all",initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{delay:.1*t},whileHover:{scale:1.01},children:[e.jsx("div",{className:"p-1.5 rounded-full "+("delivered"===s.status?"bg-green-100":"in-transit"===s.status?"bg-blue-100":"delayed"===s.status?"bg-red-100":"bg-yellow-100"),children:e.jsx(S,{className:"w-3 h-3 "+("delivered"===s.status?"text-green-600":"in-transit"===s.status?"text-blue-600":"delayed"===s.status?"text-red-600":"text-yellow-600")})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-gray-900",children:s.material}),e.jsx("p",{className:"text-xs text-gray-600",children:s.supplier})]}),e.jsx(o,{className:`${de(s.status)} text-xs`,children:s.status})]}),e.jsxs("div",{className:"flex items-center gap-3 mt-1",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(T,{className:"w-3 h-3 text-gray-400"}),e.jsx("span",{className:"text-xs text-gray-500",children:s.time})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(g,{className:"w-3 h-3 text-gray-400"}),e.jsx("span",{className:"text-xs text-gray-500",children:s.quantity})]}),s.priority&&e.jsx(o,{variant:"outline",className:"text-xs "+("high"===s.priority?"border-red-300 text-red-700":"medium"===s.priority?"border-yellow-300 text-yellow-700":"border-gray-300 text-gray-700"),children:s.priority})]})]})]},s.id))})]})]})]})};export{U as default};
