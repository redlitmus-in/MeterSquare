import{j as e}from"./radix-ui-34961435.js";import{u as s,r as a}from"./react-vendor-3707ac94.js";import{C as t,a as r,b as i,c as n}from"./card-e62b6216.js";import{u as l,M as c,B as d,a as o,b as m,t as x}from"./index-12cad093.js";import{ag as u,F as p,n as h,aW as g,g as j,a8 as y,a9 as b,T as v,as as N,aX as f,z as w,k as S,i as A,ar as P,b as T,h as _,aG as C}from"./icons-2fde7931.js";import{m as R}from"./ui-vendor-42d562f2.js";import{R as D,l as E,C as $,X as M,Y as k,T as K,d as q,e as V,a as L,P as F,b as O,c as z}from"./charts-4816d993.js";import"./auth-f9290e45.js";import"./utils-8e4480a0.js";import"./forms-337f692b.js";const Q=()=>{const Q=s(),{user:Y}=l(),B=Y?.role||"",G=Y?.full_name||Y?.name||"",[J,W]=a.useState(!0),[X,I]=a.useState(0),[H,U]=a.useState([{title:"Total Spend YTD",value:"AED 0",change:0,trend:"up",icon:u,color:"bg-green-500",subtitle:"Year to Date"},{title:"Active PRs",value:0,change:0,trend:"down",icon:p,color:"bg-[#243d8a]",subtitle:"Purchase Requests"},{title:"Vendor Partners",value:0,change:0,trend:"up",icon:h,color:"bg-purple-500",subtitle:"Active Vendors"},{title:"Cost Savings",value:"AED 0",change:0,trend:"up",icon:g,color:"bg-amber-500",subtitle:"This Quarter"}]),[Z,ee]=a.useState([{month:"Jan",spend:245e3,budget:25e4,savings:5e3},{month:"Feb",spend:289e3,budget:3e5,savings:11e3},{month:"Mar",spend:315e3,budget:32e4,savings:5e3},{month:"Apr",spend:342e3,budget:35e4,savings:8e3},{month:"May",spend:378e3,budget:38e4,savings:2e3},{month:"Jun",spend:401e3,budget:41e4,savings:9e3}]),[se,ae]=a.useState([{name:"Construction Materials",value:35,amount:"AED 640K"},{name:"Electrical & MEP",value:25,amount:"AED 455K"},{name:"Furniture & Joinery",value:20,amount:"AED 365K"},{name:"Safety Equipment",value:12,amount:"AED 218K"},{name:"Office Supplies",value:8,amount:"AED 142K"}]),[te]=a.useState([{name:"ABC Construction Supplies",score:95,orders:127,onTime:98,quality:97,compliance:100},{name:"XYZ Electrical Trading",score:92,orders:89,onTime:95,quality:94,compliance:98},{name:"Global MEP Solutions",score:88,orders:76,onTime:90,quality:91,compliance:95},{name:"Prime Materials Co.",score:86,orders:64,onTime:88,quality:89,compliance:92}]),[re,ie]=a.useState([{id:"1",type:"purchase",title:"New PR Created",description:"PR-2024-011 for construction materials worth AED 125,000",time:"2 hours ago",user:"Ahmed Hassan",urgent:!0},{id:"2",type:"approval",title:"PR Approved",description:"PR-2024-010 approved by Technical Director",time:"4 hours ago",user:"Sarah Johnson"},{id:"3",type:"vendor",title:"Vendor Quote Received",description:"VQ-2024-087 from ABC Suppliers for MEP materials",time:"6 hours ago",user:"Mohammed Ali"},{id:"4",type:"payment",title:"Payment Processed",description:"Invoice INV-2024-234 paid to XYZ Trading",time:"1 day ago",user:"Finance Team"},{id:"5",type:"delivery",title:"Delivery Completed",description:"DN-2024-156 delivered to Site A",time:"1 day ago",user:"Store Team"}]),[ne,le]=a.useState([{label:"Purchase Order Cycle Time",value:"3.2 days",target:"3 days",status:"warning"},{label:"Supplier Lead Time",value:"7.5 days",target:"7 days",status:"success"},{label:"First-Time Approval Rate",value:"78%",target:"85%",status:"danger"},{label:"Contract Compliance",value:"94%",target:"95%",status:"warning"}]);a.useEffect(()=>{(async()=>{try{W(!0);const e=await m.get("/procurement/dashboard");if(e.data.success){const s=e.data.dashboard_data,a=s.material_statistics||{},t=s.status_breakdown||{},r=s.recent_requests||[],i=a.summary?.total_cost||0,n=a.summary?.total_materials||0,l=t.pending||0,c=t.approved||0,d=l+c+(t.rejected||0)+(t.under_review||0),o=c>0?.12*i:0;if(U([{title:"Total Spend",value:`AED ${i.toLocaleString()}`,change:12.5,trend:"up",icon:u,color:"bg-green-500",subtitle:`${n} materials`},{title:"Active PRs",value:d,change:l>0?5.2:-5.2,trend:l>0?"up":"down",icon:p,color:"bg-[#243d8a]",subtitle:`${l} pending`},{title:"Approved",value:c,change:c>0?8.3:0,trend:"up",icon:A,color:"bg-purple-500",subtitle:`${t.under_review||0} in review`},{title:"Cost Savings",value:`AED ${o.toLocaleString()}`,change:o>0?15.7:0,trend:"up",icon:g,color:"bg-amber-500",subtitle:"This Quarter"}]),a.cost_by_category){const e=Object.entries(a.cost_by_category).map(([e,s])=>({name:e,value:Math.round(s/i*100),amount:`AED ${s.toLocaleString()}`})).slice(0,5);ee(e=>{const s=[...e];return s.length>0&&(s[s.length-1].spend=i),s}),ae(e)}if(r.length>0){const e=r.slice(0,5).map((e,s)=>({id:e.purchase_id.toString(),type:"approved"===e.procurement_status?"approval":"pending"===e.procurement_status?"purchase":"vendor",title:"approved"===e.procurement_status?"PR Approved":"pending"===e.procurement_status?"New PR Created":"PR Under Review",description:`PR-${e.purchase_id} - ${e.purpose||"General Purchase"} at ${e.site_location||"Main Site"}`,time:e.created_at?new Date(e.created_at).toLocaleString():"Recently",user:e.requested_by||"System",urgent:e.material_summary?.total_materials>10||!1}));ie(e)}const m=c+(t.rejected||0),x=m>0?c/m*100:0;le([{label:"Purchase Order Cycle Time",value:r.length>0?"2.5 days":"3.2 days",target:"3 days",status:r.length>0?"success":"warning"},{label:"Approval Rate",value:`${x.toFixed(0)}%`,target:"85%",status:x>=85?"success":x>=70?"warning":"danger"},{label:"Pending Requests",value:l.toString(),target:"< 10",status:l<=10?"success":l<=20?"warning":"danger"},{label:"Materials Processed",value:n.toString(),target:"N/A",status:"success"}])}}catch(e){x.error("Failed to load dashboard data")}finally{W(!1)}})()},[X]);const ce=["#243d8a","#3b82f6","#8b5cf6","#f59e0b","#10b981"],de=s=>{switch(s){case"purchase":return e.jsx(b,{className:"w-4 h-4"});case"approval":return e.jsx(A,{className:"w-4 h-4"});case"vendor":return e.jsx(h,{className:"w-4 h-4"});case"payment":return e.jsx(C,{className:"w-4 h-4"});case"delivery":return e.jsx(_,{className:"w-4 h-4"});default:return e.jsx(T,{className:"w-4 h-4"})}},oe=e=>{switch(e){case"purchase":return"text-blue-500 bg-blue-50";case"approval":return"text-green-500 bg-green-50";case"vendor":return"text-purple-500 bg-purple-50";case"payment":return"text-amber-500 bg-amber-50";case"delivery":return"text-indigo-500 bg-indigo-50";default:return"text-gray-500 bg-gray-50"}},me=e=>{switch(e){case"success":return"text-green-600 bg-green-50 border-green-200";case"warning":return"text-amber-600 bg-amber-50 border-amber-200";case"danger":return"text-red-600 bg-red-50 border-red-200";default:return"text-gray-600 bg-gray-50 border-gray-200"}};return J?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx(c,{variant:"pulse-wave",size:"lg"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Loading dashboard..."})]})}):e.jsxs("div",{className:"p-6 space-y-6 bg-gray-50 min-h-screen",children:[e.jsx(R.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"bg-white rounded-xl shadow-sm p-6 border",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900 flex items-center gap-2",children:[e.jsx(j,{className:"w-7 h-7 text-[#243d8a]"}),"Procurement Dashboard"]}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Overview of procurement operations and performance metrics",G&&e.jsxs("span",{className:"ml-2 text-xs",children:["â€¢ Welcome back, ",G]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(d,{variant:"outline",size:"sm",className:"gap-2",children:[e.jsx(y,{className:"w-4 h-4"}),"Export"]}),e.jsxs(d,{onClick:()=>Q(`/${B.toLowerCase().replace(" ","-")}/procurement`),className:"bg-[#243d8a] hover:bg-[#1e3470] text-white gap-2",children:[e.jsx(b,{className:"w-4 h-4"}),"Go to Processing Hub"]})]})]})}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-4 gap-4",children:H.map((s,a)=>e.jsx(R.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1*a},className:"w-full",children:e.jsx(t,{className:"border-0 shadow-md hover:shadow-lg transition-all duration-300 h-full",children:e.jsx(r,{className:"p-5",children:e.jsx("div",{className:"flex items-start justify-between gap-3",children:e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 truncate",children:s.title}),e.jsx("div",{className:`p-2 rounded-lg ${s.color} bg-opacity-10 flex-shrink-0`,children:e.jsx(s.icon,{className:`w-5 h-5 ${s.color.replace("bg-","text-")}`})})]}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 break-words",children:s.value}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:s.subtitle}),e.jsxs("div",{className:"flex items-center gap-1 mt-2",children:["up"===s.trend?e.jsx(v,{className:"w-3.5 h-3.5 text-green-500 flex-shrink-0"}):e.jsx(N,{className:"w-3.5 h-3.5 text-red-500 flex-shrink-0"}),e.jsxs("span",{className:"text-sm font-medium "+("up"===s.trend?"text-green-600":"text-red-600"),children:[Math.abs(s.change),"%"]})]})]})})})})},s.title))}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx(R.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{delay:.2},className:"lg:col-span-2",children:e.jsxs(t,{children:[e.jsx(i,{className:"pb-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(n,{className:"text-lg font-semibold",children:"Procurement Spending Trend"}),e.jsx(o,{variant:"secondary",children:"Last 6 Months"})]})}),e.jsx(r,{children:e.jsx(D,{width:"100%",height:300,children:e.jsxs(E,{data:Z,children:[e.jsx($,{strokeDasharray:"3 3",className:"opacity-30"}),e.jsx(M,{dataKey:"month",className:"text-xs"}),e.jsx(k,{className:"text-xs"}),e.jsx(K,{}),e.jsx(q,{}),e.jsx(V,{dataKey:"spend",fill:"#243d8a",name:"Actual Spend"}),e.jsx(L,{type:"monotone",dataKey:"budget",stroke:"#f59e0b",strokeWidth:2,name:"Budget"}),e.jsx(L,{type:"monotone",dataKey:"savings",stroke:"#10b981",strokeWidth:2,name:"Savings"})]})})})]})}),e.jsx(R.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{delay:.3},children:e.jsxs(t,{children:[e.jsx(i,{className:"pb-4",children:e.jsx(n,{className:"text-lg font-semibold",children:"Spend by Category"})}),e.jsxs(r,{children:[e.jsx(D,{width:"100%",height:300,children:e.jsxs(F,{children:[e.jsx(O,{data:se,cx:"50%",cy:"50%",innerRadius:60,outerRadius:100,paddingAngle:5,dataKey:"value",children:se.map((s,a)=>e.jsx(z,{fill:ce[a%ce.length]},`cell-${a}`))}),e.jsx(K,{})]})}),e.jsx("div",{className:"mt-4 space-y-2",children:se.map((s,a)=>e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:ce[a]}}),e.jsx("span",{className:"text-gray-600",children:s.name})]}),e.jsx("span",{className:"font-medium text-gray-900",children:s.amount})]},s.name))})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx(R.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.4},className:"lg:col-span-2",children:e.jsxs(t,{children:[e.jsx(i,{children:e.jsxs(n,{className:"text-lg font-semibold flex items-center gap-2",children:[e.jsx(f,{className:"w-5 h-5 text-[#243d8a]"}),"Key Performance Indicators"]})}),e.jsx(r,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:ne.map((s,a)=>e.jsx("div",{className:`p-4 rounded-lg border ${me(s.status)}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:s.label}),e.jsx("p",{className:"text-2xl font-bold mt-1",children:s.value}),e.jsxs("p",{className:"text-xs mt-1",children:["Target: ",s.target]})]}),"danger"===s.status&&e.jsx(w,{className:"w-5 h-5 text-red-500"}),"warning"===s.status&&e.jsx(S,{className:"w-5 h-5 text-amber-500"}),"success"===s.status&&e.jsx(A,{className:"w-5 h-5 text-green-500"})]})},a))})})]})}),e.jsx(R.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{delay:.5},children:e.jsxs(t,{children:[e.jsx(i,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(n,{className:"text-lg font-semibold",children:"Recent Activities"}),e.jsx(d,{variant:"ghost",size:"sm",children:"View All"})]})}),e.jsx(r,{children:e.jsx("div",{className:"space-y-4",children:re.map(s=>e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`p-2 rounded-lg ${oe(s.type)}`,children:de(s.type)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:s.title}),e.jsx("p",{className:"text-xs text-gray-600 mt-0.5",children:s.description}),s.user&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["by ",s.user]})]}),s.urgent&&e.jsx(o,{variant:"destructive",className:"text-xs",children:"Urgent"})]}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:s.time})]})]},s.id))})})]})})]}),e.jsx(R.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.6},children:e.jsxs(t,{children:[e.jsx(i,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(n,{className:"text-lg font-semibold flex items-center gap-2",children:[e.jsx(P,{className:"w-5 h-5 text-[#243d8a]"}),"Top Vendor Performance"]}),e.jsx(d,{variant:"outline",size:"sm",children:"Manage Vendors"})]})}),e.jsx(r,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-left py-3 px-2 text-sm font-medium text-gray-700",children:"Vendor"}),e.jsx("th",{className:"text-center py-3 px-2 text-sm font-medium text-gray-700",children:"Score"}),e.jsx("th",{className:"text-center py-3 px-2 text-sm font-medium text-gray-700",children:"Orders"}),e.jsx("th",{className:"text-center py-3 px-2 text-sm font-medium text-gray-700",children:"On-Time"}),e.jsx("th",{className:"text-center py-3 px-2 text-sm font-medium text-gray-700",children:"Quality"}),e.jsx("th",{className:"text-center py-3 px-2 text-sm font-medium text-gray-700",children:"Compliance"})]})}),e.jsx("tbody",{children:te.map((s,a)=>e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"py-3 px-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full "+(s.score>=90?"bg-green-500":s.score>=80?"bg-amber-500":"bg-red-500")}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:s.name})]})}),e.jsx("td",{className:"text-center py-3 px-2",children:e.jsxs(o,{variant:s.score>=90?"default":"secondary",children:[s.score,"%"]})}),e.jsx("td",{className:"text-center py-3 px-2 text-sm text-gray-600",children:s.orders}),e.jsx("td",{className:"text-center py-3 px-2",children:e.jsxs("span",{className:"text-sm text-gray-600",children:[s.onTime,"%"]})}),e.jsx("td",{className:"text-center py-3 px-2",children:e.jsxs("span",{className:"text-sm text-gray-600",children:[s.quality,"%"]})}),e.jsx("td",{className:"text-center py-3 px-2",children:e.jsxs("span",{className:"text-sm text-gray-600",children:[s.compliance,"%"]})})]},a))})]})})})]})})]})};export{Q as default};
